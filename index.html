<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Bakery CHOKOART</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Montserrat:wght@500;700;800;900&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#F8F3E9;

  /* –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤—ã–π */
  --pink:#F6B7C8;
  --pink2:#F8C9D6;
  --pink-dark:#D86A85;

  --accent-red:#8B1E1E; /* —Ü–≤–µ—Ç —Ü–µ–Ω—ã/–±–æ—Ä–¥–æ–≤—ã–π */

  --stroke: rgba(0,0,0,.10);
  --stroke-strong: rgba(0,0,0,.16);
  --inner: rgba(255,255,255,.70);
  --shadow: rgba(0,0,0,.08);
  --shadow-strong: rgba(0,0,0,.14);

  --r-lg:24px;
  --r-md:22px;
  --r-pill:28px;
}

/* —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body[data-theme="dark"]{
  --bg:#121212;
  --stroke: rgba(255,255,255,.14);
  --stroke-strong: rgba(255,255,255,.22);
  --inner: rgba(255,255,255,.06);
  --shadow: rgba(0,0,0,.28);
  --shadow-strong: rgba(0,0,0,.45);
  color:#f1f1f1;
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:var(--bg);
  color:#2b2b2b;
  padding-bottom:88px;
}
body[data-theme="dark"]{ color:#f1f1f1; }

/* –®–ê–ü–ö–ê */
.header{
  padding:16px 12px 26px;
  background:linear-gradient(135deg,var(--pink),var(--pink2));
  color:#2b2b2b;
  box-shadow:0 10px 26px rgba(0,0,0,.12);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  text-align:center;
}

/* –õ–û–ì–û —É–≤–µ–ª–∏—á–∏—Ç—å –≤ 1.5 —Ä–∞–∑–∞ */
.header img{
  position:absolute;
  left:12px;
  width:126px;   /* –±—ã–ª–æ 84 -> —Å—Ç–∞–ª–æ 126 */
  height:126px;  /* –±—ã–ª–æ 84 -> —Å—Ç–∞–ª–æ 126 */
  object-fit:contain;
  border-radius:22px;
  background:rgba(255,255,255,.35);
  padding:10px;
  border:1px solid rgba(255,255,255,.55);
  box-shadow:0 10px 22px rgba(0,0,0,.10);
}

.brand-wrap{display:flex;flex-direction:column;align-items:center;gap:2px;}
.brand-title{
  font-family:'Lobster',cursive;
  font-size:34px;
  line-height:1;
}
.brand-title2{
  font-family:'Montserrat',sans-serif;
  font-weight:900;
  font-size:20px;
  letter-spacing:2px;
  line-height:1.1;
}

/* ‚úÖ BIZ... —É–º–µ–Ω—å—à–∏–ª–∏ –≤ 2 —Ä–∞–∑–∞ + —Ä–æ–≤–Ω—ã–π —à—Ä–∏—Ñ—Ç */
.brand-slogan{
  font-family:'Montserrat',sans-serif; /* —Ä–æ–≤–Ω—ã–π */
  font-weight:800;
  font-size:9px; /* –±—ã–ª–æ 18 -> —Å—Ç–∞–ª–æ 9 */
  letter-spacing:.6px;
  opacity:.9;
  margin-top:4px;
}

/* –¢–µ–ª–µ—Ñ–æ–Ω */
.brand-phone{position:relative; z-index:50; pointer-events:auto; margin-top:6px;}
.brand-phone a{
  color:#2b2b2b;
  text-decoration:none;
  font-size:14px;
  font-weight:900;
  position:relative;
  z-index:51;
  pointer-events:auto;
  cursor:pointer;
}

/* –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é (–±—É—Ä–≥–µ—Ä) */
.menu-btn{
  position:absolute;
  right:14px;
  top:12px;
  width:42px;
  height:42px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:80;

  background:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.55), 0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.menu-btn:active{transform:scale(.97);}
.burger{width:22px;height:16px;position:relative;}
.burger span{
  position:absolute;left:0;right:0;
  height:3px;border-radius:10px;
  background:#222;opacity:.9;
}
.burger span:nth-child(1){top:0;}
.burger span:nth-child(2){top:6.5px;}
.burger span:nth-child(3){bottom:0;}

/* üîç –ø–æ–∏—Å–∫ */
.search-btn{
  position:absolute;
  right:14px;
  bottom:10px;
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:900;
  cursor:pointer;
  z-index:60;

  color:#333;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
.search-btn:active{transform:scale(.97);}

.langs,.types,.payments{
  display:flex;
  gap:12px;
  padding:12px;
  justify-content:center;
}

/* ‚úÖ —à—Ä–∏—Ñ—Ç –≤ –∫–Ω–æ–ø–∫–∞—Ö = –±–æ—Ä–¥–æ–≤—ã–π –∫–∞–∫ —Ü–µ–Ω–∞ */
.btn{
  padding:12px 20px;
  border-radius:var(--r-pill);
  font-weight:900;
  min-width:120px;
  text-align:center;
  cursor:pointer;
  transition:.15s;

  border:1px solid var(--stroke);
  background:#fffdf9;
  color:var(--accent-red);
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
}
body[data-theme="dark"] .btn{
  background:rgba(255,255,255,.06);
  color:#ffd1dc;
}
.btn:active{transform:scale(.98);}

/* –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ ‚Äî —Ä–æ–∑–æ–≤—ã–µ */
.btn.active{
  background:linear-gradient(135deg,var(--pink-dark),var(--pink));
  color:#fff;
  border:1px solid rgba(255,255,255,.42);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.16), 0 10px 22px rgba(216,106,133,.25);
}

/* inputs */
.input{
  margin:8px auto;
  display:block;
  padding:14px;
  width:85%;
  border-radius:var(--r-md);
  font-size:15px;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  outline:none;
  transition:.15s;
}
body[data-theme="dark"] .input{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.input:focus{
  border-color: var(--stroke-strong);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px var(--shadow-strong);
}

/* categories/products */
.categories{
  display:flex;
  gap:12px;
  padding:14px;
  overflow-x:auto;
  scroll-behavior:smooth;
}
.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
  padding:12px;
}
.card{
  border-radius:var(--r-lg);
  padding:12px;
  text-align:center;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
body[data-theme="dark"] .card{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.card:active{transform:scale(.99);}

.img{
  height:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:6px;
}
.img img{
  max-width:125px;
  max-height:125px;
  width:auto;
  height:auto;
  object-fit:contain;
  opacity:1;
  transform:scale(1.05);
  transition:.15s;
}
.card:active .img img{transform:scale(1.12);}

.item-name{
  margin-top:2px;
  padding:0 6px;
  font-weight:900;
  line-height:1.15;
  min-height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  word-break:break-word;
}

/* price */
.price{font-weight:900;color:var(--accent-red);margin-top:6px;}
.price small{font-weight:800;opacity:.75;margin-left:4px;}

/* ‚úÖ +/- –∫–Ω–æ–ø–∫–∏ ‚Äî —Ä–æ–∑–æ–≤—ã–µ */
.counter{display:flex;justify-content:center;gap:10px;margin-top:8px;align-items:center;}
.counter button{
  width:32px;
  height:32px;
  border-radius:50%;
  cursor:pointer;

  border:1px solid rgba(0,0,0,.08);
  background:linear-gradient(135deg,var(--pink2),var(--pink));
  color:#2b2b2b;
  font-size:18px;
  font-weight:900;
  box-shadow:0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.counter button:active{transform:scale(.96);}

/* cart */
.cart{
  background:#fffdf9;
  margin:12px;
  padding:16px;
  border-radius:var(--r-lg);
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.10);
}
body[data-theme="dark"] .cart{ background:rgba(255,255,255,.06); color:#f1f1f1; }

textarea.input{height:90px;}

/* ‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Äî —Ä–æ–∑–æ–≤—ã–π */
.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:var(--r-lg);
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;

  border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(135deg,var(--pink-dark),var(--pink));
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.12);
  transition:.15s;
}
.order-btn:active{transform:scale(.99);}

/* popup */
.popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s;}
.popup.show{opacity:1;pointer-events:auto;}
.popup-box{
  background:white;
  padding:26px;
  border-radius:var(--r-lg);
  text-align:center;
  font-weight:900;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
}
body[data-theme="dark"] .popup-box{ background:#1c1c1c; color:#f1f1f1; }

/* search */
.search-wrap{width:85%;margin:8px auto;position:relative;display:none;z-index:70;}
.search-wrap.show{display:block;}
.search-wrap input{width:100%;margin:0;padding-right:44px;}
.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:30px;
  height:30px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
body[data-theme="dark"] .search-clear{background:rgba(255,255,255,.06); color:#f1f1f1;}
.search-clear:active{transform:translateY(-50%) scale(.96);}
.search-title{width:85%;margin:10px auto 0;font-weight:900;opacity:.9;display:none;z-index:70;position:relative;}
.search-title.show{display:block;}
mark{background:rgba(248,201,214,.55);padding:0 .12em;border-radius:6px;}

/* quick filters */
.quick-filters{display:flex;gap:10px;padding:0 12px 10px;overflow-x:auto;}
.qbtn{
  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  border-radius:999px;
  padding:10px 14px;
  font-weight:900;
  cursor:pointer;
  white-space:nowrap;
  transition:.15s;
  color:var(--accent-red);
}
body[data-theme="dark"] .qbtn{background:rgba(255,255,255,.06); color:#ffd1dc;}
.qbtn:active{transform:scale(.98);}

/* popular */
.popular-wrap{width:100%;padding:4px 12px 6px;}
.popular-title{width:100%;font-weight:900;padding:8px 2px 10px;display:flex;align-items:center;gap:8px;}
.popular-row{display:flex;gap:12px;overflow-x:auto;padding:2px 2px 10px;}
.pop-card{
  min-width:150px;
  border-radius:var(--r-lg);
  padding:10px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.10);
  cursor:pointer;
  transition:.15s;
  position:relative;
}
body[data-theme="dark"] .pop-card{background:rgba(255,255,255,.06); color:#f1f1f1;}
.pop-card:active{transform:scale(.99);}
.pop-img{
  height:74px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(248,201,214,.35);
}
.pop-img img{width:100%;height:100%;object-fit:cover;}
.pop-name{font-weight:900;margin-top:8px;}
.pop-price{font-weight:900;color:var(--accent-red);margin-top:4px;}
.pop-badge{position:absolute;left:10px;top:10px;font-size:18px;pointer-events:none;}

.pop-counter{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:8px;}
.pop-counter button{
  width:30px;height:30px;border-radius:50%;cursor:pointer;
  border:1px solid rgba(0,0,0,.08);
  background:linear-gradient(135deg,var(--pink2),var(--pink));
  color:#2b2b2b;
  font-size:18px;
  font-weight:900;
  box-shadow:0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.pop-counter button:active{transform:scale(.96);}
.pop-counter span{font-weight:900; min-width:18px; text-align:center;}

.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px;
  background:rgba(246,183,200,.60);
  backdrop-filter: blur(10px);
  z-index:999;
  border-top:1px solid rgba(0,0,0,.06);
}
body[data-theme="dark"] .sticky-checkout{
  background:rgba(18,18,18,.88);
  border-top:1px solid rgba(255,255,255,.12);
}
.sticky-inner{
  max-width:520px;
  margin:0 auto;
  border-radius:18px;
  padding:10px 12px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
body[data-theme="dark"] .sticky-inner{background:rgba(255,255,255,.06);}
.sticky-sum{font-weight:900;line-height:1.1;}
.sticky-sum small{display:block;font-weight:800;opacity:.75;margin-top:2px;}

/* ‚úÖ –∫–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω–∞ ‚Äî —Ä–æ–∑–æ–≤–∞—è */
.sticky-btn{
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(135deg,var(--pink-dark),var(--pink));
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.12);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{transform:scale(.99);}

/* sheet (–±—É—Ä–≥–µ—Ä) */
.menu-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.38);
  opacity:0;
  pointer-events:none;
  transition:.18s;
  z-index:1000;
}
.menu-backdrop.show{opacity:1;pointer-events:auto;}

.menu-sheet{
  position:fixed;
  left:0; right:0;
  bottom:-100%;
  background:#fffdf9;
  border-top-left-radius:22px;
  border-top-right-radius:22px;
  border:1px solid var(--stroke);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:.22s;
  z-index:1010;
  padding:10px 12px 14px;
}
body[data-theme="dark"] .menu-sheet{
  background:#1c1c1c;
  border-color:rgba(255,255,255,.14);
}
.menu-sheet.show{bottom:0;}
.menu-handle{
  width:44px;height:5px;border-radius:999px;
  background:rgba(0,0,0,.18);
  margin:6px auto 10px;
}
body[data-theme="dark"] .menu-handle{background:rgba(255,255,255,.18);}
.menu-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.menu-head b{font-size:16px;}
.menu-close{
  width:38px;height:38px;border:none;border-radius:12px;
  background:transparent;
  cursor:pointer;
  font-size:22px;
  line-height:1;
  color:#777;
}
body[data-theme="dark"] .menu-close{color:#bbb;}
.menu-list{display:flex;flex-direction:column;gap:8px;}
.menu-item{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:12px 12px;
  border-radius:16px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  cursor:pointer;
  text-decoration:none;
  color:#2b2b2b;
}
body[data-theme="dark"] .menu-item{
  border-color:rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.menu-left{display:flex;align-items:center;gap:10px;min-width:0;}
.menu-ic{
  width:30px;height:30px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,.06);
  flex:0 0 auto;
}
body[data-theme="dark"] .menu-ic{background:rgba(255,255,255,.06);}
.menu-txt{display:flex;flex-direction:column;min-width:0;}
.menu-name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.menu-sub{font-size:12px;opacity:.75;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
.menu-right{opacity:.65;font-weight:900;}

/* about */
.about-modal{position:fixed;inset:0;background:rgba(0,0,0,.40);display:none;z-index:1100;padding:18px 14px;}
.about-modal.show{display:block;}
.about-card{max-width:680px;margin:0 auto;background:#fffdf9;border:1px solid var(--stroke);border-radius:22px;box-shadow:0 18px 40px rgba(0,0,0,.18);padding:14px 14px 12px;}
body[data-theme="dark"] .about-card{background:#1c1c1c;border-color:rgba(255,255,255,.14);color:#f1f1f1;}
.about-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px;}
.about-head b{font-size:16px;}
.about-body{font-size:14px;line-height:1.45; max-height:65vh; overflow:auto;} /* ‚úÖ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ */
.about-muted{opacity:.75;}
</style>
</head>

<body>

<div class="header">
  <img src="images/logo.png" onerror="this.src='logo.png'" alt="CHOKOART logo">

  <div class="brand-wrap">
    <div class="brand-title">Bakery</div>
    <div class="brand-title2">CHOKOART</div>
    <div class="brand-slogan">BIZ BILAN MAZZALIROQ</div>

    <div class="brand-phone">
      <a href="tel:+998905050745" onclick="callPhone(event)">+998 90 505 07 45</a>
    </div>
  </div>

  <div class="menu-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
    <div class="burger">
      <span></span><span></span><span></span>
    </div>
  </div>

  <div class="search-btn" onclick="toggleSearch()">üîç</div>
</div>

<!-- burger sheet -->
<div class="menu-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>
<div class="menu-sheet" id="menuSheet">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b>–ú–µ–Ω—é</b>
    <button class="menu-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">

    <div class="menu-item" onclick="openYandexReviews(event)" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚≠ê</div>
        <div class="menu-txt">
          <div class="menu-name">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
          <div class="menu-sub">–Ø–Ω–¥–µ–∫—Å –æ—Ç–∑—ã–≤—ã</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <a class="menu-item" href="tel:+998905050745" onclick="closeTopMenu()">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub">+998 90 505 07 45</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <a class="menu-item" href="#" onclick="openInstagram(event)">
      <div class="menu-left">
        <div class="menu-ic">üì∑</div>
        <div class="menu-txt">
          <div class="menu-name">@choko_art_motrid</div>
          <div class="menu-sub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üåì</div>
        <div class="menu-txt">
          <div class="menu-name">–¢–µ–º–∞</div>
          <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
        </div>
      </div>
      <div class="menu-right">–°–º–µ–Ω–∏—Ç—å</div>
    </div>

    <div class="menu-item" onclick="openAbout()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚ÑπÔ∏è</div>
        <div class="menu-txt">
          <div class="menu-name">–û –Ω–∞—Å</div>
          <div class="menu-sub">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Bakery CHOKOART</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

  </div>
</div>

<!-- ‚úÖ Subcategory sheet -->
<div class="menu-backdrop" id="subBackdrop" onclick="closeSubcats()"></div>
<div class="menu-sheet" id="subSheet" style="z-index:1200;">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b id="subTitle">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</b>
    <button class="menu-close" onclick="closeSubcats()">√ó</button>
  </div>
  <div class="menu-list" id="subList"></div>
</div>

<!-- About -->
<div class="about-modal" id="aboutModal" onclick="aboutBackdropClick(event)">
  <div class="about-card">
    <div class="about-head">
      <b>–û –Ω–∞—Å</b>
      <button class="menu-close" onclick="closeAbout()">√ó</button>
    </div>
    <div class="about-body" id="aboutText">
      <!-- –∑–∞–ø–æ–ª–Ω–∏–º —á–µ—Ä–µ–∑ JS -->
    </div>
  </div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="popular-wrap" id="popularWrap">
  <div class="popular-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
  <div class="popular-row" id="popularRow"></div>
</div>

<div class="quick-filters" id="quickFilters"></div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<div class="cart" id="cartBox">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
  <textarea id="comment" class="input"></textarea>
  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>
  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
</div>

<div class="popup" id="popup"><div class="popup-box">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div></div>

<div class="sticky-checkout">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small>—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="openCart()" id="stickyCartBtn">–ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</div>

<script>
Telegram.WebApp.ready();

/* CALL */
function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const tel = "tel:+998905050745";
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(tel);
      return;
    }
  }catch(_){}
  try{ window.location.href = tel; }catch(_){}
}

/* BURGER MENU */
function openTopMenu(){
  try{ closeSearch(); }catch(_){}
  document.getElementById('menuBackdrop').classList.add('show');
  document.getElementById('menuSheet').classList.add('show');
}
function closeTopMenu(){
  document.getElementById('menuBackdrop').classList.remove('show');
  document.getElementById('menuSheet').classList.remove('show');
}

/* YANDEX REVIEWS (–æ–±–Ω–æ–≤–∏–ª —Å—Å—ã–ª–∫—É) */
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = "https://yandex.uz/maps/org/239856130727/?ll=66.960593%2C39.684041&mode=search&sctx=ZAAAAAgBEAAaKAoSCaetEcE4MVFAEfxVgO82QURAEhIJDJQUWABT1j8RPUfku5S6xD8iBgABAgMEBSgKOABA1LoGSAFiJHNuaXBwZXRfZXhwX25hbWU9ZnVsbG9iamVjdHMvMS54OnJlZmIjc25pcHBldF9leHBfbmFtZT10b3BvYmplY3RzLzEueDpyZWZiHnNuaXBwZXRfZXhwX25hbWU9Z29vZHMvMS54OnJlZmInc25pcHBldF9leHBfbmFtZT1nb29kc19yZWdpc3Rlci8xLng6cmVmYgtmcmVzaG5lc3M9MGIXc291cmNlPWJ1c2luZXNzOmV4cF9yZWZiFXNvdXJjZT1wcmljZXM6ZXhwX3JlZmoCdXqdAc3MzD2gAQCoAQC9AXc%2FZizCAQantajE%2FQaCAg9iYWtlcnkgY2hva29hcnSKAgCSAgCaAgxkZXNrdG9wLW1hcHM%3D&sll=66.960593%2C39.684041&sspn=0.013893%2C0.006530&text=bakery%20chokoart&z=16.65";
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}

/* INSTAGRAM (–æ–±–Ω–æ–≤–∏–ª) */
function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = "https://www.instagram.com/choko_art_motrid/";
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}

/* THEME */
function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('chokoart_theme', theme);
  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (theme === 'dark') ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
  try{
    if (window.Telegram && Telegram.WebApp){
      Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#F6B7C8');
      Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
    }
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  applyTheme(cur === 'dark' ? 'light' : 'dark');
}
(function initTheme(){
  const saved = localStorage.getItem('chokoart_theme');
  if(saved === 'dark' || saved === 'light') applyTheme(saved);
  else{
    const tgTheme = (window.Telegram && Telegram.WebApp && Telegram.WebApp.colorScheme) ? Telegram.WebApp.colorScheme : 'light';
    applyTheme(tgTheme === 'dark' ? 'dark' : 'light');
  }
})();

/* ABOUT */
const ABOUT_TEXT = `
üá∑üá∫ <b>–†—É—Å—Å–∫–∏–π</b><br><br>
<b>Bakery CHOKOART</b> ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –¥–µ—Å–µ—Ä—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∏—Å–∫—É—Å—Å—Ç–≤–æ–º üç´‚ú®<br>
–ú—ã —Å–æ–∑–¥–∞—ë–º –∞–≤—Ç–æ—Ä—Å–∫–∏–µ —Ç–æ—Ä—Ç—ã, –∏–∑—ã—Å–∫–∞–Ω–Ω—É—é –≤—ã–ø–µ—á–∫—É –∏ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ —à–µ–¥–µ–≤—Ä—ã –∏–∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, —Å –ª—é–±–æ–≤—å—é –∫ –¥–µ—Ç–∞–ª—è–º –∏ –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤ –ø–æ –≤–∫—É—Å—É.<br><br>
–ö–∞–∂–¥—ã–π –¥–µ—Å–µ—Ä—Ç –≤ CHOKOART ‚Äî —ç—Ç–æ –±–∞–ª–∞–Ω—Å —ç—Å—Ç–µ—Ç–∏–∫–∏, —Å–≤–µ–∂–µ—Å—Ç–∏ –∏ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è. –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –∫–∞–∫ –¥–ª—è –æ—Å–æ–±–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π, —Ç–∞–∫ –∏ –¥–ª—è —Ç–µ—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∫–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –ø–æ—Ä–∞–¥–æ–≤–∞—Ç—å —Å–µ–±—è –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫.<br><br>
üìç –°–∞–º–∞—Ä–∫–∞–Ω–¥, —É–ª. –ú–æ—Ç—Ä–∏–¥, 103V<br>
üìû +998 90 505 07 45<br>
üìû +998 95 500 62 62<br><br>
CHOKOART ‚Äî —Å–ª–∞–¥–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –¥–ª—è –≤–∞—Å.<br><br>

üá∫üáø <b>O‚Äòzbekcha (lotin)</b><br><br>
<b>Bakery CHOKOART</b> ‚Äî shirinliklar san‚Äôatga aylanadigan maskan üç´‚ú®<br>
Biz tabiiy ingredientlardan, mayda tafsilotlarga mehr bilan yondashib, ta‚Äômdan hech qanday murosasiz mualliflik tortlar, nafis pishiriqlar va shokolad asarlarini tayyorlaymiz.<br><br>
CHOKOARTdagi har bir desert ‚Äî bu estetika, yangilik va haqiqiy rohatning mukammal muvozanati. Biz ham muhim tadbirlar, ham o‚Äòzingizni shunchaki xursand qilishni istagan onlar uchun xizmat qilamiz.<br><br>
üìç Samarqand, Motrid ko‚Äòchasi, 103V<br>
üìû +998 90 505 07 45<br>
üìû +998 95 500 62 62<br><br>
CHOKOART ‚Äî siz uchun yaratilgan shirin san‚Äôat.<br><br>

üá¨üáß <b>English</b><br><br>
<b>Bakery CHOKOART</b> is a place where desserts become art üç´‚ú®<br>
We create signature cakes, refined pastries, and chocolate masterpieces using natural ingredients, with love for every detail and no compromise on taste.<br><br>
Every dessert at CHOKOART is a perfect balance of aesthetics, freshness, and true enjoyment. We craft sweets for special occasions as well as for moments when you simply want to treat yourself.<br><br>
üìç Samarkand, Motrid Street, 103V<br>
üìû +998 90 505 07 45<br>
üìû +998 95 500 62 62<br><br>
CHOKOART ‚Äî sweet art created for you.
`;

function openAbout(){
  closeTopMenu();
  document.getElementById('aboutText').innerHTML = ABOUT_TEXT;
  document.getElementById('aboutModal').classList.add('show');
}
function closeAbout(){ document.getElementById('aboutModal').classList.remove('show'); }
function aboutBackdropClick(e){ if(e.target && e.target.id === 'aboutModal') closeAbout(); }

/* TG USER */
const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

/* STATE */
let lang='ru';
let category='cheesecakes';
let type='delivery';
let payment='cash';
let cart={};

/* TEXTS */
const TEXT={
  ru:{delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',click:'üí≥ CLICK',results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ',empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è',chooseSub:'–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é'},
  uz:{delivery:'üöö Yetkazish',pickup:'üèÉ Olib ketish',address:'üìç Manzil',phone:'üìû Telefon',cart:'üõí Savat',order:'Buyurtma berish',comment:'‚úçÔ∏è Izoh',cash:'üíµ Naqd',click:'üí≥ CLICK',results:'Qidiruv natijalari',popular:'üî• Ommabop',empty:"Savat bo‚Äòsh",chooseSub:'Podkategoriya tanlang'},
  en:{delivery:'üöö Delivery',pickup:'üèÉ Pickup',address:'üìç Address',phone:'üìû Phone',cart:'üõí Cart',order:'Place order',comment:'‚úçÔ∏è Comment',cash:'üíµ Cash',click:'üí≥ CLICK',results:'Search results',popular:'üî• Popular',empty:'Cart is empty',chooseSub:'Choose a subcategory'}
};

/* ‚úÖ –¢–í–û–ò –ö–ê–¢–ï–ì–û–†–ò–ò */
const CATS={
  ru:{cheesecakes:'üç∞ –ß–∏–∑–∫–µ–π–∫–∏', cakes:'üéÇ –¢–æ—Ä—Ç—ã', rolls:'ü•ê –†—É–ª–µ—Ç—ã', bakery:'ü•ñ –í—ã–ø–µ—á–∫–∞', cookies:'üç™ –ü–µ—á–µ–Ω—å–µ', desserts:'üçÆ –î–µ—Å–µ—Ä—Ç—ã', pies:'ü•ß –ü–∏—Ä–æ–≥–∏'},
  uz:{cheesecakes:'üç∞ Chizkeyklar', cakes:'üéÇ Tortlar', rolls:'ü•ê Ruletlar', bakery:'ü•ñ Pishiriqlar', cookies:'üç™ Pechenye', desserts:'üçÆ Desertlar', pies:'ü•ß Piroglar'},
  en:{cheesecakes:'üç∞ Cheesecakes', cakes:'üéÇ Cakes', rolls:'ü•ê Rolls', bakery:'ü•ñ Pastry', cookies:'üç™ Cookies', desserts:'üçÆ Desserts', pies:'ü•ß Pies'}
};

/* ‚úÖ –ü–û–î–ö–ê–¢–ï–ì–û–†–ò–ò (–∫–∞–∫ —Ç—ã –ø–æ–ø—Ä–æ—Å–∏–ª) */
const SUBCATS = {
  cakes: [
    { key:'wedding', ru:'üíç –°–≤–∞–¥–µ–±–Ω—ã–µ —Ç–æ—Ä—Ç—ã', uz:'üíç To‚Äòy tortlari', en:'üíç Wedding cakes' },
    { key:'bento',   ru:'üéÅ –ë–µ–Ω—Ç–æ —Ç–æ—Ä—Ç—ã',     uz:'üéÅ Bento tortlar', en:'üéÅ Bento cakes' },
    { key:'roll',    ru:'üç´ –¢–æ—Ä—Ç—ã —Ä—É–ª–µ—Ç—ã',    uz:'üç´ Rulet-tortlar', en:'üç´ Roll cakes' },
    { key:'event',   ru:'‚ú® –¢–æ—Ä—Ç—ã –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', uz:'‚ú® Tadbir tortlari', en:'‚ú® Event cakes' }
  ],
  bakery: [
    { key:'savory',  ru:'ü•® –ù–µ—Å–ª–∞–¥–∫–∞—è –≤—ã–ø–µ—á–∫–∞', uz:'ü•® Tuzli pishiriqlar', en:'ü•® Savory pastry' },
    { key:'sweet',   ru:'ü•ê –°–¥–æ–±–Ω–∞—è –≤—ã–ø–µ—á–∫–∞',   uz:'ü•ê Shirin pishiriqlar', en:'ü•ê Sweet pastry' },
    { key:'puff',    ru:'ü•ü –°–ª–æ—ë–Ω–∞—è –≤—ã–ø–µ—á–∫–∞',   uz:'ü•ü Qatlama pishiriq', en:'ü•ü Puff pastry' }
  ],
  cookies: [
    { key:'short',   ru:'üç™ –ü–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ', uz:'üç™ Qumoq pechenye', en:'üç™ Shortbread' },
    { key:'filled',  ru:'üç´ –ü–µ—á–µ–Ω—å–µ —Å –Ω–∞—á–∏–Ω–∫–æ–π', uz:'üç´ Nachinkali pechenye', en:'üç´ Filled cookies' }
  ],
  desserts: [
    { key:'mousse',  ru:'üçÆ –ú—É—Å—Å–æ–≤—ã–µ –¥–µ—Å–µ—Ä—Ç—ã', uz:'üçÆ Musli desertlar', en:'üçÆ Mousse desserts' },
    { key:'mini',    ru:'üßÅ –ú–∏–Ω–∏ –¥–µ—Å–µ—Ä—Ç—ã',     uz:'üßÅ Mini desertlar', en:'üßÅ Mini desserts' }
  ],
  pies: [
    { key:'sliced',  ru:'ü•ß –ù–∞—Ä–µ–∑–Ω—ã–µ –ø–∏—Ä–æ–≥–∏', uz:'ü•ß Bo‚Äòlak piroglar', en:'ü•ß Sliced pies' },
    { key:'whole',   ru:'ü•ß –¶–µ–ª—ã–µ –ø–∏—Ä–æ–≥–∏',    uz:'ü•ß Butun piroglar', en:'ü•ß Whole pies' }
  ]
};

/* ‚úÖ –ë–ê–ó–û–í–û–ï –ú–ï–ù–Æ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–µ–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π) */
const MENU = {
  cheesecakes: [
    {id:'chz_berry', p:55000, img:'images/chz_berry.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ —è–≥–æ–¥–Ω—ã–π', uz:'Rezavor chizkeyk', en:'Berry cheesecake'}},
    {id:'chz_classic', p:52000, img:'images/chz_classic.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', uz:'Klassik chizkeyk', en:'Classic cheesecake'}}
  ],
  rolls: [
    {id:'roll_choco', p:45000, img:'images/roll_choco.png', n:{ru:'–†—É–ª–µ—Ç —à–æ–∫–æ–ª–∞–¥–Ω—ã–π', uz:'Shokolad rulet', en:'Chocolate roll'}},
    {id:'roll_cream', p:45000, img:'images/roll_cream.png', n:{ru:'–†—É–ª–µ—Ç —Å–ª–∏–≤–æ—á–Ω—ã–π', uz:'Qaymoqli rulet', en:'Cream roll'}}
  ],

  /* –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–ø—É—Å—Ç—ã–µ ‚Äî –±–ª—é–¥–∞ –±–µ—Ä—ë–º –∏–∑ MENU_SUB) */
  cakes: [],
  bakery: [],
  cookies: [],
  desserts: [],
  pies: []
};

/* ‚úÖ –ú–ï–ù–Æ –ü–û –ü–û–î–ö–ê–¢–ï–ì–û–†–ò–Ø–ú (–ø–æ 2 –±–ª—é–¥–∞ –Ω–∞ –∫–∞–∂–¥—É—é) */
const MENU_SUB = {
  cakes: {
    wedding: [
      {id:'cake_wed_1', p:350000, img:'images/cake_wed_1.png', n:{ru:'–°–≤–∞–¥–µ–±–Ω—ã–π —Ç–æ—Ä—Ç 1', uz:'To‚Äòy torti 1', en:'Wedding cake 1'}},
      {id:'cake_wed_2', p:420000, img:'images/cake_wed_2.png', n:{ru:'–°–≤–∞–¥–µ–±–Ω—ã–π —Ç–æ—Ä—Ç 2', uz:'To‚Äòy torti 2', en:'Wedding cake 2'}}
    ],
    bento: [
      {id:'cake_bento_1', p:90000, img:'images/cake_bento_1.png', n:{ru:'–ë–µ–Ω—Ç–æ —Ç–æ—Ä—Ç 1', uz:'Bento tort 1', en:'Bento cake 1'}},
      {id:'cake_bento_2', p:90000, img:'images/cake_bento_2.png', n:{ru:'–ë–µ–Ω—Ç–æ —Ç–æ—Ä—Ç 2', uz:'Bento tort 2', en:'Bento cake 2'}}
    ],
    roll: [
      {id:'cake_roll_1', p:120000, img:'images/cake_roll_1.png', n:{ru:'–¢–æ—Ä—Ç-—Ä—É–ª–µ—Ç 1', uz:'Rulet-tort 1', en:'Roll cake 1'}},
      {id:'cake_roll_2', p:120000, img:'images/cake_roll_2.png', n:{ru:'–¢–æ—Ä—Ç-—Ä—É–ª–µ—Ç 2', uz:'Rulet-tort 2', en:'Roll cake 2'}}
    ],
    event: [
      {id:'cake_event_1', p:250000, img:'images/cake_event_1.png', n:{ru:'–¢–æ—Ä—Ç –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 1', uz:'Tadbir torti 1', en:'Event cake 1'}},
      {id:'cake_event_2', p:280000, img:'images/cake_event_2.png', n:{ru:'–¢–æ—Ä—Ç –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 2', uz:'Tadbir torti 2', en:'Event cake 2'}}
    ]
  },
  bakery: {
    savory: [
      {id:'bak_sav_1', p:22000, img:'images/bak_sav_1.png', n:{ru:'–ù–µ—Å–ª–∞–¥–∫–∞—è –≤—ã–ø–µ—á–∫–∞ 1', uz:'Tuzli pishiriq 1', en:'Savory pastry 1'}},
      {id:'bak_sav_2', p:22000, img:'images/bak_sav_2.png', n:{ru:'–ù–µ—Å–ª–∞–¥–∫–∞—è –≤—ã–ø–µ—á–∫–∞ 2', uz:'Tuzli pishiriq 2', en:'Savory pastry 2'}}
    ],
    sweet: [
      {id:'bak_sweet_1', p:25000, img:'images/bak_sweet_1.png', n:{ru:'–°–¥–æ–±–Ω–∞—è –≤—ã–ø–µ—á–∫–∞ 1', uz:'Shirin pishiriq 1', en:'Sweet pastry 1'}},
      {id:'bak_sweet_2', p:25000, img:'images/bak_sweet_2.png', n:{ru:'–°–¥–æ–±–Ω–∞—è –≤—ã–ø–µ—á–∫–∞ 2', uz:'Shirin pishiriq 2', en:'Sweet pastry 2'}}
    ],
    puff: [
      {id:'bak_puff_1', p:27000, img:'images/bak_puff_1.png', n:{ru:'–°–ª–æ—ë–Ω–∞—è –≤—ã–ø–µ—á–∫–∞ 1', uz:'Qatlama pishiriq 1', en:'Puff pastry 1'}},
      {id:'bak_puff_2', p:27000, img:'images/bak_puff_2.png', n:{ru:'–°–ª–æ—ë–Ω–∞—è –≤—ã–ø–µ—á–∫–∞ 2', uz:'Qatlama pishiriq 2', en:'Puff pastry 2'}}
    ]
  },
  cookies: {
    short: [
      {id:'cook_short_1', p:18000, img:'images/cook_short_1.png', n:{ru:'–ü–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ 1', uz:'Qumoq pechenye 1', en:'Shortbread 1'}},
      {id:'cook_short_2', p:18000, img:'images/cook_short_2.png', n:{ru:'–ü–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ 2', uz:'Qumoq pechenye 2', en:'Shortbread 2'}}
    ],
    filled: [
      {id:'cook_fill_1', p:22000, img:'images/cook_fill_1.png', n:{ru:'–ü–µ—á–µ–Ω—å–µ —Å –Ω–∞—á–∏–Ω–∫–æ–π 1', uz:'Nachinkali pechenye 1', en:'Filled cookie 1'}},
      {id:'cook_fill_2', p:22000, img:'images/cook_fill_2.png', n:{ru:'–ü–µ—á–µ–Ω—å–µ —Å –Ω–∞—á–∏–Ω–∫–æ–π 2', uz:'Nachinkali pechenye 2', en:'Filled cookie 2'}}
    ]
  },
  desserts: {
    mousse: [
      {id:'des_mousse_1', p:35000, img:'images/des_mousse_1.png', n:{ru:'–ú—É—Å—Å–æ–≤—ã–π –¥–µ—Å–µ—Ä—Ç 1', uz:'Musli desert 1', en:'Mousse dessert 1'}},
      {id:'des_mousse_2', p:35000, img:'images/des_mousse_2.png', n:{ru:'–ú—É—Å—Å–æ–≤—ã–π –¥–µ—Å–µ—Ä—Ç 2', uz:'Musli desert 2', en:'Mousse dessert 2'}}
    ],
    mini: [
      {id:'des_mini_1', p:25000, img:'images/des_mini_1.png', n:{ru:'–ú–∏–Ω–∏ –¥–µ—Å–µ—Ä—Ç 1', uz:'Mini desert 1', en:'Mini dessert 1'}},
      {id:'des_mini_2', p:25000, img:'images/des_mini_2.png', n:{ru:'–ú–∏–Ω–∏ –¥–µ—Å–µ—Ä—Ç 2', uz:'Mini desert 2', en:'Mini dessert 2'}}
    ]
  },
  pies: {
    sliced: [
      {id:'pie_slice_1', p:45000, img:'images/pie_slice_1.png', n:{ru:'–ù–∞—Ä–µ–∑–Ω–æ–π –ø–∏—Ä–æ–≥ 1', uz:'Bo‚Äòlak pirog 1', en:'Sliced pie 1'}},
      {id:'pie_slice_2', p:45000, img:'images/pie_slice_2.png', n:{ru:'–ù–∞—Ä–µ–∑–Ω–æ–π –ø–∏—Ä–æ–≥ 2', uz:'Bo‚Äòlak pirog 2', en:'Sliced pie 2'}}
    ],
    whole: [
      {id:'pie_whole_1', p:120000, img:'images/pie_whole_1.png', n:{ru:'–¶–µ–ª—ã–π –ø–∏—Ä–æ–≥ 1', uz:'Butun pirog 1', en:'Whole pie 1'}},
      {id:'pie_whole_2', p:120000, img:'images/pie_whole_2.png', n:{ru:'–¶–µ–ª—ã–π –ø–∏—Ä–æ–≥ 2', uz:'Butun pirog 2', en:'Whole pie 2'}}
    ]
  }
};

/* —Ç–µ–∫—É—â–∞—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è */
let subcat = null;

/* –∏–Ω–¥–µ–∫—Å –≤—Å–µ—Ö –±–ª—é–¥ */
const ITEM_INDEX = {};
function rebuildIndex(){
  for(const c in ITEM_INDEX) delete ITEM_INDEX[c];

  // base
  for(const cat in MENU){
    (MENU[cat] || []).forEach(it => ITEM_INDEX[it.id] = it);
  }
  // sub
  for(const cat in MENU_SUB){
    const groups = MENU_SUB[cat] || {};
    for(const sc in groups){
      (groups[sc] || []).forEach(it => ITEM_INDEX[it.id] = it);
    }
  }
}
rebuildIndex();

/* popular ids */
const POPULAR = ['chz_classic','cake_bento_1','des_mousse_1','pie_whole_1'];

function nameOf(id){
  const it = ITEM_INDEX[id];
  if(!it) return id;
  return (it.n && (it.n[lang] || it.n.ru)) || id;
}
function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function highlight(name, q){
  const n = escapeHtml(name);
  if(!q) return n;
  const idx = n.toLowerCase().indexOf(q.toLowerCase());
  if(idx === -1) return n;
  const before = n.slice(0, idx);
  const mid = n.slice(idx, idx + q.length);
  const after = n.slice(idx + q.length);
  return `${before}<mark>${mid}</mark>${after}`;
}

function loadSaved(){
  const a = localStorage.getItem('chokoart_address') || '';
  const p = localStorage.getItem('chokoart_phone') || '';
  if(a && !address.value) address.value = a;
  if(p && !phone.value) phone.value = p;
}
function bindSave(){
  address.addEventListener('input', ()=>localStorage.setItem('chokoart_address', address.value));
  phone.addEventListener('input', ()=>localStorage.setItem('chokoart_phone', phone.value));
}

function updateTypeFields(){
  if(type === 'pickup'){
    address.style.display = 'none';
    address.value = '';
  }else{
    address.style.display = 'block';
  }
}

function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}

function applyLang(){
  btnDelivery.innerText=TEXT[lang].delivery;
  btnPickup.innerText=TEXT[lang].pickup;
  address.placeholder=TEXT[lang].address;
  phone.placeholder=TEXT[lang].phone;
  cartTitle.innerText=TEXT[lang].cart;
  orderBtn.innerText=TEXT[lang].order;
  comment.placeholder=TEXT[lang].comment;
  payCash.innerText=TEXT[lang].cash;
  payClick.innerText=TEXT[lang].click;
  searchTitle.innerText = TEXT[lang].results;
  popularTitle.innerText = TEXT[lang].popular;
  stickyCartBtn.innerText = TEXT[lang].cart;

  renderPopular();
  renderQuickFilters();
  renderCats();
  renderProducts();
  updateTotal();
  updateTypeFields();
}

function openCart(){
  try{ cartBox.scrollIntoView({behavior:'smooth', block:'start'}); }
  catch(_){ window.location.hash = '#cartBox'; }
}

/* ‚úÖ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ sheet */
let currentSubcatCategory = null;

function hasSubcats(cat){
  return !!SUBCATS[cat];
}
function openSubcats(cat){
  currentSubcatCategory = cat;
  document.getElementById('subBackdrop').classList.add('show');
  document.getElementById('subSheet').classList.add('show');

  // title
  document.getElementById('subTitle').innerText = CATS[lang][cat] || cat;

  const list = document.getElementById('subList');
  list.innerHTML = '';

  (SUBCATS[cat] || []).forEach(sc=>{
    const title = sc[lang] || sc.ru;
    list.innerHTML += `
      <div class="menu-item" onclick="pickSubcat('${cat}','${sc.key}')">
        <div class="menu-left">
          <div class="menu-ic">üìå</div>
          <div class="menu-txt">
            <div class="menu-name">${escapeHtml(title)}</div>
            <div class="menu-sub">${lang==='ru'?'–û—Ç–∫—Ä—ã—Ç—å':'Open'}</div>
          </div>
        </div>
        <div class="menu-right">‚Ä∫</div>
      </div>
    `;
  });
}
function closeSubcats(){
  document.getElementById('subBackdrop').classList.remove('show');
  document.getElementById('subSheet').classList.remove('show');
}
function pickSubcat(cat, key){
  category = cat;
  subcat = key;
  closeSubcats();
  renderCats();
  renderProducts();
}

/* ‚úÖ –∫–ª–∏–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
function onCategoryClick(cat){
  if(isSearchOpen()) closeSearch();

  // –µ—Å–ª–∏ —É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî –æ—Ç–∫—Ä–æ–µ–º sheet
  if(hasSubcats(cat)){
    openSubcats(cat);
    return;
  }

  category = cat;
  subcat = null;
  renderCats();
  renderProducts();
}

function renderQuickFilters(){
  // –±—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–æ—Å—Ç–∞–≤–∏–ª 4 –æ—Å–Ω–æ–≤–Ω—ã–µ)
  const keys = ['cheesecakes','cakes','bakery','desserts'];
  quickFilters.innerHTML = '';
  keys.forEach(k=>{
    quickFilters.innerHTML += `<button class="qbtn" onclick="onCategoryClick('${k}')">${CATS[lang][k]}</button>`;
  });
}

function renderCats(){
  cats.innerHTML='';
  const order = ['cheesecakes','cakes','rolls','bakery','cookies','desserts','pies'];
  order.forEach((k)=>{
    cats.innerHTML += `<button class="btn ${k===category?'active':''}" onclick="onCategoryClick('${k}')">${CATS[lang][k]}</button>`;
  });

  setTimeout(()=>{
    const active = cats.querySelector('.btn.active');
    if(active && active.scrollIntoView){
      active.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
    }
  }, 30);
}

function cardHTML(it, q=''){
  const id = it.id;
  const displayName = nameOf(id);
  const nameHtml = highlight(displayName, q);
  const qty = cart[id] || 0;

  return `<div class="card">
    <div class="img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
    <div class="item-name">${nameHtml}</div>
    <div class="price">${formatSum(it.p)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button onclick="chg('${id}',-1)">‚àí</button>
      <span id="c_${id}">${qty}</span>
      <button onclick="chg('${id}',1)">+</button>
    </div>
  </div>`;
}

/* ‚úÖ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª—é–¥–∞:
   - –µ—Å–ª–∏ –µ—Å—Ç—å subcat (–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏) -> MENU_SUB
   - –∏–Ω–∞—á–µ -> MENU[category]
*/
function getCurrentItems(){
  if(hasSubcats(category)){
    if(!subcat) return null;
    return (MENU_SUB[category] && MENU_SUB[category][subcat]) ? MENU_SUB[category][subcat] : [];
  }
  return MENU[category] || [];
}

function renderProducts(){
  products.innerHTML='';

  const arr = getCurrentItems();
  if(arr === null){
    products.innerHTML = `
      <div style="grid-column:1/-1; padding:14px; font-weight:900; opacity:.85;">
        ${TEXT[lang].chooseSub}
      </div>
    `;
    return;
  }

  (arr || []).forEach((it)=>{
    cart[it.id]=cart[it.id]||0;
    products.innerHTML += cardHTML(it,'');
  });
}

function renderPopular(){
  popularRow.innerHTML = '';
  POPULAR.forEach((id)=>{
    const it = ITEM_INDEX[id];
    if(!it) return;
    cart[id]=cart[id]||0;

    popularRow.innerHTML += `
      <div class="pop-card" onclick="onPopularCardClick(event,'${id}')">
        <div class="pop-badge">üî•</div>
        <div class="pop-img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
        <div class="pop-name">${escapeHtml(nameOf(id))}</div>
        <div class="pop-price">${formatSum(it.p)} <small>—Å—É–º</small></div>

        <div class="pop-counter">
          <button type="button" onclick="popChg(event,'${id}',-1)">‚àí</button>
          <span id="pc_${id}">${cart[id]||0}</span>
          <button type="button" onclick="popChg(event,'${id}',1)">+</button>
        </div>
      </div>
    `;
  });
}
function onPopularCardClick(e,id){
  if(e && e.target && (e.target.closest && e.target.closest('button'))) return;
  chg(id, 1);
  const pc = document.getElementById('pc_'+id);
  if(pc) pc.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}
function popChg(e,id,delta){
  if(e){ e.preventDefault(); e.stopPropagation(); }
  chg(id, delta);
  const pc = document.getElementById('pc_'+id);
  if(pc) pc.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}

function syncPopularCounters(){
  POPULAR.forEach((id)=>{
    const el = document.getElementById('pc_'+id);
    if(el) el.innerText = cart[id] || 0;
  });
}
function chg(id,v){
  cart[id]=Math.max(0,(cart[id]||0)+v);
  const el = document.getElementById('c_'+id);
  if(el) el.innerText=cart[id];
  updateTotal();
  syncPopularCounters();
}
function price(id){
  return (ITEM_INDEX[id] && ITEM_INDEX[id].p) ? ITEM_INDEX[id].p : 0;
}
function updateTotal(){
  let s=0;
  for(let id in cart) s += (cart[id]||0) * price(id);
  total.innerText = formatSum(s);
  stickyTotal.innerText = formatSum(s);
}

function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  updateTypeFields();
}
function setPayment(p){
  payment=p;
  payCash.classList.toggle('active',p==='cash');
  payClick.classList.toggle('active',p==='click');
}

function isSearchOpen(){ return searchWrap.classList.contains('show'); }
function toggleSearch(){ if(isSearchOpen()) closeSearch(); else openSearch(); }
function openSearch(){
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  cats.style.display = 'none';
  quickFilters.style.display = 'none';
  popularWrap.style.display = 'none';
  searchInput.value = '';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  cats.style.display = '';
  quickFilters.style.display = '';
  popularWrap.style.display = '';
  searchInput.value = '';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key === 'Enter') closeSearch(); }

function searchProducts(){
  const q = (searchInput.value || '').trim().toLowerCase();
  products.innerHTML='';

  if(!q){
    renderProducts();
    return;
  }

  // –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º—É –∏–Ω–¥–µ–∫—Å—É
  for(const id in ITEM_INDEX){
    const it = ITEM_INDEX[id];
    const nmRu = (it.n && it.n.ru) ? String(it.n.ru).toLowerCase() : '';
    const nmUz = (it.n && it.n.uz) ? String(it.n.uz).toLowerCase() : '';
    const nmEn = (it.n && it.n.en) ? String(it.n.en).toLowerCase() : '';
    const nmCur = (it.n && it.n[lang]) ? String(it.n[lang]).toLowerCase() : '';
    if(nmCur.includes(q) || nmRu.includes(q) || nmUz.includes(q) || nmEn.includes(q)){
      cart[it.id]=cart[it.id]||0;
      products.innerHTML += cardHTML(it, q);
    }
  }
}

document.addEventListener('click', (e)=>{
  if(!isSearchOpen()) return;
  const t = e.target;
  const insideSearch = searchWrap.contains(t) || searchTitle.contains(t);
  const onBtn = t.closest && t.closest('.search-btn');
  if(!insideSearch && !onBtn) closeSearch();
}, true);

/* ORDER ID */
function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `chokoart_seq_${d.getFullYear()}${mm}${dd}`;
  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));
  const num = String(n).padStart(3,'0');
  return `CHK-${dd}${mm}-${num}`;
}
function calcTotalNum(){
  let s = 0;
  for (const id in cart) s += (Number(cart[id] || 0) * price(id));
  return s;
}

/* SEND ORDER */
function sendOrder(){
  popup.classList.add('show');

  const items = [];
  for (const id in cart) {
    const qty = Number(cart[id] || 0);
    if (qty > 0) {
      const it = ITEM_INDEX[id] || {};
      items.push({
        id,
        qty,
        price: it.p || 0,
        name_ru: (it.n && it.n.ru) ? it.n.ru : id,
        name_lang: nameOf(id)
      });
    }
  }

  if (items.length === 0) {
    popup.classList.remove('show');
    alert(TEXT[lang].empty);
    return;
  }

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    items,
    total: total.innerText,
    total_num: calcTotalNum(),
    payment,
    type,
    address: (type==='pickup' ? '' : address.value),
    phone: phone.value,
    comment: comment.value,
    order_id: genOrderId(),
    lang,
    category,
    subcat
  };

  setTimeout(()=>{
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  }, 700);
}

loadSaved();
bindSave();
applyLang();
</script>
</body>
</html>
