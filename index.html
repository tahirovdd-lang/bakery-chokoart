<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Bakery CHOKOART</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Montserrat:wght@500;700;800;900&display=swap" rel="stylesheet" />

<style>
:root{
  --bg:#F8F3E9;
  --terracotta:#C76B2F;
  --gold:#D4A017;
  --green:#1F4D3A;
  --meat:#8B1E1E;

  --stroke: rgba(199,107,47,.35);
  --stroke-strong: rgba(199,107,47,.50);
  --inner: rgba(255,255,255,.70);
  --shadow: rgba(120,70,20,.10);
  --shadow-strong: rgba(120,70,20,.18);

  --r-lg:24px;
  --r-md:22px;
  --r-pill:28px;
}

/* ‚úÖ —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body[data-theme="dark"]{
  --bg:#121212;
  --stroke: rgba(255,255,255,.14);
  --stroke-strong: rgba(255,255,255,.22);
  --inner: rgba(255,255,255,.06);
  --shadow: rgba(0,0,0,.28);
  --shadow-strong: rgba(0,0,0,.45);
  color:#f1f1f1;
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:var(--bg);
  color:#2b2b2b;
  padding-bottom:88px;
}
body[data-theme="dark"]{ color:#f1f1f1; }

/* ‚úÖ‚úÖ‚úÖ –®–ê–ü–ö–ê (–∫–∞–∫ –±—ã–ª–æ) */
.header{
  padding:16px 12px 26px;
  background:linear-gradient(135deg,var(--terracotta),var(--gold));
  color:white;
  box-shadow:0 6px 18px rgba(120,70,20,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  text-align:center;
}
.header img{
  position:absolute;left:12px;width:110px;
  height:110px;
  object-fit:contain;
}

/* Bakery / CHOKOART */
.brand-wrap{display:flex;flex-direction:column;align-items:center;gap:2px;}
.brand-title{font-family:'Lobster',cursive;font-size:36px;line-height:1;}
.brand-title2{font-weight:900;font-size:18px;letter-spacing:2px;line-height:1.1;}
/* ‚úÖ —É–º–µ–Ω—å—à–∏–ª–∏ –¢–û–õ–¨–ö–û "BIZ..." –≤ 2 —Ä–∞–∑–∞ */
.brand-slogan{
  font-family:'Lobster',cursive;
  font-size:9px;
  opacity:.95;
  margin-top:2px;
}

.brand-phone{position:relative; z-index:50; pointer-events:auto; margin-top:4px;}
.brand-phone a{
  color:white;
  text-decoration:none;
  font-size:15px;
  font-weight:700;
  position:relative;
  z-index:51;
  pointer-events:auto;
  cursor:pointer;
}

/* ‚úÖ‚úÖ‚úÖ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é (–±—É—Ä–≥–µ—Ä) */
.menu-btn{
  position:absolute;
  right:14px;
  top:12px;
  width:42px;
  height:42px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:80;

  background:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.55), 0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.menu-btn:active{transform:scale(.97);}
.burger{width:22px;height:16px;position:relative;}
.burger span{
  position:absolute;left:0;right:0;
  height:3px;border-radius:10px;
  background:#222;opacity:.9;
}
.burger span:nth-child(1){top:0;}
.burger span:nth-child(2){top:6.5px;}
.burger span:nth-child(3){bottom:0;}

/* üîç –ø–æ–∏—Å–∫ */
.search-btn{
  position:absolute;
  right:14px;
  bottom:10px;
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  z-index:60;

  color:#333;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
.search-btn:active{transform:scale(.97);}

.langs,.types,.payments{
  display:flex;
  gap:12px;
  padding:12px;
  justify-content:center;
}

.btn{
  padding:12px 20px;
  border-radius:var(--r-pill);
  font-weight:800;
  min-width:120px;
  text-align:center;
  cursor:pointer;
  transition:.15s;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
}
body[data-theme="dark"] .btn{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.btn:active{transform:scale(.98);}
.btn.active{
  background:linear-gradient(135deg,var(--terracotta),var(--gold));
  color:white;
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.45), 0 8px 18px var(--shadow-strong);
}

.input{
  margin:8px auto;
  display:block;
  padding:14px;
  width:85%;
  border-radius:var(--r-md);
  font-size:15px;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  outline:none;
  transition:.15s;
}
body[data-theme="dark"] .input{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
textarea.input{height:90px;}

.categories{
  display:flex;
  gap:12px;
  padding:14px;
  overflow-x:auto;
  scroll-behavior:smooth;
}
.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
  padding:12px;
}

.card{
  border-radius:var(--r-lg);
  padding:12px;
  text-align:center;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(120,70,20,.12);
  transition:.15s;
}
body[data-theme="dark"] .card{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.card:active{transform:scale(.99);}

.img{
  height:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:6px;
}
.img img{
  max-width:125px;
  max-height:125px;
  width:auto;
  height:auto;
  object-fit:contain;
  opacity:1;
  transform:scale(1.05);
  transition:.15s;
}
.card:active .img img{transform:scale(1.12);}

.item-name{
  margin-top:2px;
  padding:0 6px;
  font-weight:900;
  line-height:1.15;
  min-height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  word-break:break-word;
}

.price{font-weight:900;color:var(--meat);margin-top:6px;}
.price small{font-weight:800;opacity:.75;margin-left:4px;}

.counter{display:flex;justify-content:center;gap:10px;margin-top:8px;align-items:center;}
.counter button{
  width:32px;
  height:32px;
  border-radius:50%;
  cursor:pointer;

  border:1px solid rgba(255,255,255,.6);
  background:var(--green);
  color:white;
  font-size:16px;
  box-shadow:0 6px 14px var(--shadow);
  transition:.15s;
}
.counter button:active{transform:scale(.96);}

/* ‚úÖ –ö–∞—Ä—É—Å–µ–ª–∏ */
.carousel-wrap{
  padding:6px 12px 4px;
}
.carousel-title{
  font-weight:900;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:8px 2px 8px;
}
.carousel-row{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:2px 2px 12px;
  scroll-behavior:smooth;
}
.c-card{
  min-width:160px;
  border-radius:20px;
  padding:10px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(120,70,20,.12);
  cursor:pointer;
  transition:.15s;
  position:relative;
}
body[data-theme="dark"] .c-card{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.c-card:active{transform:scale(.99);}
.c-img{
  height:82px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(199,107,47,.08);
}
.c-img img{width:100%;height:100%;object-fit:cover;}
.c-name{font-weight:900;margin-top:8px;line-height:1.15;min-height:32px;}
.c-price{font-weight:900;color:var(--meat);margin-top:4px;}
.c-counter{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:8px;}
.c-counter button{
  width:30px;height:30px;border-radius:50%;cursor:pointer;
  border:1px solid rgba(255,255,255,.6);
  background:var(--green);
  color:#fff;
  font-size:16px;
  font-weight:900;
  box-shadow:0 6px 14px var(--shadow);
  transition:.15s;
}
.c-counter button:active{transform:scale(.96);}
.c-counter span{font-weight:900; min-width:18px; text-align:center;}
.c-badge{
  position:absolute;left:10px;top:10px;
  font-size:18px;pointer-events:none;
}

/* ‚úÖ –±–ª–æ–∫ —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–∫–∞–∑–∞ */
.order-help{
  margin:10px 12px 6px;
  padding:12px;
  border-radius:22px;
  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(120,70,20,.12);
}
body[data-theme="dark"] .order-help{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.order-help-head{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  margin-bottom:8px;
}
.order-help-head b{font-size:14px;}
.small-muted{font-size:12px;opacity:.75;line-height:1.35;}
.help-row{
  display:flex;gap:10px;flex-wrap:wrap;
  margin-top:10px;
}
.help-chip{
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  box-shadow: inset 0 0 0 2px var(--inner);
  border-radius:999px;
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
  transition:.15s;
}
body[data-theme="dark"] .help-chip{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.14);}
.help-chip:active{transform:scale(.98);}

.preorder-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
@media (max-width:420px){
  .preorder-grid{grid-template-columns:1fr;}
}
.preorder-grid .input{width:100%;margin:0;}
.preorder-warn{
  margin-top:10px;
  padding:10px 12px;
  border-radius:16px;
  background:rgba(139,30,30,.08);
  border:1px solid rgba(139,30,30,.18);
  font-size:12px;
  font-weight:800;
  color:var(--meat);
  display:none;
}
.preorder-warn.show{display:block;}

/* cart */
.cart{
  background:#fffdf9;
  margin:12px;
  padding:16px;
  border-radius:var(--r-lg);
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(120,70,20,.12);
}
body[data-theme="dark"] .cart{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.cart-lines{margin-top:10px;font-weight:900;}
.line{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  margin-top:6px;
}
.line small{font-weight:800;opacity:.75;}
.line.total{margin-top:10px;padding-top:10px;border-top:1px dashed rgba(199,107,47,.35);}

/* order btn */
.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:var(--r-lg);
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;

  border:1px solid rgba(255,255,255,.55);
  background:linear-gradient(135deg,var(--green),#2e7d32);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.22), 0 10px 22px rgba(31,77,58,.18);
  transition:.15s;
}
.order-btn:active{transform:scale(.99);}

.popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s;z-index:2000;}
.popup.show{opacity:1;pointer-events:auto;}
.popup-box{
  background:white;
  padding:26px;
  border-radius:var(--r-lg);
  text-align:center;
  font-weight:800;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
}
body[data-theme="dark"] .popup-box{background:#1c1c1c;color:#f1f1f1;}

.search-wrap{width:85%;margin:8px auto;position:relative;display:none;z-index:70;}
.search-wrap.show{display:block;}
.search-wrap input{width:100%;margin:0;padding-right:44px;}
.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:30px;
  height:30px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
body[data-theme="dark"] .search-clear{background:rgba(255,255,255,.06); color:#f1f1f1;}
.search-clear:active{transform:translateY(-50%) scale(.96);}
.search-title{width:85%;margin:10px auto 0;font-weight:900;opacity:.9;display:none;z-index:70;position:relative;}
.search-title.show{display:block;}
mark{background:rgba(212,160,23,.25);padding:0 .12em;border-radius:6px;}

.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px;
  background:rgba(248,243,233,.88);
  backdrop-filter: blur(10px);
  z-index:999;
  border-top:1px solid rgba(199,107,47,.25);
}
body[data-theme="dark"] .sticky-checkout{
  background:rgba(18,18,18,.88);
  border-top:1px solid rgba(255,255,255,.12);
}
.sticky-inner{
  max-width:520px;
  margin:0 auto;
  border-radius:18px;
  padding:10px 12px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(120,70,20,.12);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
body[data-theme="dark"] .sticky-inner{background:rgba(255,255,255,.06);}
.sticky-sum{font-weight:900;line-height:1.1;}
.sticky-sum small{display:block;font-weight:800;opacity:.75;margin-top:2px;}
.sticky-btn{
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.55);
  background:linear-gradient(135deg,var(--green),#2e7d32);
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.20), 0 10px 22px rgba(31,77,58,.18);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{transform:scale(.99);}

/* ‚úÖ –æ–∫–Ω–æ –º–µ–Ω—é (sheet) */
.menu-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.38);
  opacity:0;
  pointer-events:none;
  transition:.18s;
  z-index:1000;
}
.menu-backdrop.show{opacity:1;pointer-events:auto;}

.menu-sheet{
  position:fixed;
  left:0; right:0;
  bottom:-100%;
  background:#fffdf9;
  border-top-left-radius:22px;
  border-top-right-radius:22px;
  border:1px solid var(--stroke);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:.22s;
  z-index:1010;
  padding:10px 12px 14px;
}
body[data-theme="dark"] .menu-sheet{ background:#1c1c1c; border-color:rgba(255,255,255,.14); }
.menu-sheet.show{bottom:0;}
.menu-handle{width:44px;height:5px;border-radius:999px;background:rgba(0,0,0,.18);margin:6px auto 10px;}
body[data-theme="dark"] .menu-handle{background:rgba(255,255,255,.18);}
.menu-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.menu-head b{font-size:16px;}
.menu-close{width:38px;height:38px;border:none;border-radius:12px;background:transparent;cursor:pointer;font-size:22px;line-height:1;color:#777;}
body[data-theme="dark"] .menu-close{color:#bbb;}

.menu-list{display:flex;flex-direction:column;gap:8px;}
.menu-item{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:12px 12px;
  border-radius:16px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  cursor:pointer;
  text-decoration:none;
  color:#2b2b2b;
}
body[data-theme="dark"] .menu-item{border-color:rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:#f1f1f1;}
.menu-left{display:flex;align-items:center;gap:10px;min-width:0;}
.menu-ic{width:30px;height:30px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.06);flex:0 0 auto;}
body[data-theme="dark"] .menu-ic{background:rgba(255,255,255,.06);}
.menu-txt{display:flex;flex-direction:column;min-width:0;}
.menu-name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.menu-sub{font-size:12px;opacity:.75;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
.menu-right{opacity:.65;font-weight:900;}

/* ‚úÖ –º–æ–¥–∞–ª–∫–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∏–∫–æ–Ω–∫–∏ + –ø–æ–¥–ø–∏—Å–∏) */
.subcat-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.42);
  display:none;
  z-index:1500;
  padding:18px 14px;
}
.subcat-modal.show{display:block;}
.subcat-card{
  max-width:720px;
  margin:0 auto;
  background:#fffdf9;
  border:1px solid var(--stroke);
  border-radius:22px;
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  padding:12px 12px 14px;
}
body[data-theme="dark"] .subcat-card{
  background:#1c1c1c;
  border-color:rgba(255,255,255,.14);
  color:#f1f1f1;
}
.subcat-head{
  display:flex;align-items:center;justify-content:space-between;
  padding:4px 6px 10px;
}
.subcat-head b{font-size:16px;}
.subcat-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
@media (max-width:420px){
  .subcat-grid{grid-template-columns:repeat(2,1fr);}
}
.subcat-item{
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  border-radius:18px;
  padding:12px 10px;
  cursor:pointer;
  text-align:center;
  transition:.15s;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:8px;
}
body[data-theme="dark"] .subcat-item{
  border-color:rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
}
.subcat-item:active{transform:scale(.99);}
.subcat-ic{
  width:46px;height:46px;border-radius:16px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(199,107,47,.10);
  font-size:24px;
}
body[data-theme="dark"] .subcat-ic{background:rgba(255,255,255,.08);}
.subcat-name{
  font-weight:900;
  font-size:13px;
  line-height:1.15;
}
.subcat-note{
  font-size:12px;
  opacity:.7;
  margin-top:2px;
  text-align:center;
}
</style>
</head>

<body>

<div class="header">
  <img src="images/logo.png" onerror="this.src='logo.png'" alt="CHOKOART logo" />
  <div class="brand-wrap">
    <div class="brand-title">Bakery</div>
    <div class="brand-title2">CHOKOART</div>
    <div class="brand-slogan">BIZ BILAN MAZZALIROQ</div>

    <div class="brand-phone">
      <a href="tel:+998905050745" onclick="callPhone(event)">+998 90 505 07 45</a>
    </div>
  </div>

  <div class="menu-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
    <div class="burger"><span></span><span></span><span></span></div>
  </div>
  <div class="search-btn" onclick="toggleSearch()">üîç</div>
</div>

<div class="menu-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>
<div class="menu-sheet" id="menuSheet">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b>–ú–µ–Ω—é</b>
    <button class="menu-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">
    <div class="menu-item" onclick="openYandexReviews(event)" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚≠ê</div>
        <div class="menu-txt">
          <div class="menu-name">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
          <div class="menu-sub">–Ø–Ω–¥–µ–∫—Å –æ—Ç–∑—ã–≤—ã</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <!-- ‚úÖ —á–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º -->
    <div class="menu-item" onclick="openManagerChat(event)" role="button">
      <div class="menu-left">
        <div class="menu-ic">üí¨</div>
        <div class="menu-txt">
          <div class="menu-name">–ß–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</div>
          <div class="menu-sub" id="managerSub">@chokoart_manager</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <a class="menu-item" href="tel:+998905050745" onclick="closeTopMenu()">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub">+998 90 505 07 45</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <div class="menu-item" onclick="openInstagram(event)" role="button">
      <div class="menu-left">
        <div class="menu-ic">üì∑</div>
        <div class="menu-txt">
          <div class="menu-name">@choko_art_motrid</div>
          <div class="menu-sub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üåì</div>
        <div class="menu-txt">
          <div class="menu-name">–¢–µ–º–∞</div>
          <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
        </div>
      </div>
      <div class="menu-right">–°–º–µ–Ω–∏—Ç—å</div>
    </div>
  </div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..." oninput="searchProducts()" onkeydown="onSearchKey(event)" />
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<!-- ‚úÖ‚úÖ‚úÖ –ö–ê–†–£–°–ï–õ–¨ "–ù–û–í–ò–ù–ö–ò" -->
<div class="carousel-wrap" id="newWrap">
  <div class="carousel-title">
    <div>üÜï <span id="newTitle">–ù–æ–≤–∏–Ω–∫–∏</span></div>
  </div>
  <div class="carousel-row" id="newRow"></div>
</div>

<!-- ‚úÖ‚úÖ‚úÖ –ö–ê–†–£–°–ï–õ–¨ "–î–õ–Ø –ü–û–î–ê–†–ö–ê" -->
<div class="carousel-wrap" id="giftWrap">
  <div class="carousel-title">
    <div>üéÅ <span id="giftTitle">–î–ª—è –ø–æ–¥–∞—Ä–∫–∞</span></div>
  </div>
  <div class="carousel-row" id="giftRow"></div>
</div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input" />
<input id="phone" class="input" />

<!-- ‚úÖ –£–¥–æ–±—Å—Ç–≤–æ –∑–∞–∫–∞–∑–∞ / –ø—Ä–µ–¥–∑–∞–∫–∞–∑ -->
<div class="order-help">
  <div class="order-help-head">
    <b id="helpHead">üóìÔ∏è –ü—Ä–µ–¥–∑–∞–∫–∞–∑ –ø–æ –¥–∞—Ç–µ/–≤—Ä–µ–º–µ–Ω–∏</b>
    <span class="small-muted" id="helpNote">–û—Å–æ–±–µ–Ω–Ω–æ —É–¥–æ–±–Ω–æ –¥–ª—è —Ç–æ—Ä—Ç–æ–≤ –∏ –±–µ–Ω—Ç–æ</span>
  </div>

  <div class="help-row">
    <div class="help-chip" onclick="pickToday()" id="chipToday">–°–µ–≥–æ–¥–Ω—è</div>
    <div class="help-chip" onclick="pickTomorrow()" id="chipTomorrow">–ó–∞–≤—Ç—Ä–∞</div>
    <div class="help-chip" onclick="setTimeQuick('10:00')">10:00</div>
    <div class="help-chip" onclick="setTimeQuick('14:00')">14:00</div>
    <div class="help-chip" onclick="setTimeQuick('18:00')">18:00</div>
  </div>

  <div class="preorder-grid">
    <input id="preDate" class="input" type="date" />
    <input id="preTime" class="input" type="time" />
  </div>

  <div class="preorder-warn" id="preWarn">–î–ª—è —Ç–æ—Ä—Ç–æ–≤/–±–µ–Ω—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞ ‚úÖ</div>
</div>

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<div class="cart" id="cartBox">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
  <textarea id="comment" class="input"></textarea>

  <div class="cart-lines">
    <div class="line">
      <div><small id="lblSubtotal">–°—É–º–º–∞</small></div>
      <div><span id="subtotalNum">0</span> <small>—Å—É–º</small></div>
    </div>
    <div class="line" id="deliveryLine" style="display:none;">
      <div><small id="lblDelivery">–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –°–∞–º–∞—Ä–∫–∞–Ω–¥—É</small></div>
      <div><span id="deliveryFee">10 000</span> <small>—Å—É–º</small></div>
    </div>
    <div class="line total">
      <div><small id="lblTotal">–ò—Ç–æ–≥–æ</small></div>
      <div><span id="grandTotal">0</span> <small>—Å—É–º</small></div>
    </div>
  </div>

  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>

  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
</div>

<div class="popup" id="popup"><div class="popup-box">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div></div>

<div class="sticky-checkout">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small>—Å—É–º</small>
      <small id="stickyHint" style="opacity:.75;">–∏—Ç–æ–≥–æ</small>
    </div>
    <button class="sticky-btn" onclick="openCart()" id="stickyCartBtn">–ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</div>

<!-- ‚úÖ –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
<div class="subcat-modal" id="subcatModal" onclick="subcatBackdropClick(event)">
  <div class="subcat-card">
    <div class="subcat-head">
      <b id="subcatTitle">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</b>
      <button class="menu-close" onclick="closeSubcats()">√ó</button>
    </div>
    <div class="subcat-grid" id="subcatGrid"></div>
    <div class="subcat-note" id="subcatNote"></div>
  </div>
</div>

<script>
Telegram.WebApp.ready();

/* =========================
   ‚úÖ –ù–ê–°–¢–†–û–ô–ö–ò
========================= */
const DELIVERY_FEE_NUM = 10000; // –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –°–∞–º–∞—Ä–∫–∞–Ω–¥—É
const MANAGER_TG_USERNAME = "chokoart_manager"; // ‚ö†Ô∏è –∑–∞–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π username –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–±–µ–∑ @)

/* =========================
   –°–°–´–õ–ö–ò / –î–ï–ô–°–¢–í–ò–Ø
========================= */
function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const tel = "tel:+998905050745";
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(tel);
      return;
    }
  }catch(_){}
  try{ window.location.href = tel; }catch(_){}
}
function openTopMenu(){
  try{ closeSearch(); }catch(_){}
  document.getElementById('menuBackdrop').classList.add('show');
  document.getElementById('menuSheet').classList.add('show');
}
function closeTopMenu(){
  document.getElementById('menuBackdrop').classList.remove('show');
  document.getElementById('menuSheet').classList.remove('show');
}
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = "https://yandex.uz/maps/org/239856130727/?ll=66.960593%2C39.684041&mode=search&sctx=ZAAAAAgBEAAaKAoSCaetEcE4MVFAEfxVgO82QURAEhIJDJQUWABT1j8RPUfku5S6xD8iBgABAgMEBSgKOABA1LoGSAFiJHNuaXBwZXRfZXhwX25hbWU9ZnVsbG9iamVjdHMvMS54OnJlZmIjc25pcHBldF9leHBfbmFtZT10b3BvYmplY3RzLzEueDpyZWZiHnNuaXBwZXRfZXhwX25hbWU9Z29vZHMvMS54OnJlZmInc25pcHBldF9leHBfbmFtZT1nb29kc19yZWdpc3Rlci8xLng6cmVmYgtmcmVzaG5lc3M9MGIXc291cmNlPWJ1c2luZXNzOmV4cF9yZWZiFXNvdXJjZT1wcmljZXM6ZXhwX3JlZmoCdXqdAc3MzD2gAQCoAQC9AXc%2FZizCAQantajE%2FQaCAg9iYWtlcnkgY2hva29hcnSKAgCSAgCaAgxkZXNrdG9wLW1hcHM%3D&sll=66.960593%2C39.684041&sspn=0.013893%2C0.006530&text=bakery%20chokoart&z=16.65";
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}
function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = "https://www.instagram.com/choko_art_motrid/";
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}
function openManagerChat(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  closeTopMenu();
  const url = "https://t.me/" + encodeURIComponent(MANAGER_TG_USERNAME);
  try{
    // –¥–ª—è –º–∏–Ω–∏-–∞–ø–ø–æ–≤ Telegram –∏–Ω–æ–≥–¥–∞ –ª—É—á—à–µ openTelegramLink
    Telegram.WebApp.openTelegramLink?.(url);
    return;
  }catch(_){}
  try{
    Telegram.WebApp.openLink?.(url);
    return;
  }catch(_){}
  window.open(url, "_blank");
}

/* —Ç–µ–º–∞ */
function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('chokoart_theme', theme);
  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (theme === 'dark') ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
  try{
    if (window.Telegram && Telegram.WebApp){
      Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
      Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
    }
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  applyTheme(cur === 'dark' ? 'light' : 'dark');
}
(function initTheme(){
  const saved = localStorage.getItem('chokoart_theme');
  if(saved === 'dark' || saved === 'light'){
    applyTheme(saved);
  }else{
    const tgTheme = (window.Telegram && Telegram.WebApp && Telegram.WebApp.colorScheme) ? Telegram.WebApp.colorScheme : 'light';
    applyTheme(tgTheme === 'dark' ? 'dark' : 'light');
  }
})();

/* Telegram user */
const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

/* —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
let lang='ru';
let mainCat='cheesecakes';
let subCat='all';
let type='delivery';
let payment='cash';
let cart={};

/* —Ç–µ–∫—Å—Ç—ã */
const TEXT={
  ru:{
    delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',
    pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',
    address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
    phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',
    cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',
    order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
    comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',
    cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',
    click:'üí≥ CLICK',
    results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',
    empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è',
    chooseSub:'–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é',
    new:'–ù–æ–≤–∏–Ω–∫–∏',
    gift:'–î–ª—è –ø–æ–¥–∞—Ä–∫–∞',
    preorder:'üóìÔ∏è –ü—Ä–µ–¥–∑–∞–∫–∞–∑ –ø–æ –¥–∞—Ç–µ/–≤—Ä–µ–º–µ–Ω–∏',
    preorderNote:'–û—Å–æ–±–µ–Ω–Ω–æ —É–¥–æ–±–Ω–æ –¥–ª—è —Ç–æ—Ä—Ç–æ–≤ –∏ –±–µ–Ω—Ç–æ',
    today:'–°–µ–≥–æ–¥–Ω—è',
    tomorrow:'–ó–∞–≤—Ç—Ä–∞',
    subtotal:'–°—É–º–º–∞',
    deliveryFee:'–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –°–∞–º–∞—Ä–∫–∞–Ω–¥—É',
    total:'–ò—Ç–æ–≥–æ',
    manager:'–ß–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º'
  },
  uz:{
    delivery:'üöö Yetkazish',
    pickup:'üèÉ Olib ketish',
    address:'üìç Manzil',
    phone:'üìû Telefon',
    cart:'üõí Savat',
    order:'Buyurtma berish',
    comment:'‚úçÔ∏è Izoh',
    cash:'üíµ Naqd',
    click:'üí≥ CLICK',
    results:'Qidiruv natijalari',
    empty:"Savat bo‚Äòsh",
    chooseSub:"Bo‚Äòlimni tanlang",
    new:"Yangiliklar",
    gift:"Sovg‚Äòa uchun",
    preorder:"üóìÔ∏è Sana/vaqt bo‚Äòyicha oldindan buyurtma",
    preorderNote:"Tortlar va bento uchun juda qulay",
    today:"Bugun",
    tomorrow:"Ertaga",
    subtotal:"Summa",
    deliveryFee:"Samarqand bo‚Äòyicha yetkazish",
    total:"Jami",
    manager:"Menejer bilan chat"
  },
  en:{
    delivery:'üöö Delivery',
    pickup:'üèÉ Pickup',
    address:'üìç Address',
    phone:'üìû Phone',
    cart:'üõí Cart',
    order:'Place order',
    comment:'‚úçÔ∏è Comment',
    cash:'üíµ Cash',
    click:'üí≥ CLICK',
    results:'Search results',
    empty:'Cart is empty',
    chooseSub:'Choose a subcategory',
    new:'New',
    gift:'Gift ideas',
    preorder:'üóìÔ∏è Preorder date/time',
    preorderNote:'Especially for cakes & bento',
    today:'Today',
    tomorrow:'Tomorrow',
    subtotal:'Subtotal',
    deliveryFee:'Delivery in Samarkand',
    total:'Total',
    manager:'Chat with manager'
  }
};

/* ‚úÖ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
const MAIN_CATS = [
  {key:'cheesecakes', n:{ru:'üç∞ –ß–∏–∑–∫–µ–π–∫–∏', uz:'üç∞ Chizkeyklar', en:'üç∞ Cheesecakes'}},
  {key:'cakes',       n:{ru:'üéÇ –¢–æ—Ä—Ç—ã', uz:'üéÇ Tortlar', en:'üéÇ Cakes'}},
  {key:'rolls',       n:{ru:'üåØ –†—É–ª–µ—Ç—ã', uz:'üåØ Ruletlar', en:'üåØ Rolls'}},
  {key:'pastry',      n:{ru:'ü•ê –í—ã–ø–µ—á–∫–∞', uz:'ü•ê Pishiriqlar', en:'ü•ê Pastry'}},
  {key:'cookies',     n:{ru:'üç™ –ü–µ—á–µ–Ω—å–µ', uz:'üç™ Pechenye', en:'üç™ Cookies'}},
  {key:'desserts',    n:{ru:'üçÆ –î–µ—Å–µ—Ä—Ç—ã', uz:'üçÆ Desertlar', en:'üçÆ Desserts'}},
  {key:'pies',        n:{ru:'ü•ß –ü–∏—Ä–æ–≥–∏', uz:'ü•ß Piroglar', en:'ü•ß Pies'}}
];

/* ‚úÖ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
const SUBCATS = {
  cakes: [
    {key:'wedding',  icon:'üíç', n:{ru:'–°–≤–∞–¥–µ–±–Ω—ã–µ —Ç–æ—Ä—Ç—ã', uz:'To‚Äòy tortlari', en:'Wedding cakes'}},
    {key:'bento',    icon:'üç±', n:{ru:'–ë–µ–Ω—Ç–æ —Ç–æ—Ä—Ç—ã', uz:'Bento tortlar', en:'Bento cakes'}},
    {key:'roll',     icon:'üåÄ', n:{ru:'–¢–æ—Ä—Ç—ã —Ä—É–ª–µ—Ç—ã', uz:'Rulet tortlar', en:'Roll cakes'}},
    {key:'events',   icon:'üéâ', n:{ru:'–ù–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', uz:'Tadbirlar uchun', en:'Event cakes'}}
  ],
  pastry: [
    {key:'savory',   icon:'üßÄ', n:{ru:'–ù–µ—Å–ª–∞–¥–∫–∞—è', uz:'Shirinmas', en:'Savory'}},
    {key:'sweet',    icon:'ü•Æ', n:{ru:'–°–¥–æ–±–Ω–∞—è', uz:'Sdobali', en:'Sweet buns'}},
    {key:'puff',     icon:'ü•ê', n:{ru:'–°–ª–æ—ë–Ω–∞—è', uz:'Qatlamli', en:'Puff pastry'}}
  ],
  cookies: [
    {key:'shortbread', icon:'üç™', n:{ru:'–ü–µ—Å–æ—á–Ω–æ–µ', uz:'Qumoq', en:'Shortbread'}},
    {key:'filled',     icon:'üç´', n:{ru:'–° –Ω–∞—á–∏–Ω–∫–æ–π', uz:'Nachinkali', en:'Filled cookies'}}
  ],
  desserts: [
    {key:'mousse',  icon:'üçÆ', n:{ru:'–ú—É—Å—Å–æ–≤—ã–µ', uz:'Mussli', en:'Mousse'}},
    {key:'mini',    icon:'üßÅ', n:{ru:'–ú–∏–Ω–∏', uz:'Mini', en:'Mini desserts'}}
  ],
  pies: [
    {key:'sliced',  icon:'üî™', n:{ru:'–ù–∞—Ä–µ–∑–Ω—ã–µ', uz:'Kesilgan', en:'Sliced pies'}},
    {key:'whole',   icon:'ü•ß', n:{ru:'–¶–µ–ª—ã–µ', uz:'Butun', en:'Whole pies'}}
  ]
};

/* ‚úÖ –º–µ–Ω—é (–ø—Ä–∏–º–µ—Ä ‚Äî –∑–∞–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏/—Ñ–æ—Ç–æ) */
const MENU = {
  cheesecakes: { all: [
    {id:'chz_classic', p:45000, img:'images/cheesecake1.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', uz:'Klassik chizkeyk', en:'Classic cheesecake'}},
    {id:'chz_berry',   p:50000, img:'images/cheesecake2.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ —è–≥–æ–¥–Ω—ã–π', uz:'Rezavorli chizkeyk', en:'Berry cheesecake'}}
  ]},
  cakes: {
    wedding: [
      {id:'cake_wed1', p:1200000, img:'images/cake_wed1.png', n:{ru:'–°–≤–∞–¥–µ–±–Ω—ã–π 2 —è—Ä—É—Å–∞', uz:'To‚Äòy torti 2 qavat', en:'Wedding 2-tier'}},
      {id:'cake_wed2', p:1800000, img:'images/cake_wed2.png', n:{ru:'–°–≤–∞–¥–µ–±–Ω—ã–π 3 —è—Ä—É—Å–∞', uz:'To‚Äòy torti 3 qavat', en:'Wedding 3-tier'}}
    ],
    bento: [
      {id:'cake_bento1', p:150000, img:'images/cake_bento1.png', n:{ru:'–ë–µ–Ω—Ç–æ ‚ÄúLove‚Äù', uz:'Bento ‚ÄúLove‚Äù', en:'Bento ‚ÄúLove‚Äù'}},
      {id:'cake_bento2', p:150000, img:'images/cake_bento2.png', n:{ru:'–ë–µ–Ω—Ç–æ ‚ÄúHappy‚Äù', uz:'Bento ‚ÄúHappy‚Äù', en:'Bento ‚ÄúHappy‚Äù'}}
    ],
    roll: [
      {id:'cake_roll1', p:220000, img:'images/cake_roll1.png', n:{ru:'–¢–æ—Ä—Ç-—Ä—É–ª–µ—Ç —à–æ–∫–æ–ª–∞–¥', uz:'Shokolad rulet', en:'Chocolate roll cake'}},
      {id:'cake_roll2', p:220000, img:'images/cake_roll2.png', n:{ru:'–¢–æ—Ä—Ç-—Ä—É–ª–µ—Ç –≤–∞–Ω–∏–ª—å', uz:'Vanil rulet', en:'Vanilla roll cake'}}
    ],
    events: [
      {id:'cake_event1', p:650000, img:'images/cake_event1.png', n:{ru:'–¢–æ—Ä—Ç –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 1', uz:'Tadbir torti 1', en:'Event cake 1'}},
      {id:'cake_event2', p:650000, img:'images/cake_event2.png', n:{ru:'–¢–æ—Ä—Ç –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 2', uz:'Tadbir torti 2', en:'Event cake 2'}}
    ]
  },
  rolls: { all: [
    {id:'roll_choco', p:110000, img:'images/roll1.png', n:{ru:'–†—É–ª–µ—Ç —à–æ–∫–æ–ª–∞–¥–Ω—ã–π', uz:'Shokolad rulet', en:'Chocolate roll'}},
    {id:'roll_berry', p:110000, img:'images/roll2.png', n:{ru:'–†—É–ª–µ—Ç —è–≥–æ–¥–Ω—ã–π', uz:'Rezavorli rulet', en:'Berry roll'}}
  ]},
  pastry: {
    savory: [
      {id:'pas_sav1', p:25000, img:'images/pas_sav1.png', n:{ru:'–ö–∏—à', uz:'Kish', en:'Quiche'}},
      {id:'pas_sav2', p:22000, img:'images/pas_sav2.png', n:{ru:'–°–∞–º—Å–∞', uz:'Somsa', en:'Samsa'}}
    ],
    sweet: [
      {id:'pas_swe1', p:18000, img:'images/pas_swe1.png', n:{ru:'–ë—É–ª–æ—á–∫–∞', uz:'Bulochka', en:'Sweet bun'}},
      {id:'pas_swe2', p:20000, img:'images/pas_swe2.png', n:{ru:'–ö—Ä—É–∞—Å—Å–∞–Ω', uz:'Kruassan', en:'Croissant'}}
    ],
    puff: [
      {id:'pas_puf1', p:22000, img:'images/pas_puf1.png', n:{ru:'–°–ª–æ—ë–Ω—ã–π –ø–∏—Ä–æ–∂–æ–∫', uz:'Qatlamli pirojok', en:'Puff pie'}},
      {id:'pas_puf2', p:24000, img:'images/pas_puf2.png', n:{ru:'–°–ª–æ–π–∫–∞ —Å –∫—Ä–µ–º–æ–º', uz:'Kremli qatlama', en:'Cream puff pastry'}}
    ]
  },
  cookies: {
    shortbread: [
      {id:'ck_sh1', p:35000, img:'images/cookie1.png', n:{ru:'–ü–µ—Å–æ—á–Ω–æ–µ –∞—Å—Å–æ—Ä—Ç–∏', uz:'Qumoq assorti', en:'Shortbread mix'}},
      {id:'ck_sh2', p:35000, img:'images/cookie2.png', n:{ru:'–ü–µ—Å–æ—á–Ω–æ–µ –≤–∞–Ω–∏–ª—å', uz:'Vanilli qumoq', en:'Vanilla shortbread'}}
    ],
    filled: [
      {id:'ck_f1', p:40000, img:'images/cookie3.png', n:{ru:'–° –Ω–∞—á–∏–Ω–∫–æ–π —à–æ–∫–æ–ª–∞–¥', uz:'Shokoladli', en:'Chocolate filled'}},
      {id:'ck_f2', p:40000, img:'images/cookie4.png', n:{ru:'–° –Ω–∞—á–∏–Ω–∫–æ–π –∫–∞—Ä–∞–º–µ–ª—å', uz:'Karamelli', en:'Caramel filled'}}
    ]
  },
  desserts: {
    mousse: [
      {id:'ds_m1', p:55000, img:'images/dessert1.png', n:{ru:'–ú—É—Å—Å –º–∞–Ω–≥–æ', uz:'Mango muss', en:'Mango mousse'}},
      {id:'ds_m2', p:55000, img:'images/dessert2.png', n:{ru:'–ú—É—Å—Å –∫–ª—É–±–Ω–∏–∫–∞', uz:'Qulupnay muss', en:'Strawberry mousse'}}
    ],
    mini: [
      {id:'ds_mi1', p:25000, img:'images/mini1.png', n:{ru:'–ú–∏–Ω–∏ –¥–µ—Å–µ—Ä—Ç 1', uz:'Mini desert 1', en:'Mini dessert 1'}},
      {id:'ds_mi2', p:25000, img:'images/mini2.png', n:{ru:'–ú–∏–Ω–∏ –¥–µ—Å–µ—Ä—Ç 2', uz:'Mini desert 2', en:'Mini dessert 2'}}
    ]
  },
  pies: {
    sliced: [
      {id:'pie_s1', p:180000, img:'images/pie_s1.png', n:{ru:'–ù–∞—Ä–µ–∑–Ω–æ–π –ø–∏—Ä–æ–≥ 1', uz:'Kesilgan pirog 1', en:'Sliced pie 1'}},
      {id:'pie_s2', p:180000, img:'images/pie_s2.png', n:{ru:'–ù–∞—Ä–µ–∑–Ω–æ–π –ø–∏—Ä–æ–≥ 2', uz:'Kesilgan pirog 2', en:'Sliced pie 2'}}
    ],
    whole: [
      {id:'pie_w1', p:220000, img:'images/pie_w1.png', n:{ru:'–¶–µ–ª—ã–π –ø–∏—Ä–æ–≥ 1', uz:'Butun pirog 1', en:'Whole pie 1'}},
      {id:'pie_w2', p:220000, img:'images/pie_w2.png', n:{ru:'–¶–µ–ª—ã–π –ø–∏—Ä–æ–≥ 2', uz:'Butun pirog 2', en:'Whole pie 2'}}
    ]
  }
};

/* ‚úÖ –∫–∞—Ä—É—Å–µ–ª–∏ –ø–æ ID (–º–µ–Ω—è–π –∫–∞–∫ —Ö–æ—á–µ—à—å) */
const NEW_ITEMS = ['cake_bento1','ds_m1','chz_berry','pas_puf2'];
const GIFT_ITEMS = ['cake_bento2','ck_f1','ds_mi1','pie_w1'];

/* –∏–Ω–¥–µ–∫—Å */
const ITEM_INDEX = {};
for(const mc in MENU){
  for(const sc in MENU[mc]){
    (MENU[mc][sc]||[]).forEach(it => ITEM_INDEX[it.id] = it);
  }
}

/* helpers */
function nameOf(id){
  const it = ITEM_INDEX[id];
  if(!it) return id;
  return (it.n && (it.n[lang] || it.n.ru)) || id;
}
function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function highlight(name, q){
  const n = escapeHtml(name);
  if(!q) return n;
  const idx = n.toLowerCase().indexOf(q.toLowerCase());
  if(idx === -1) return n;
  const before = n.slice(0, idx);
  const mid = n.slice(idx, idx + q.length);
  const after = n.slice(idx + q.length);
  return `${before}<mark>${mid}</mark>${after}`;
}

/* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞/—Ç–µ–ª */
function loadSaved(){
  const a = localStorage.getItem('chokoart_address') || '';
  const p = localStorage.getItem('chokoart_phone') || '';
  if(a && !address.value) address.value = a;
  if(p && !phone.value) phone.value = p;

  // –ø—Ä–µ–¥–∑–∞–∫–∞–∑
  const d = localStorage.getItem('chokoart_pre_date') || '';
  const t = localStorage.getItem('chokoart_pre_time') || '';
  if(d && !preDate.value) preDate.value = d;
  if(t && !preTime.value) preTime.value = t;
}
function bindSave(){
  address.addEventListener('input', ()=>localStorage.setItem('chokoart_address', address.value));
  phone.addEventListener('input', ()=>localStorage.setItem('chokoart_phone', phone.value));
  preDate.addEventListener('input', ()=>localStorage.setItem('chokoart_pre_date', preDate.value));
  preTime.addEventListener('input', ()=>localStorage.setItem('chokoart_pre_time', preTime.value));
}

/* –¥–æ—Å—Ç–∞–≤–∫–∞/—Å–∞–º–æ–≤—ã–≤–æ–∑ */
function updateTypeFields(){
  if(type === 'pickup'){
    address.style.display = 'none';
    address.value = '';
  }else{
    address.style.display = 'block';
  }
  updateTotal();
}

/* ‚úÖ –ø—Ä–µ–¥–∑–∞–∫–∞–∑: min date = today */
function isoToday(){
  const d = new Date();
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}
function isoTomorrow(){
  const d = new Date();
  d.setDate(d.getDate()+1);
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}
function pickToday(){ preDate.value = isoToday(); localStorage.setItem('chokoart_pre_date', preDate.value); }
function pickTomorrow(){ preDate.value = isoTomorrow(); localStorage.setItem('chokoart_pre_date', preDate.value); }
function setTimeQuick(t){ preTime.value = t; localStorage.setItem('chokoart_pre_time', preTime.value); }
function updatePreWarn(){
  const isCakes = (mainCat === 'cakes');
  const isBento = (mainCat === 'cakes' && subCat === 'bento');
  const shouldShow = isCakes || isBento;
  if(!shouldShow){ preWarn.classList.remove('show'); return; }
  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–ª–∏
  if(!preDate.value || !preTime.value) preWarn.classList.add('show');
  else preWarn.classList.remove('show');
}

/* —è–∑—ã–∫ */
function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}
function applyLang(){
  btnDelivery.innerText=TEXT[lang].delivery;
  btnPickup.innerText=TEXT[lang].pickup;
  address.placeholder=TEXT[lang].address;
  phone.placeholder=TEXT[lang].phone;
  cartTitle.innerText=TEXT[lang].cart;
  orderBtn.innerText=TEXT[lang].order;
  comment.placeholder=TEXT[lang].comment;
  payCash.innerText=TEXT[lang].cash;
  payClick.innerText=TEXT[lang].click;
  searchTitle.innerText = TEXT[lang].results;
  stickyCartBtn.innerText = TEXT[lang].cart;

  // preorder texts
  helpHead.innerText = TEXT[lang].preorder;
  helpNote.innerText = TEXT[lang].preorderNote;
  chipToday.innerText = TEXT[lang].today;
  chipTomorrow.innerText = TEXT[lang].tomorrow;

  // cart labels
  lblSubtotal.innerText = TEXT[lang].subtotal;
  lblDelivery.innerText = TEXT[lang].deliveryFee;
  lblTotal.innerText = TEXT[lang].total;

  // carousels
  newTitle.innerText = TEXT[lang].new;
  giftTitle.innerText = TEXT[lang].gift;

  // manager sub
  managerSub.innerText = '@' + MANAGER_TG_USERNAME;

  renderCarousels();
  renderCats();
  renderProducts();
  updateTotal();
  updateTypeFields();
  updatePreWarn();
}

/* –∫–æ—Ä–∑–∏–Ω–∞ */
function openCart(){
  try{ cartBox.scrollIntoView({behavior:'smooth', block:'start'}); }
  catch(_){ window.location.hash = '#cartBox'; }
}

/* ‚úÖ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî –º–æ–¥–∞–ª–∫–∞ */
function renderCats(){
  cats.innerHTML='';
  MAIN_CATS.forEach(c=>{
    const isActive = (c.key === mainCat);
    cats.innerHTML += `<button class="btn ${isActive?'active':''}" onclick="onMainCatClick('${c.key}')">${(c.n[lang]||c.n.ru)}</button>`;
  });

  setTimeout(()=>{
    const active = cats.querySelector('.btn.active');
    if(active && active.scrollIntoView){
      active.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
    }
  }, 50);
}
function onMainCatClick(key){
  if(isSearchOpen()) closeSearch();
  mainCat = key;
  subCat = 'all';
  const hasSubs = !!SUBCATS[key];
  renderCats();
  if(hasSubs) openSubcats(key);
  else renderProducts();
  updatePreWarn();
}

/* –º–æ–¥–∞–ª–∫–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π */
function openSubcats(key){
  const list = SUBCATS[key] || [];
  const title = (MAIN_CATS.find(x=>x.key===key)?.n?.[lang]) || (MAIN_CATS.find(x=>x.key===key)?.n?.ru) || '–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
  subcatTitle.innerText = title;
  subcatNote.innerText = TEXT[lang].chooseSub;

  subcatGrid.innerHTML = '';
  list.forEach(sc=>{
    const nm = (sc.n && (sc.n[lang] || sc.n.ru)) || sc.key;
    subcatGrid.innerHTML += `
      <div class="subcat-item" onclick="pickSubcat('${key}','${sc.key}')">
        <div class="subcat-ic">${sc.icon || 'üì¶'}</div>
        <div class="subcat-name">${escapeHtml(nm)}</div>
      </div>
    `;
  });

  subcatModal.classList.add('show');
}
function closeSubcats(){ subcatModal.classList.remove('show'); }
function subcatBackdropClick(e){ if(e.target && e.target.id === 'subcatModal') closeSubcats(); }
function pickSubcat(mk, sk){
  mainCat = mk;
  subCat = sk;
  closeSubcats();
  renderCats();
  renderProducts();
  updatePreWarn();
}

/* —Ç–æ–≤–∞—Ä—ã */
function cardHTML(it, q=''){
  const id = it.id;
  const displayName = nameOf(id);
  const nameHtml = highlight(displayName, q);
  const qty = cart[id] || 0;

  return `<div class="card">
    <div class="img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
    <div class="item-name">${nameHtml}</div>
    <div class="price">${formatSum(it.p)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button onclick="chg('${id}',-1)">‚àí</button>
      <span id="c_${id}">${qty}</span>
      <button onclick="chg('${id}',1)">+</button>
    </div>
  </div>`;
}
function currentItems(){
  const block = MENU[mainCat] || {};
  if(block[subCat]) return block[subCat];
  if(block.all) return block.all;
  return [];
}
function renderProducts(){
  products.innerHTML='';
  const items = currentItems();
  items.forEach((it)=>{
    cart[it.id]=cart[it.id]||0;
    products.innerHTML += cardHTML(it,'');
  });
}

/* ‚úÖ –∫–∞—Ä—É—Å–µ–ª–∏ */
function cCardHTML(id, badge){
  const it = ITEM_INDEX[id];
  if(!it) return '';
  cart[id]=cart[id]||0;
  const nm = escapeHtml(nameOf(id));
  return `
    <div class="c-card" onclick="onCarouselCardClick(event,'${id}')">
      <div class="c-badge">${badge}</div>
      <div class="c-img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
      <div class="c-name">${nm}</div>
      <div class="c-price">${formatSum(it.p)} <small>—Å—É–º</small></div>
      <div class="c-counter">
        <button type="button" onclick="cChg(event,'${id}',-1)">‚àí</button>
        <span id="cc_${id}">${cart[id]||0}</span>
        <button type="button" onclick="cChg(event,'${id}',1)">+</button>
      </div>
    </div>
  `;
}
function renderCarousels(){
  newRow.innerHTML = '';
  giftRow.innerHTML = '';

  NEW_ITEMS.forEach(id => { newRow.innerHTML += cCardHTML(id,'üÜï'); });
  GIFT_ITEMS.forEach(id => { giftRow.innerHTML += cCardHTML(id,'üéÅ'); });

  // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –ø—É—Å—Ç–æ ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫
  newWrap.style.display = NEW_ITEMS.length ? '' : 'none';
  giftWrap.style.display = GIFT_ITEMS.length ? '' : 'none';

  // –æ–±–Ω–æ–≤–∏–º —Å—á–µ—Ç—á–∏–∫–∏
  syncCarouselCounters();
}
function syncCarouselCounters(){
  [...NEW_ITEMS, ...GIFT_ITEMS].forEach(id=>{
    const el = document.getElementById('cc_'+id);
    if(el) el.innerText = cart[id] || 0;
  });
}
function onCarouselCardClick(e,id){
  if(e && e.target && (e.target.closest && e.target.closest('button'))) return;
  chg(id, 1);
  syncCarouselCounters();
  if(isSearchOpen()) closeSearch();
}
function cChg(e,id,delta){
  if(e){ e.preventDefault(); e.stopPropagation(); }
  chg(id, delta);
  syncCarouselCounters();
  if(isSearchOpen()) closeSearch();
}

/* –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ */
function chg(id,v){
  cart[id]=Math.max(0,(cart[id]||0)+v);
  const el = document.getElementById('c_'+id);
  if(el) el.innerText=cart[id];
  updateTotal();
  syncCarouselCounters();
}
function price(id){
  return (ITEM_INDEX[id] && ITEM_INDEX[id].p) ? ITEM_INDEX[id].p : 0;
}

/* ‚úÖ –∏—Ç–æ–≥–∏ + –¥–æ—Å—Ç–∞–≤–∫–∞ */
function cartHasItems(){
  for(const id in cart) if((cart[id]||0)>0) return true;
  return false;
}
function calcSubtotalNum(){
  let s=0;
  for(let id in cart) s += (cart[id]||0) * price(id);
  return s;
}
function getDeliveryFee(){
  // –¥–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω delivery –∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã
  if(type === 'delivery' && cartHasItems()) return DELIVERY_FEE_NUM;
  return 0;
}
function updateTotal(){
  const subtotal = calcSubtotalNum();
  const deliveryFeeNum = getDeliveryFee();
  const grand = subtotal + deliveryFeeNum;

  subtotalNum.innerText = formatSum(subtotal);
  deliveryFee.innerText = formatSum(DELIVERY_FEE_NUM);

  if(type === 'delivery' && cartHasItems()){
    deliveryLine.style.display = '';
  }else{
    deliveryLine.style.display = 'none';
  }

  total.innerText = formatSum(grand);
  grandTotal.innerText = formatSum(grand);
  stickyTotal.innerText = formatSum(grand);
}

/* –¥–æ—Å—Ç–∞–≤–∫–∞/–æ–ø–ª–∞—Ç–∞ */
function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  updateTypeFields();
}
function setPayment(p){
  payment=p;
  payCash.classList.toggle('active',p==='cash');
  payClick.classList.toggle('active',p==='click');
}

/* –ø–æ–∏—Å–∫ */
function isSearchOpen(){ return searchWrap.classList.contains('show'); }
function toggleSearch(){ if(isSearchOpen()) closeSearch(); else openSearch(); }
function openSearch(){
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  cats.style.display = 'none';
  newWrap.style.display = 'none';
  giftWrap.style.display = 'none';
  searchInput.value = '';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  cats.style.display = '';
  newWrap.style.display = '';
  giftWrap.style.display = '';
  searchInput.value = '';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key === 'Enter') closeSearch(); }

function searchProducts(){
  const q = (searchInput.value || '').trim().toLowerCase();
  products.innerHTML='';
  if(!q){ renderProducts(); return; }

  for(const mc in MENU){
    for(const sc in MENU[mc]){
      (MENU[mc][sc]||[]).forEach(it=>{
        const nmRu = (it.n && it.n.ru) ? String(it.n.ru).toLowerCase() : '';
        const nmUz = (it.n && it.n.uz) ? String(it.n.uz).toLowerCase() : '';
        const nmEn = (it.n && it.n.en) ? String(it.n.en).toLowerCase() : '';
        const nmCur = (it.n && it.n[lang]) ? String(it.n[lang]).toLowerCase() : '';
        if(nmCur.includes(q) || nmRu.includes(q) || nmUz.includes(q) || nmEn.includes(q)){
          cart[it.id]=cart[it.id]||0;
          products.innerHTML += cardHTML(it, q);
        }
      });
    }
  }
}
document.addEventListener('click', (e)=>{
  if(!isSearchOpen()) return;
  const t = e.target;
  const insideSearch = searchWrap.contains(t) || searchTitle.contains(t);
  const onBtn = t.closest && t.closest('.search-btn');
  if(!insideSearch && !onBtn) closeSearch();
}, true);

/* order id */
function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `chokoart_seq_${d.getFullYear()}${mm}${dd}`;
  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));
  const num = String(n).padStart(3,'0');
  return `CHK-${dd}${mm}-${num}`;
}

function sendOrder(){
  popup.classList.add('show');

  const items = [];
  for (const id in cart) {
    const qty = Number(cart[id] || 0);
    if (qty > 0) {
      const it = ITEM_INDEX[id] || {};
      items.push({
        id,
        qty,
        price: it.p || 0,
        name_ru: (it.n && it.n.ru) ? it.n.ru : id,
        name_lang: nameOf(id)
      });
    }
  }

  if (items.length === 0) {
    popup.classList.remove('show');
    alert(TEXT[lang].empty);
    return;
  }

  const subtotal = calcSubtotalNum();
  const delivery_fee_num = getDeliveryFee();
  const grand_total_num = subtotal + delivery_fee_num;

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    items,

    // —Ñ–∏–Ω–∞–Ω—Å—ã
    subtotal_num: subtotal,
    delivery_fee_num,
    total_num: grand_total_num,
    total_text: formatSum(grand_total_num),

    payment,
    type,

    // –¥–æ—Å—Ç–∞–≤–∫–∞/–∫–æ–Ω—Ç–∞–∫—Ç—ã
    address: (type==='pickup' ? '' : address.value),
    phone: phone.value,
    comment: comment.value,

    // –ø—Ä–µ–¥–∑–∞–∫–∞–∑
    preorder_date: preDate.value,
    preorder_time: preTime.value,

    // –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    main_category: mainCat,
    sub_category: subCat,

    order_id: genOrderId(),
    lang
  };

  setTimeout(()=>{
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  }, 700);
}

/* init */
(function initPreorderMin(){
  preDate.min = isoToday();
})();
function updateTypeFieldsInit(){
  updateTypeFields();
  updateTotal();
}

loadSaved();
bindSave();
applyLang();
updateTypeFieldsInit();
updatePreWarn();
preDate.addEventListener('input', updatePreWarn);
preTime.addEventListener('input', updatePreWarn);
</script>

</body>
</html>
