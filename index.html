<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Bakery CHOKOART</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#F8F3E9;
  --pink:#F6B7C7;
  --pink-2:#F2A7BC;
  --pink-deep:#C56C86;

  --accent-red:#8B1E1E;
  --stroke: rgba(0,0,0,.08);
  --stroke-strong: rgba(0,0,0,.14);
  --inner: rgba(255,255,255,.70);
  --shadow: rgba(0,0,0,.10);
  --shadow-strong: rgba(0,0,0,.18);

  --r-lg:24px;
  --r-md:22px;
  --r-pill:28px;

  --vh: 1vh;

  /* ‚úÖ –≤—ã—Å–æ—Ç–∞ –Ω–∏–∂–Ω–µ–π —Ñ–∏–∫—Å-–ø–∞–Ω–µ–ª–∏ (—á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–æ—Å—å) */
  --sticky-h: 86px;
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;}

body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:var(--bg);
  color:#2b2b2b;

  min-height: calc(var(--vh) * 100);

  overflow-y:auto;
  overflow-x:hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: none;

  /* ‚úÖ –∑–∞–ø–∞—Å —Å–Ω–∏–∑—É –ø–æ–¥ —Ñ–∏–∫—Å-–ø–∞–Ω–µ–ª—å */
  padding-bottom: calc(var(--sticky-h) + 16px);

  -webkit-text-size-adjust:100%;
}

body[data-theme="dark"]{
  --bg:#121212;
  --stroke: rgba(255,255,255,.14);
  --stroke-strong: rgba(255,255,255,.22);
  --inner: rgba(255,255,255,.06);
  --shadow: rgba(0,0,0,.28);
  --shadow-strong: rgba(0,0,0,.45);
  color:#f1f1f1;
}

.page{max-width:560px;margin:0 auto;}

/* header */
.header{
  padding:16px 12px 26px;
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  color:white;
  box-shadow:0 10px 26px rgba(0,0,0,.18);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  text-align:center;
}
.header img{
  position:absolute;
  left:12px;
  width:84px;
  height:84px;
  object-fit:contain;
  border-radius:18px;
  background:rgba(255,255,255,.10);
  padding:8px;
  border:1px solid rgba(255,255,255,.22);
  box-shadow:0 12px 26px rgba(0,0,0,.14);
}
.brand-wrap{display:flex;flex-direction:column;align-items:center;gap:2px;transform: translateX(16px);}
.brand-title{font-family:'Lobster',cursive;font-size:34px;line-height:1;letter-spacing:.2px;}
.brand-title2{font-family:'Montserrat',sans-serif;font-weight:900;font-size:20px;letter-spacing:2px;line-height:1.1;}
.brand-slogan{
  font-family:'Montserrat',sans-serif;
  font-size:12px;
  font-weight:800;
  letter-spacing:1.2px;
  opacity:.92;
  margin-top:2px;
  text-transform:uppercase;
}
.brand-phone{position:relative; z-index:50; pointer-events:auto; margin-top:4px; display:flex; flex-direction:column; gap:2px;}
.brand-phone a{
  color:white;text-decoration:none;font-size:14px;font-weight:800;
  position:relative;z-index:51;pointer-events:auto;cursor:pointer;opacity:.95;
}

/* right actions */
.header-actions{
  position:absolute;
  right:8px;
  top:10px;
  bottom:10px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  align-items:flex-end;
  z-index:90;
}
.act-btn{
  width:36px;height:36px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;user-select:none;
  background:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.55), 0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.act-btn:active{transform:scale(.97);}
.burger{width:20px;height:14px;position:relative;}
.burger span{position:absolute;left:0;right:0;height:3px;border-radius:10px;background:#222;opacity:.9;}
.burger span:nth-child(1){top:0;}
.burger span:nth-child(2){top:5.5px;}
.burger span:nth-child(3){bottom:0;}
.act-ico{font-size:16px;line-height:1;color:#222;}

/* buttons */
.langs,.types,.payments{display:flex;gap:12px;padding:12px;justify-content:center;}
.btn{
  padding:12px 20px;border-radius:28px;font-weight:900;min-width:120px;text-align:center;
  cursor:pointer;transition:.15s;border:1px solid var(--stroke);background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  color: var(--accent-red);
}
body[data-theme="dark"] .btn{background:rgba(255,255,255,.06);color:var(--accent-red);}
.btn:active{transform:scale(.98);}
.btn.active{
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:white;border:1px solid rgba(255,255,255,.35);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.14), 0 10px 22px rgba(197,108,134,.28);
}
.cat-btn{padding:12px 18px;min-width:132px;font-size:14px;border-radius:999px;}

.input{
  margin:8px auto;display:block;padding:14px;width:85%;
  border-radius:22px;font-size:15px;border:1px solid var(--stroke);background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  outline:none;transition:.15s;
}
body[data-theme="dark"] .input{background:rgba(255,255,255,.06);color:#f1f1f1;}

.categories{display:flex;gap:12px;padding:14px;overflow-x:auto;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;overscroll-behavior-x:contain;}
.products{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;padding:12px;}
.card{
  border-radius:24px;padding:12px;text-align:center;background:#fffdf9;border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  transition:.15s;
}
body[data-theme="dark"] .card{background:rgba(255,255,255,.06);color:#f1f1f1;}
.img{height:140px;display:flex;align-items:center;justify-content:center;margin-bottom:6px;}
.img img{max-width:125px;max-height:125px;object-fit:contain;transform:scale(1.05);transition:.15s;cursor:pointer;}
.item-name{margin-top:2px;padding:0 6px;font-weight:900;line-height:1.15;min-height:34px;display:flex;align-items:center;justify-content:center;word-break:break-word;}
.price{font-weight:900;color:var(--accent-red);margin-top:6px;}
.price small{font-weight:800;opacity:.75;margin-left:4px;}
.counter{display:flex;justify-content:center;gap:10px;margin-top:8px;align-items:center;}
.counter button{
  width:32px;height:32px;border-radius:50%;cursor:pointer;border:1px solid rgba(255,255,255,.35);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:#fff;font-size:18px;font-weight:900;box-shadow:0 10px 22px rgba(0,0,0,.12);
  transition:.15s;
}
.counter button:active{transform:scale(.96);}

/* carousels */
.popular-wrap{width:100%;padding:4px 12px 6px;}
.popular-title{width:100%;font-weight:900;padding:8px 2px 10px;display:flex;align-items:center;gap:8px;}
.popular-row,.mini-row{display:flex;gap:12px;overflow-x:auto;padding:2px 2px 10px;-webkit-overflow-scrolling:touch;}
.pop-card,.mini-card{
  min-width:150px;border-radius:24px;padding:10px;background:#fffdf9;border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  cursor:pointer;transition:.15s;position:relative;
}
body[data-theme="dark"] .pop-card, body[data-theme="dark"] .mini-card{background:rgba(255,255,255,.06); color:#f1f1f1;}
.pop-img,.mini-img{height:74px;border-radius:18px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:rgba(197,108,134,.10);cursor:pointer;}
.pop-img img,.mini-img img{width:100%;height:100%;object-fit:cover;}
.pop-name{font-weight:900;margin-top:8px;}
.pop-price,.mini-price{font-weight:900;color:var(--accent-red);margin-top:4px;}
.pop-badge,.mini-badge{position:absolute;left:10px;top:10px;font-size:18px;pointer-events:none;}
.pop-counter,.mini-counter{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:8px;}
.pop-counter button,.mini-counter button{
  width:30px;height:30px;border-radius:50%;cursor:pointer;border:1px solid rgba(255,255,255,.35);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:#fff;font-size:18px;font-weight:900;box-shadow:0 10px 22px rgba(0,0,0,.12);
}
.mini-card{min-width:132px;border-radius:22px;}
.mini-counter button{width:28px;height:28px;}
.mini-name{font-weight:900;margin-top:8px;font-size:12px;line-height:1.15;min-height:28px;}
.pop-counter span,.mini-counter span{font-weight:900; min-width:18px; text-align:center;}

/* cart */
.cart{
  background:#fffdf9;margin:12px;padding:16px;border-radius:24px;border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
}
body[data-theme="dark"] .cart{ background:rgba(255,255,255,.06); color:#f1f1f1; }
textarea.input{height:90px;}
.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:24px;
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.14);
  position:relative;
  z-index:2;

  /* ‚úÖ –≤–∞–∂–Ω–æ–µ: —á—Ç–æ–±—ã –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ —è–∫–æ—Ä–µ–º –∫–Ω–æ–ø–∫–∞ –Ω–µ –ø—Ä—è—Ç–∞–ª–∞—Å—å */
  scroll-margin-bottom: calc(var(--sticky-h) + 24px);
}

/* ‚úÖ‚úÖ‚úÖ –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
   –¥–∞—ë–º –∫–æ—Ä–∑–∏–Ω–µ –¥–æ–ø. "–Ω–∏–∑" –≤–Ω—É—Ç—Ä–∏, —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" –±—ã–ª–∞ –≤—ã—à–µ fixed –ø–∞–Ω–µ–ª–∏ */
#cartBox{
  scroll-margin-bottom: calc(var(--sticky-h) + 24px);
  padding-bottom: calc(16px + var(--sticky-h));
}

/* popup */
.popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s;}
.popup.show{opacity:1;pointer-events:auto;}
.popup-box{
  background:white;padding:26px;border-radius:24px;text-align:center;font-weight:800;border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
}
body[data-theme="dark"] .popup-box{ background:#1c1c1c; color:#f1f1f1; }

/* ‚úÖ –§–û–¢–û-–ú–û–î–ê–õ–ö–ê (–æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ç–æ –ø–æ –∫–ª–∏–∫—É) */
.img-modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.62);
  display:flex; align-items:center; justify-content:center;
  opacity:0; pointer-events:none;
  transition:.18s;
  z-index:2000;
  padding:18px;
}
.img-modal.show{opacity:1;pointer-events:auto;}
.img-modal-box{
  width:min(520px, 100%);
  border-radius:22px;
  overflow:hidden;
  background:#fff;
  border:1px solid rgba(255,255,255,.22);
  box-shadow:0 18px 44px rgba(0,0,0,.22);
}
body[data-theme="dark"] .img-modal-box{background:#1c1c1c;}
.img-modal-top{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px;
  padding:12px 12px;
  background:rgba(0,0,0,.04);
}
body[data-theme="dark"] .img-modal-top{background:rgba(255,255,255,.06);}
.img-modal-title{
  font-weight:900;
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.img-modal-close{
  width:38px;height:38px;border:none;border-radius:14px;
  background:transparent; cursor:pointer;
  font-size:22px; line-height:1;
  color:#666;
}
body[data-theme="dark"] .img-modal-close{color:#bbb;}
.img-modal-img{
  width:100%;
  max-height:70vh;
  object-fit:contain;
  background:#fff;
  display:block;
}
body[data-theme="dark"] .img-modal-img{background:#111;}

/* ‚úÖ —Ñ–∏–∫—Å –ø–∞–Ω–µ–ª—å —Å–Ω–∏–∑—É */
.sticky-checkout{
  position:fixed;
  left:0;right:0;bottom:0;
  padding:10px 12px;
  background:rgba(248,243,233,.88);
  backdrop-filter: blur(10px);
  z-index:999;
  border-top:1px solid rgba(0,0,0,.06);
  height: var(--sticky-h);
  display:flex;
  align-items:center;
}
body[data-theme="dark"] .sticky-checkout{background:rgba(18,18,18,.88);border-top:1px solid rgba(255,255,255,.12);}

.sticky-inner{
  max-width:520px;margin:0 auto;border-radius:18px;padding:10px 12px;background:#fffdf9;border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  width:100%;
}
body[data-theme="dark"] .sticky-inner{background:rgba(255,255,255,.06);}
.sticky-sum{font-weight:900;line-height:1.1;}
.sticky-sum small{display:block;font-weight:800;opacity:.75;margin-top:2px;}
.sticky-btn{
  padding:12px 14px;border-radius:16px;border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  color:#fff;font-weight:900;cursor:pointer;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.14);
}

/* menu sheet */
.menu-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);opacity:0;pointer-events:none;transition:.18s;z-index:1000;}
.menu-backdrop.show{opacity:1;pointer-events:auto;}
.menu-sheet{
  position:fixed;left:0; right:0;bottom:-100%;
  background:#fffdf9;border-top-left-radius:22px;border-top-right-radius:22px;border:1px solid var(--stroke);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:.22s;z-index:1010;padding:10px 12px 14px;
  max-height: 86vh;overflow:auto;-webkit-overflow-scrolling:touch;
}
body[data-theme="dark"] .menu-sheet{background:#1c1c1c;border-color:rgba(255,255,255,.14);}
.menu-sheet.show{bottom:0;}
.menu-handle{width:44px;height:5px;border-radius:999px;background:rgba(0,0,0,.18);margin:6px auto 10px;}
body[data-theme="dark"] .menu-handle{background:rgba(255,255,255,.18);}
.menu-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.menu-head b{font-size:16px;}
.menu-close{width:38px;height:38px;border:none;border-radius:12px;background:transparent;cursor:pointer;font-size:22px;line-height:1;color:#777;}
body[data-theme="dark"] .menu-close{color:#bbb;}
.menu-list{display:flex;flex-direction:column;gap:8px;}
.menu-item{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:12px 12px;border-radius:16px;border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  cursor:pointer;text-decoration:none;color:#2b2b2b;
}
body[data-theme="dark"] .menu-item{border-color:rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:#f1f1f1;}
.menu-left{display:flex;align-items:center;gap:10px;min-width:0;}
.menu-ic{width:30px;height:30px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.06);flex:0 0 auto;}
body[data-theme="dark"] .menu-ic{background:rgba(255,255,255,.06);}
.menu-txt{display:flex;flex-direction:column;min-width:0;}
.menu-name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.menu-sub{font-size:12px;opacity:.75;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
.menu-right{opacity:.65;font-weight:900;}

/* subcats */
.sub-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);opacity:0;pointer-events:none;transition:.18s;z-index:1200;}
.sub-backdrop.show{opacity:1;pointer-events:auto;}
.sub-sheet{
  position:fixed;left:0;right:0;bottom:-100%;
  background:#fffdf9;border-top-left-radius:22px;border-top-right-radius:22px;
  border:1px solid var(--stroke);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:.22s;z-index:1210;
  padding:10px 12px 14px;
  max-height: 72vh;
  overflow:auto;
  -webkit-overflow-scrolling:touch;
}
body[data-theme="dark"] .sub-sheet{background:#1c1c1c;border-color:rgba(255,255,255,.14);color:#f1f1f1;}
.sub-sheet.show{bottom:0;}
.sub-handle{width:44px;height:5px;border-radius:999px;background:rgba(0,0,0,.18);margin:6px auto 10px;}
body[data-theme="dark"] .sub-handle{background:rgba(255,255,255,.18);}
.sub-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.sub-head b{font-size:16px;}
.sub-close{width:38px;height:38px;border:none;border-radius:12px;background:transparent;cursor:pointer;font-size:22px;line-height:1;color:#777;}
body[data-theme="dark"] .sub-close{color:#bbb;}
.sub-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:6px 2px 10px;}
@media (max-width:420px){.sub-grid{grid-template-columns:repeat(3,1fr);}}
.sub-tile{
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  border-radius:18px;
  padding:10px 8px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  cursor:pointer;
  transition:.12s;
}
body[data-theme="dark"] .sub-tile{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.14);}
.sub-tile:active{transform:scale(.98);}
.sub-ico{font-size:30px;line-height:1;}
.sub-name{font-size:11px;font-weight:900;text-align:center;line-height:1.15;word-break:break-word;}
.sub-all{margin-top:8px;padding-top:10px;border-top:1px solid rgba(0,0,0,.06);}
body[data-theme="dark"] .sub-all{border-top:1px solid rgba(255,255,255,.12);}
.sub-all .sub-tile{width:100%;flex-direction:row;justify-content:flex-start;padding:12px 12px;gap:10px;}
.sub-all .sub-name{font-size:14px;}
.sub-all .sub-ico{font-size:26px;}

/* search */
.search-wrap{width:85%;margin:8px auto;position:relative;display:none;z-index:70;}
.search-wrap.show{display:block;}
.search-title{width:85%;margin:10px auto 0;font-weight:900;opacity:.9;display:none;z-index:70;position:relative;}
.search-title.show{display:block;}
.search-clear{
  position:absolute;right:10px;top:50%;transform:translateY(-50%);
  width:30px;height:30px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;cursor:pointer;
  border:1px solid var(--stroke);background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
}
body[data-theme="dark"] .search-clear{background:rgba(255,255,255,.06); color:#f1f1f1;}

@media (max-width:420px){
  .brand-title{font-size:30px;}
  .brand-title2{font-size:18px;}
  .brand-wrap{transform: translateX(10px);}
  .header{padding:14px 10px 24px;}
  .input{width:92%;}
  .products{gap:14px;}
}
@media (max-width:360px){
  .header img{width:76px;height:76px;left:10px;}
  .brand-title{font-size:28px;}
  .brand-title2{font-size:17px;letter-spacing:1.6px;}
  .brand-phone a{font-size:13px;}
  .btn{min-width:110px;padding:12px 16px;}
  .cat-btn{min-width:126px;padding:12px 16px;font-size:13px;}
}
</style>
</head>

<body>

<div class="header">
  <img src="images/logo.png" onerror="this.src='logo.png'" alt="CHOKOART logo">

  <div class="brand-wrap">
    <div class="brand-title">Bakery</div>
    <div class="brand-title2">CHOKOART</div>
    <div class="brand-slogan">BIZ BILAN MAZZALIROQ</div>

    <div class="brand-phone">
      <a href="tel:+998905050745" onclick="callPhone(event)">+998 90 505 07 45</a>
      <a href="tel:+998955006262" onclick="callPhone2(event)">+998 95 500 62 62</a>
    </div>
  </div>

  <div class="header-actions">
    <div class="act-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
      <div class="burger"><span></span><span></span><span></span></div>
    </div>
    <div class="act-btn" onclick="openRoute()" title="–ú–∞—Ä—à—Ä—É—Ç">
      <span class="act-ico">üìç</span>
    </div>
    <div class="act-btn" onclick="toggleSearch()" title="–ü–æ–∏—Å–∫">
      <span class="act-ico">üîç</span>
    </div>
  </div>
</div>

<div class="page">

<div class="menu-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>
<div class="menu-sheet" id="menuSheet">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b id="menuTitle">–ú–µ–Ω—é</b>
    <button class="menu-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">
    <div class="menu-item" onclick="toggleReviewWidget()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚≠ê</div>
        <div class="menu-txt">
          <div class="menu-name" id="mReviewTitle">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
          <div class="menu-sub" id="mReviewSub">–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div id="reviewWidgetWrap" style="display:none; padding:6px 4px 10px;">
      <div style="border:1px solid var(--stroke); border-radius:16px; overflow:hidden; background:#fff; padding:10px; display:flex; justify-content:center;">
        <iframe
          src="https://yandex.ru/sprav/widget/rating-badge/11046753996?type=rating"
          width="150"
          height="50"
          frameborder="0"
          style="border:0; display:block;"
        ></iframe>
      </div>
      <div style="text-align:center; font-size:12px; opacity:.75; margin-top:6px;" id="mReviewHint">
        –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –æ—Ç–∑—ã–≤—ã —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.
      </div>
      <div style="display:flex; justify-content:center; margin-top:8px;">
        <button class="btn" style="min-width:auto; padding:10px 14px;" onclick="openYandexReviews(event)" id="mReviewOpenBtn">
          –û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã
        </button>
      </div>
    </div>

    <div class="menu-item" onclick="toggleLegal()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üè¢</div>
        <div class="menu-txt">
          <div class="menu-name" id="mLegalTitle">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º</div>
          <div class="menu-sub" id="mLegalSub">–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ / —Å—á–µ—Ç–æ–≤</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div id="legalWrap" style="display:none; padding:6px 4px 10px;">
      <div style="border:1px solid var(--stroke); border-radius:16px; overflow:hidden; background:rgba(0,0,0,.03); padding:12px;">
        <div style="font-weight:900; margin-bottom:8px;" id="mLegalMail">‚úâÔ∏è –ü–æ—á—Ç–∞</div>
        <div style="font-size:13px; opacity:.85;" id="mLegalMailHint">(–ø–æ–∑–∂–µ –¥–æ–ø–∏—à–µ–º –ø–æ—á—Ç—É)</div>

        <div style="height:10px;"></div>

        <div style="font-weight:900; margin-bottom:6px;" id="mLegalPhone">üìû –¢–µ–ª–µ—Ñ–æ–Ω</div>
        <a href="tel:+998955006262" onclick="callPhone2(event)" style="text-decoration:none; font-weight:900; color:var(--accent-red);" id="mLegalPhoneNum">
          +998 95 500 62 62
        </a>

        <div style="height:12px;"></div>

        <button class="btn" style="width:100%; min-width:auto;" onclick="openManagerChat(event)" id="mLegalChatBtn">
          üí¨ –ß–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
        </button>
      </div>
    </div>

    <a class="menu-item" href="tel:+998905050745" onclick="closeTopMenu()">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name" id="mCallTitle">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub" id="mCallSub">+998 90 505 07 45</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <a class="menu-item" href="#" onclick="openInstagram(event)">
      <div class="menu-left">
        <div class="menu-ic" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" style="display:block;">
            <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4.3A5.7 5.7 0 1 1 6.3 14 5.7 5.7 0 0 1 12 8.3zm0 2A3.7 3.7 0 1 0 15.7 14 3.7 3.7 0 0 0 12 10.3zM18 6.7a1 1 0 1 1-1 1 1 1 0 0 1 1-1z"/>
          </svg>
        </div>
        <div class="menu-txt">
          <div class="menu-name" id="mInstaTitle">@choko_art_motrid</div>
          <div class="menu-sub" id="mInstaSub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üåì</div>
        <div class="menu-txt">
          <div class="menu-name" id="mThemeTitle">–¢–µ–º–∞</div>
          <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
        </div>
      </div>
      <div class="menu-right" id="mThemeRight">‚Ä∫</div>
    </div>
  </div>
</div>

<div class="sub-backdrop" id="subBackdrop" onclick="closeSubcats()"></div>
<div class="sub-sheet" id="subSheet">
  <div class="sub-handle"></div>
  <div class="sub-head">
    <b id="subTitle">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</b>
    <button class="sub-close" onclick="closeSubcats()">√ó</button>
  </div>

  <div class="sub-grid" id="subGrid"></div>
  <div class="sub-all" id="subAllWrap"></div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="popular-wrap" id="popularWrap">
  <div class="popular-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
  <div class="popular-row" id="popularRow"></div>
</div>

<div class="popular-wrap" id="newWrap">
  <div class="popular-title" id="newTitle">üÜï –ù–æ–≤–∏–Ω–∫–∏</div>
  <div class="mini-row" id="newRow"></div>
</div>

<div class="popular-wrap" id="giftWrap">
  <div class="popular-title" id="giftTitle">üéÅ –î–ª—è –ø–æ–¥–∞—Ä–∫–∞</div>
  <div class="mini-row" id="giftRow"></div>
</div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<div class="cart" id="cartBox">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
  <div style="margin-top:10px; font-weight:900;">
    <span id="totalLabel">–ò—Ç–æ–≥–æ</span>: <span id="grandTotal">0</span> —Å—É–º
  </div>

  <textarea id="comment" class="input"></textarea>

  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>

  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
  <div style="height: 12px;"></div>
</div>

<div class="popup" id="popup"><div class="popup-box">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div></div>

<!-- ‚úÖ –º–æ–¥–∞–ª–∫–∞ —Ñ–æ—Ç–æ -->
<div class="img-modal" id="imgModal" onclick="closeImgModal(event)">
  <div class="img-modal-box" onclick="event.stopPropagation()">
    <div class="img-modal-top">
      <div class="img-modal-title" id="imgModalTitle">–§–æ—Ç–æ</div>
      <button class="img-modal-close" onclick="closeImgModal(event)">√ó</button>
    </div>
    <img class="img-modal-img" id="imgModalImg" src="" alt="">
  </div>
</div>

<div class="sticky-checkout" id="stickyBar">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small id="sumCurrency">—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="openCart()" id="stickyCartBtn">–ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</div>

</div><!-- /page -->

<script>
Telegram.WebApp.ready();

/* ‚úÖ‚úÖ‚úÖ –ü–û–õ–ù–´–ô –≠–ö–†–ê–ù –≤ Telegram */
try{
  Telegram.WebApp.expand();
  Telegram.WebApp.disableVerticalSwipes?.();
}catch(_){}

/* ‚úÖ —Ñ–∏–∫—Å –≤—ã—Å–æ—Ç—ã viewport */
function setVH(){
  const vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}
setVH();
window.addEventListener('resize', setVH, {passive:true});
window.addEventListener('orientationchange', ()=>setTimeout(setVH, 250), {passive:true});

/* ‚úÖ —Ä–µ–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ sticky bar ‚Üí –≤ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é */
function syncStickyHeight(){
  const el = document.getElementById('stickyBar');
  if(!el) return;
  const h = Math.ceil(el.getBoundingClientRect().height || 86);
  document.documentElement.style.setProperty('--sticky-h', h + 'px');
}
window.addEventListener('resize', ()=>setTimeout(syncStickyHeight, 50), {passive:true});
window.addEventListener('orientationchange', ()=>setTimeout(syncStickyHeight, 250), {passive:true});

/* ====== constants ====== */
const ADMIN_ID = 6013591658;
const DELIVERY_FEE_SAMARKAND = 10000;

const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

/* ‚úÖ —Ç–µ–∫—Å—Ç—ã –¥–ª—è 3 —è–∑—ã–∫–æ–≤ (–∫–Ω–æ–ø–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏) */
const UI = {
  ru:{
    menu:'–ú–µ–Ω—é',
    reviewTitle:'–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤',
    reviewSub:'–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã',
    reviewHint:'–ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –æ—Ç–∑—ã–≤—ã —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.',
    reviewOpen:'–û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã',
    legalTitle:'–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º',
    legalSub:'–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ / —Å—á–µ—Ç–æ–≤',
    legalMail:'‚úâÔ∏è –ü–æ—á—Ç–∞',
    legalMailHint:'(–ø–æ–∑–∂–µ –¥–æ–ø–∏—à–µ–º –ø–æ—á—Ç—É)',
    legalPhone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',
    legalChat:'üí¨ –ß–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º',
    callTitle:'–ü–æ–∑–≤–æ–Ω–∏—Ç—å',
    instaSub:'–û—Ç–∫—Ä—ã—Ç—å Instagram',
    theme:'–¢–µ–º–∞',
    searchResults:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',

    popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ',
    new:'üÜï –ù–æ–≤–∏–Ω–∫–∏',
    gift:'üéÅ –î–ª—è –ø–æ–¥–∞—Ä–∫–∞',

    delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',
    pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',
    address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
    phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',

    cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',
    total:'–ò—Ç–æ–≥–æ',
    order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
    comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',

    cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',
    click:'üí≥ CLICK',

    sum:'—Å—É–º'
  },
  uz:{
    menu:'Menyu',
    reviewTitle:'Fikr qoldirish',
    reviewSub:'Yandex reyting / fikrlar',
    reviewHint:"Agar vidjet Telegramda ochilmasa ‚Äî pastdagi tugma orqali fikrlarni oching.",
    reviewOpen:"Fikrlarni ochish",
    legalTitle:'Yuridik shaxslar',
    legalSub:"Shartnoma / hisob uchun kontaktlar",
    legalMail:'‚úâÔ∏è Pochta',
    legalMailHint:"(keyinroq pochta yozamiz)",
    legalPhone:'üìû Telefon',
    legalChat:'üí¨ Menejer bilan chat',
    callTitle:"Qo'ng'iroq qilish",
    instaSub:"Instagramni ochish",
    theme:'Mavzu',
    searchResults:'Qidiruv natijalari',

    popular:'üî• Ommabop',
    new:'üÜï Yangi',
    gift:'üéÅ Sovg‚Äòa uchun',

    delivery:'üöö Yetkazish',
    pickup:'üèÉ Olib ketish',
    address:'üìç Manzil',
    phone:'üìû Telefon',

    cart:'üõí Savat',
    total:'Jami',
    order:'Buyurtma berish',
    comment:'‚úçÔ∏è Izoh',

    cash:'üíµ Naqd',
    click:'üí≥ CLICK',

    sum:"so‚Äòm"
  },
  en:{
    menu:'Menu',
    reviewTitle:'Leave a review',
    reviewSub:'Yandex rating / reviews',
    reviewHint:"If the widget doesn't open in Telegram ‚Äî open reviews using the button below.",
    reviewOpen:'Open reviews',
    legalTitle:'For legal entities',
    legalSub:'Contacts for contracts / invoices',
    legalMail:'‚úâÔ∏è Email',
    legalMailHint:'(we will add email later)',
    legalPhone:'üìû Phone',
    legalChat:'üí¨ Chat with manager',
    callTitle:'Call',
    instaSub:'Open Instagram',
    theme:'Theme',
    searchResults:'Search results',

    popular:'üî• Popular',
    new:'üÜï New',
    gift:'üéÅ For a gift',

    delivery:'üöö Delivery',
    pickup:'üèÉ Pickup',
    address:'üìç Address',
    phone:'üìû Phone',

    cart:'üõí Cart',
    total:'Total',
    order:'Place order',
    comment:'‚úçÔ∏è Comment',

    cash:'üíµ Cash',
    click:'üí≥ CLICK',

    sum:'sum'
  }
};

let lang='ru',category='cheesecakes',type='delivery',payment='cash',cart={};
let currentSubcat = '';

/* ‚úÖ‚úÖ‚úÖ –ú–ï–ù–Æ:
   ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è "–ü–∏—Ä–æ–∂–Ω–æ–µ" –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –≤–∞—à–∏ –Ω–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏
   ‚úÖ –î–ª—è –≤—Å–µ—Ö –ø–∏—Ä–æ–∂–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞: images/images.jpg */
const MENU = {
  cheesecakes:[
    {id:'cheesecake_pistachio', p:25000, img:'images/cheesecake_pistachio.png', sub:'', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –§–∏—Å—Ç–∞—à–∫–æ–≤—ã–π', uz:'Fistashkali chizkeyk', en:'Pistachio cheesecake'}},
    {id:'cheesecake_choco', p:25000, img:'images/cheesecake_choco.png', sub:'', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –®–æ–∫–æ–ª–∞–¥–Ω—ã–π', uz:'Shokoladli chizkeyk', en:'Chocolate cheesecake'}},
    {id:'cheesecake_raspberry', p:25000, img:'images/cheesecake_raspberry.png', sub:'', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –ú–∞–ª–∏–Ω–æ–≤—ã–π', uz:'Malinali chizkeyk', en:'Raspberry cheesecake'}},
    {id:'cheesecake_caramel', p:25000, img:'images/cheesecake_caramel.png', sub:'', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –ö–∞—Ä–∞–º–µ–ª—å–Ω—ã–π', uz:'Karamelli chizkeyk', en:'Caramel cheesecake'}}
  ],

  cakes:[
    {id:'cake_redvelvet', p:52000, img:'images/cake_redvelvet.png', sub:'event', n:{ru:'–¢–æ—Ä—Ç Red Velvet', uz:'Red Velvet tort', en:'Red Velvet cake'}},
    {id:'cake_choco', p:54000, img:'images/cake_choco.png', sub:'event', n:{ru:'–®–æ–∫–æ–ª–∞–¥–Ω—ã–π —Ç–æ—Ä—Ç', uz:'Shokolad tort', en:'Chocolate cake'}},

    {id:'pastry_afghan', p:300000, img:'images/afghanskiy.jpg', sub:'event', n:{ru:'–ê—Ñ–≥–∞–Ω—Å–∫–∏–π', uz:"Afg‚Äòoncha", en:'Afghan'}},
    {id:'pastry_nutella_cake', p:600000, img:'images/nutella.jpg', sub:'event', n:{ru:'–ù—É—Ç–µ–ª–ª–∞', uz:'Nutella', en:'Nutella'}},
    {id:'pastry_napoleon_banana_cake', p:240000, img:'images/napoleon_banan.jpg', sub:'event', n:{ru:'–ù–∞–ø–æ–ª–µ–æ–Ω –ë–∞–Ω–∞–Ω–æ–≤—ã–π', uz:'Bananli napoleon', en:'Banana napoleon'}},
    {id:'pastry_napoleon_icecream_cake', p:360000, img:'images/napoleon_morozhenoe.jpg', sub:'event', n:{ru:'–ù–∞–ø–æ–ª–µ–æ–Ω –ú–æ—Ä–æ–∂–µ–Ω–æ–µ', uz:'Napoleon (muzqaymoq)', en:'Napoleon ice cream'}},
    {id:'pastry_asalin_cake', p:240000, img:'images/asalin.jpg', sub:'event', n:{ru:'–ê—Å–∞–ª–∏–Ω', uz:'Asalin', en:'Asalin'}},
    {id:'pastry_smetannik_cake', p:240000, img:'images/smetannik.jpg', sub:'event', n:{ru:'–°–º–µ—Ç–∞–Ω–Ω–∏–∫', uz:'Smetanali', en:'Sour cream cake'}},
    {id:'pastry_male_ideal_cake', p:240000, img:'images/muzhskoy_ideal.jpg', sub:'event', n:{ru:'–ú—É–∂—Å–∫–æ–π –∏–¥–µ–∞–ª', uz:'Ideal', en:'Ideal'}}
  ],

  /* ‚úÖ –í–ê–®–ò –ù–û–í–´–ï –ü–ò–†–û–ñ–ù–´–ï + img = images/images.jpg */
  pastries:[
    {id:'pas_snickers', p:22000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –°–Ω–∏–∫–µ—Ä—Å', uz:'Snickers pirojnoye', en:'Snickers pastry'}},
    {id:'pas_rafaello', p:45000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –†–∞—Ñ–∞—ç–ª–ª–æ', uz:'Rafaello pirojnoye', en:'Raffaello pastry'}},
    {id:'pas_napoleon_icecream', p:40000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ù–∞–ø–æ–ª–µ–æ–Ω –ú–æ—Ä–æ–∂–µ–Ω–æ–µ', uz:'Napoleon (muzqaymoq)', en:'Napoleon ice cream'}},
    {id:'pas_napoleon_banana', p:22000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ù–∞–ø–æ–ª–µ–æ–Ω –ë–∞–Ω–∞–Ω–æ–≤—ã–π', uz:'Bananli napoleon', en:'Banana napoleon'}},
    {id:'pas_napoleon_banana_quarter', p:60000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ù–∞–ø–æ–ª–µ–æ–Ω –ë–∞–Ω–∞–Ω–æ–≤—ã–π —á–µ—Ç–≤–µ—Ä—Ç—å', uz:'Bananli napoleon (chorak)', en:'Banana napoleon (quarter)'}},
    {id:'pas_napoleon_banana_half', p:120000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ù–∞–ø–æ–ª–µ–æ–Ω –ë–∞–Ω–∞–Ω–æ–≤—ã–π –ø–æ–ª–æ–≤–∏–Ω–∞', uz:'Bananli napoleon (yarim)', en:'Banana napoleon (half)'}},
    {id:'pas_pear_mousse', p:25000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ì—Ä—É—à–∞ –º—É—Å—Å–æ–≤–∞—è', uz:'Nok muss', en:'Pear mousse'}},
    {id:'pas_coconut_mousse', p:25000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ö–æ–∫–æ—Å –º—É—Å—Å–æ–≤—ã–π', uz:'Kokos muss', en:'Coconut mousse'}},
    {id:'pas_cappuccino_cup', p:14000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ß–∞—à–∫–∞ –ö–∞–ø—É—á–∏–Ω–æ', uz:'Kapuchino chashka', en:'Cappuccino cup'}},
    {id:'pas_cappuccino_cup_mini', p:12000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ß–∞—à–∫–∞ –ö–∞–ø—É—á–∏–Ω–æ –º–∏–Ω–∏', uz:'Kapuchino mini', en:'Cappuccino cup mini'}},
    {id:'pas_heart_mousse', p:25000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –°–µ—Ä–¥—Ü–µ –º—É—Å—Å–æ–≤–æ–µ', uz:'Yurak muss', en:'Heart mousse'}},
    {id:'pas_bird_milk', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ü—Ç–∏—á—å–µ –º–æ–ª–æ–∫–æ', uz:'Qush suti', en:"Bird's milk"}}, 
    {id:'pas_cherry', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –í–∏—à–µ–Ω–∫–∞', uz:'Gilos', en:'Cherry pastry'}},
    {id:'pas_tart_pistachio', p:12000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –¢–∞—Ä—Ç–∞–ª–µ—Ç–∫–∞ —Ñ–∏—Å—Ç–∞—à–∫–æ–≤–∞—è', uz:'Fistashkali tartaletka', en:'Pistachio tartlet'}},
    {id:'pas_tart_choco', p:12000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –¢–∞—Ä—Ç–∞–ª–µ—Ç–∫–∞ —à–æ–∫–æ–ª–∞–¥–Ω–∞—è', uz:'Shokoladli tartaletka', en:'Chocolate tartlet'}},
    {id:'pas_kiev', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ö–∏–µ–≤—Å–∫–∏–π', uz:'Kiyev', en:'Kyiv pastry'}},
    {id:'pas_opera', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –û–ø–µ—Ä–∞', uz:'Opera', en:'Opera'}},
    {id:'pas_mousse', p:11000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ú—É—Å—Å–æ–≤–æ–µ', uz:'Mussli', en:'Mousse pastry'}},
    {id:'pas_curd_biscuit', p:12000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –¢–≤–æ—Ä–æ–∂–Ω—ã–π –ë–∏—Å–∫–≤–∏—Ç', uz:'Tvorogli biskvit', en:'Curd biscuit'}},
    {id:'pas_pistachio', p:14000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –§–∏—Å—Ç–∞—à–∫–∞', uz:'Fistashka', en:'Pistachio'}},
    {id:'pas_rafaello_mini', p:14000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –†–∞—Ñ–∞—ç–ª–ª–æ M–∏–Ω–∏', uz:'Rafaello mini', en:'Raffaello mini'}},
    {id:'pas_ferrero_rocher', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –§–µ—Ä—Ä–µ—Ä–æ –†–æ—à–µ', uz:'Ferrero Rocher', en:'Ferrero Rocher'}},
    {id:'pas_dubai_kataifi', p:30000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –î—É–±–∞–π—Å–∫–∏–π –ö–∞—Ç–∞–∏—Ñ–∏', uz:'Dubay kataifi', en:'Dubai kataifi'}},
    {id:'pas_spartak_nutella', p:12000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –°–ø–∞—Ä—Ç–∞–∫ —Å –Ω—É—Ç–µ–ª–ª–æ–π', uz:'Spartak (Nutella)', en:'Spartak with Nutella'}},
    {id:'pas_male_ideal', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ú—É–∂—Å–∫–æ–π –∏–¥–µ–∞–ª', uz:'Erkak ideal', en:'Male ideal'}},
    {id:'pas_smetannik', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –°–º–µ—Ç–∞–Ω–Ω–∏–∫', uz:'Smetannik', en:'Smetannik'}},
    {id:'pas_asalin', p:20000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ê—Å–∞–ª–∏–Ω', uz:'Asalin', en:'Asalin'}},
    {id:'pas_afghan', p:25000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ê–≤–≥–∞–Ω—Å–∫–∏–π', uz:'Afg‚Äòoncha', en:'Afghan'}},
    {id:'pas_nutella', p:30000, img:'images/images.jpg', sub:'', n:{ru:'–ü–∏—Ä–æ–∂–Ω–æ–µ –ù—É—Ç–µ–ª–ª–∞', uz:'Nutella', en:'Nutella'}}
  ],

  shortbread_pastries:[
    {id:'sb_ragalik', p:5000, img:'images/sb_ragalik.png', sub:'', n:{ru:'–†–∞–≥–∞–ª–∏–∫', uz:'Rogalik', en:'Rogaliki'}},
    {id:'sb_curd', p:16000, img:'images/sb_curd.png', sub:'', n:{ru:'–¢–≤–æ—Ä–æ–∂–Ω–æ–µ', uz:'Tvorogli', en:'Curd pastry'}},
    {id:'sb_nut_roll', p:6000, img:'images/sb_nut_roll.png', sub:'', n:{ru:'–û—Ä–µ—Ö–æ–≤—ã–π —Ä—É–ª–µ—Ç', uz:'Yong‚Äòoqli rulet', en:'Nut roll'}},
    {id:'sb_pahlava', p:8000, img:'images/sb_pahlava.png', sub:'', n:{ru:'–ü–∞—Ö–ª–∞–≤–∞', uz:'Pahlava', en:'Baklava'}},
    {id:'sb_banana_curd', p:5000, img:'images/sb_banana_curd.png', sub:'', n:{ru:'–ë–∞–Ω–∞–Ω—á–∏–∫ —Å —Ç–≤–æ—Ä–æ–≥–æ–º', uz:'Banan + tvorog', en:'Banana with curd'}},
    {id:'sb_shortbread_cookie', p:5000, img:'images/sb_shortbread_cookie.png', sub:'', n:{ru:'–ü–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ', uz:'Qumoq pechenye', en:'Shortbread cookie'}},
    {id:'sb_ring', p:10000, img:'images/sb_ring.png', sub:'', n:{ru:'–ö–æ–ª—å—Ü–æ', uz:'Halqa', en:'Ring'}},
    {id:'sb_choux', p:5000, img:'images/sb_choux.png', sub:'', n:{ru:'–ó–∞–≤–∞—Ä–Ω–æ–µ', uz:'Zavarnoy', en:'Choux'}},
    {id:'sb_tube', p:10000, img:'images/sb_tube.png', sub:'', n:{ru:'–¢—Ä—É–±–æ—á–∫–∞', uz:'Trubochka', en:'Tube'}},
    {id:'sb_bun_nutella', p:15000, img:'images/sb_bun_nutella.png', sub:'', n:{ru:'–ë—É–ª–æ—á–∫–∞ —Å –Ω—É—Ç–µ–ª–ª–æ–π', uz:'Nutella bulochka', en:'Nutella bun'}},
    {id:'sb_croissant_caramel', p:6000, img:'images/sb_croissant_caramel.png', sub:'', n:{ru:'–ö—Ä—É–∞—Å–∞–Ω —Å –∫–∞—Ä–∞–º–µ–ª—å—é', uz:'Kruassan karamel', en:'Croissant with caramel'}},
    {id:'sb_bun_nut', p:8000, img:'images/sb_bun_nut.png', sub:'', n:{ru:'–ë—É–ª–æ—á–∫–∞ —Å –æ—Ä–µ—Ö–æ–º', uz:'Yong‚Äòoqli bulochka', en:'Nut bun'}},
    {id:'sb_bun_caramel', p:8000, img:'images/sb_bun_caramel.png', sub:'', n:{ru:'–ë—É–ª–æ—á–∫–∞ —Å –∫–∞—Ä–∞–º–µ–ª—å—é', uz:'Karamelli bulochka', en:'Caramel bun'}},
    {id:'sb_vatrushka', p:8000, img:'images/sb_vatrushka.png', sub:'', n:{ru:'–í–∞—Ç—Ä—É—à–∫–∞', uz:'Vatrushka', en:'Vatrushka'}},
    {id:'sb_choco_cookie', p:5000, img:'images/sb_choco_cookie.png', sub:'', n:{ru:'–®–æ–∫–æ–ª–∞–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ', uz:'Shokolad pechenye', en:'Chocolate cookie'}}
  ],

  trifles:[
    {id:'trifle_choco', p:25000, img:'images/trifle_choco.png', sub:'', n:{ru:'–¢—Ä–∞–π—Ñ–ª –®–æ–∫–æ–ª–∞–¥–Ω—ã–π', uz:'Shokolad trifle', en:'Chocolate trifle'}},
    {id:'trifle_berry', p:25000, img:'images/trifle_berry.png', sub:'', n:{ru:'–¢—Ä–∞–π—Ñ–ª –Ø–≥–æ–¥–Ω—ã–π', uz:'Rezavor trifle', en:'Berry trifle'}},
    {id:'trifle_fruit', p:25000, img:'images/trifle_fruit.png', sub:'', n:{ru:'–¢—Ä–∞–π—Ñ–ª –§—Ä—É–∫—Ç–æ–≤—ã–π', uz:'Mevali trifle', en:'Fruit trifle'}},
    {id:'trifle_choco_prichuda', p:60000, img:'images/trifle_choco_prichuda.png', sub:'', n:{ru:'–¢—Ä–∞–π—Ñ–ª –®–æ–∫–æ–ª–∞–¥–Ω—ã–π –ü—Ä–∏—á—É–¥–∞', uz:'Shokolad trifle (Prichuda)', en:'Chocolate trifle (Prichuda)'}}
  ],

  shortbread_cookies:[
    {id:'sc_heart_500', p:25000, img:'images/sc_heart_500.png', sub:'', n:{ru:'–°–µ—Ä–¥–µ—á–∫–æ 500–≥—Ä', uz:'Yurakcha 500g', en:'Heart 500g'}},
    {id:'sc_square_500', p:25000, img:'images/sc_square_500.png', sub:'', n:{ru:'–ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ 500–≥—Ä', uz:'Kvadrat 500g', en:'Square 500g'}}
  ],

  bakery:[
    {id:'bak_durda_fatir_mid', p:14000, img:'images/bak_durda_fatir_mid.png', sub:'', n:{ru:'–î—É—Ä–¥–∞ –§–∞—Ç–∏—Ä —Å—Ä–µ–¥–Ω–∏–π', uz:'Durda fatir (o‚Äòrtacha)', en:'Durda fatir (medium)'}},
    {id:'bak_durda_fatir_big', p:22000, img:'images/bak_durda_fatir_big.png', sub:'', n:{ru:'–î—É—Ä–¥–∞ –§–∞—Ç–∏—Ä –±–æ–ª—å—à–∞—è', uz:'Durda fatir (katta)', en:'Durda fatir (large)'}},
    {id:'bak_durda_fatir_nut', p:37000, img:'images/bak_durda_fatir_nut.png', sub:'', n:{ru:'–î—É—Ä–¥–∞ –§–∞—Ç–∏—Ä —Å –æ—Ä–µ—Ö–æ–º', uz:'Durda fatir yong‚Äòoq', en:'Durda fatir with nuts'}},
    {id:'bak_fatir_mid', p:12000, img:'images/bak_fatir_mid.png', sub:'', n:{ru:'–§–∞—Ç–∏—Ä —Å—Ä–µ–¥–Ω–∏–π', uz:'Fatir (o‚Äòrtacha)', en:'Fatir (medium)'}},
    {id:'bak_fatir_big', p:20000, img:'images/bak_fatir_big.png', sub:'', n:{ru:'–§–∞—Ç–∏—Ä –±–æ–ª—å—à–æ–π', uz:'Fatir (katta)', en:'Fatir (large)'}},
    {id:'bak_fatir_nut_mid', p:25000, img:'images/bak_fatir_nut_mid.png', sub:'', n:{ru:'–§–∞—Ç–∏—Ä —Å –æ—Ä–µ—Ö–æ–º —Å—Ä–µ–¥–Ω–∏–π', uz:'Fatir yong‚Äòoq (o‚Äòrtacha)', en:'Fatir with nuts (medium)'}},
    {id:'bak_fatir_nut_big', p:35000, img:'images/bak_fatir_nut_big.png', sub:'', n:{ru:'–§–∞—Ç–∏—Ä —Å –æ—Ä–µ—Ö–æ–º –±–æ–ª—å—à–æ–π', uz:'Fatir yong‚Äòoq (katta)', en:'Fatir with nuts (large)'}}
  ],

  drinks:[
    {id:'dr_fansy_cool_cola_15', p:15000, img:'images/dr_fansy_cool_cola_15.png', sub:'', n:{ru:'Fansy Cool Cola 1.5L', uz:'Fansy Cool Cola 1.5L', en:'Fansy Cool Cola 1.5L'}},
    {id:'dr_fansy_lemon_15', p:15000, img:'images/dr_fansy_lemon_15.png', sub:'', n:{ru:'Fansy Lemon 1.5L', uz:'Fansy Lemon 1.5L', en:'Fansy Lemon 1.5L'}},
    {id:'dr_fansy_dyushes_15', p:15000, img:'images/dr_fansy_dyushes_15.png', sub:'', n:{ru:'Fansy Dyushes 1.5L', uz:'Fansy Dyushes 1.5L', en:'Fansy Dyushes 1.5L'}},

    {id:'dr_bonaqua_gas_15', p:0, img:'images/dr_bonaqua_gas_15.png', sub:'', n:{ru:'Bonaqua –ì–∞–∑ 1.5L', uz:'Bonaqua gaz 1.5L', en:'Bonaqua sparkling 1.5L'}},
    {id:'dr_bonaqua_still_15', p:0, img:'images/dr_bonaqua_still_15.png', sub:'', n:{ru:'Bonaqua –ë–µ–∑ –≥–∞–∑–∞ 1.5L', uz:'Bonaqua gazsiz 1.5L', en:'Bonaqua still 1.5L'}},

    {id:'dr_cola_05', p:8000, img:'images/dr_cola_05.png', sub:'', n:{ru:'Coca Cola 0.5L', uz:'Coca Cola 0.5L', en:'Coca Cola 0.5L'}},
    {id:'dr_fanta_05', p:8000, img:'images/dr_fanta_05.png', sub:'', n:{ru:'Fanta 0.5L', uz:'Fanta 0.5L', en:'Fanta 0.5L'}},
    {id:'dr_sprite_05', p:8000, img:'images/dr_sprite_05.png', sub:'', n:{ru:'Sprite 0.5L', uz:'Sprite 0.5L', en:'Sprite 0.5L'}},
    {id:'dr_fuse_tea_05', p:8000, img:'images/dr_fuse_tea_05.png', sub:'', n:{ru:'Fuse Tea 0.5L', uz:'Fuse Tea 0.5L', en:'Fuse Tea 0.5L'}},

    {id:'dr_fuse_tea_1', p:0, img:'images/dr_fuse_tea_1.png', sub:'', n:{ru:'Fuse Tea 1L', uz:'Fuse Tea 1L', en:'Fuse Tea 1L'}},
    {id:'dr_cappy_pulpy_orange', p:0, img:'images/dr_cappy_pulpy_orange.png', sub:'', n:{ru:'Cappy Pulpy Apelsin', uz:'Cappy Pulpy apelsin', en:'Cappy Pulpy Orange'}},

    {id:'dr_bonaqua_gas_1', p:10000, img:'images/dr_bonaqua_gas_1.png', sub:'', n:{ru:'Bonaqua –ì–∞–∑ 1L', uz:'Bonaqua gaz 1L', en:'Bonaqua sparkling 1L'}},
    {id:'dr_bonaqua_still_1', p:10000, img:'images/dr_bonaqua_still_1.png', sub:'', n:{ru:'Bonaqua –ë–µ–∑ –≥–∞–∑–∞ 1L', uz:'Bonaqua gazsiz 1L', en:'Bonaqua still 1L'}},

    {id:'dr_bonaqua_gas_05', p:0, img:'images/dr_bonaqua_gas_05.png', sub:'', n:{ru:'Bonaqua –ì–∞–∑ 0.5L', uz:'Bonaqua gaz 0.5L', en:'Bonaqua sparkling 0.5L'}},
    {id:'dr_bonaqua_still_05', p:0, img:'images/dr_bonaqua_still_05.png', sub:'', n:{ru:'Bonaqua –ë–µ–∑ –≥–∞–∑–∞ 0.5L', uz:'Bonaqua gazsiz 0.5L', en:'Bonaqua still 0.5L'}},

    {id:'dr_cola_zero_1', p:12000, img:'images/dr_cola_zero_1.png', sub:'', n:{ru:'Coca Cola Zero 1L', uz:'Coca Cola Zero 1L', en:'Coca Cola Zero 1L'}},

    {id:'dr_bogi_033', p:4000, img:'images/dr_bogi_033.png', sub:'', n:{ru:'Bogi Baland 0.33L', uz:'Bogi Baland 0.33L', en:'Bogi Baland 0.33L'}},
    {id:'dr_bogi_05', p:5000, img:'images/dr_bogi_05.png', sub:'', n:{ru:'Bogi Baland 0.5L', uz:'Bogi Baland 0.5L', en:'Bogi Baland 0.5L'}},

    {id:'dr_cola_025', p:7000, img:'images/dr_cola_025.png', sub:'', n:{ru:'Coca Cola 0.25L', uz:'Coca Cola 0.25L', en:'Coca Cola 0.25L'}},
    {id:'dr_fanta_025', p:7000, img:'images/dr_fanta_025.png', sub:'', n:{ru:'Fanta 0.25L', uz:'Fanta 0.25L', en:'Fanta 0.25L'}},
    {id:'dr_sprite_025', p:7000, img:'images/dr_sprite_025.png', sub:'', n:{ru:'Sprite 0.25L', uz:'Sprite 0.25L', en:'Sprite 0.25L'}},

    {id:'dr_tesco_dyushes_05', p:0, img:'images/dr_tesco_dyushes_05.png', sub:'', n:{ru:'Tesco Duyshes 0.5L', uz:'Tesco Dyushes 0.5L', en:'Tesco Dyushes 0.5L'}}
  ]
};

const CATS = {
  ru:{
    cheesecakes:'üç∞ –ß–∏–∑–∫–µ–π–∫–∏',
    cakes:'üéÇ –¢–æ—Ä—Ç—ã',
    pastries:'üçÆ –ü–∏—Ä–æ–∂–Ω–æ–µ',
    shortbread_pastries:'ü•ê –ü–µ—Å–æ—á–Ω–æ–µ –ø–∏—Ä–æ–∂–Ω–æ–µ',
    trifles:'üç® –¢—Ä–∞–π—Ñ–ª',
    shortbread_cookies:'üç™ –ü–µ—á–µ–Ω—å–µ –ø–µ—Å–æ—á–Ω–æ–µ',
    bakery:'ü•ñ –í—ã–ø–µ—á–∫–∞',
    drinks:'ü•§ –ù–∞–ø–∏—Ç–∫–∏'
  },
  uz:{
    cheesecakes:'üç∞ Chizkeyklar',
    cakes:'üéÇ Tortlar',
    pastries:'üçÆ Pirojnoye',
    shortbread_pastries:'ü•ê Qumoq pirojnoye',
    trifles:'üç® Trifle',
    shortbread_cookies:'üç™ Qumoq pechenye',
    bakery:'ü•ñ Pishiriqlar',
    drinks:'ü•§ Ichimliklar'
  },
  en:{
    cheesecakes:'üç∞ Cheesecakes',
    cakes:'üéÇ Cakes',
    pastries:'üçÆ Pastries',
    shortbread_pastries:'ü•ê Shortbread pastries',
    trifles:'üç® Trifles',
    shortbread_cookies:'üç™ Shortbread cookies',
    bakery:'ü•ñ Bakery',
    drinks:'ü•§ Drinks'
  }
};

const SUBCATS = {
  cakes: [
    {key:'wedding', ico:'üíç', n:{ru:'–°–≤–∞–¥–µ–±–Ω—ã–µ', uz:"To‚Äòy", en:'Wedding'}},
    {key:'bento',   ico:'üßÅ', n:{ru:'–ë–µ–Ω—Ç–æ',    uz:'Bento', en:'Bento'}},
    {key:'roll',    ico:'üç•', n:{ru:'–¢–æ—Ä—Ç—ã-—Ä—É–ª–µ—Ç—ã', uz:'Rulet', en:'Roll cakes'}},
    {key:'event',   ico:'üéâ', n:{ru:'–ù–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', uz:'Tadbir', en:'Events'}}
  ]
};

/* –∫–∞—Ä—É—Å–µ–ª–∏ (–æ—Å—Ç–∞–≤–∏–ª –∫–∞–∫ –±—ã–ª–æ) */
const POPULAR = ['cheesecake_pistachio','dr_cola_05','cake_choco','pas_napoleon_icecream','bak_fatir_big'];
const NEW_ITEMS = ['cheesecake_raspberry','trifle_fruit','dr_cola_zero_1','pas_dubai_kataifi'];
const GIFT_ITEMS = ['cake_redvelvet','sc_heart_500','trifle_choco','pas_rafaello_mini'];

const ITEM_INDEX = {};
for (const c in MENU){ MENU[c].forEach(it => ITEM_INDEX[it.id]=it); }

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function nameOf(id){
  const it = ITEM_INDEX[id];
  return (it && it.n && (it.n[lang] || it.n.ru)) ? (it.n[lang] || it.n.ru) : id;
}
function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}

/* ‚úÖ —Ç–µ–∫—Å—Ç—ã –¥–ª—è 3 —è–∑—ã–∫–æ–≤ */
function applyUI(){
  menuTitle.innerText = UI[lang].menu;
  mReviewTitle.innerText = UI[lang].reviewTitle;
  mReviewSub.innerText = UI[lang].reviewSub;
  mReviewHint.innerText = UI[lang].reviewHint;
  mReviewOpenBtn.innerText = UI[lang].reviewOpen;

  mLegalTitle.innerText = UI[lang].legalTitle;
  mLegalSub.innerText = UI[lang].legalSub;
  mLegalMail.innerText = UI[lang].legalMail;
  mLegalMailHint.innerText = UI[lang].legalMailHint;
  mLegalPhone.innerText = UI[lang].legalPhone;
  mLegalChatBtn.innerText = UI[lang].legalChat;

  mCallTitle.innerText = UI[lang].callTitle;
  mInstaSub.innerText = UI[lang].instaSub;
  mThemeTitle.innerText = UI[lang].theme;

  searchTitle.innerText = UI[lang].searchResults;

  popularTitle.innerText = UI[lang].popular;
  newTitle.innerText = UI[lang].new;
  giftTitle.innerText = UI[lang].gift;

  btnDelivery.innerText = UI[lang].delivery;
  btnPickup.innerText = UI[lang].pickup;

  address.placeholder = UI[lang].address;
  phone.placeholder = UI[lang].phone;

  cartTitle.innerText = UI[lang].cart;
  totalLabel.innerText = UI[lang].total;
  orderBtn.innerText = UI[lang].order;
  comment.placeholder = UI[lang].comment;

  payCash.innerText = UI[lang].cash;
  payClick.innerText = UI[lang].click;

  stickyCartBtn.innerText = UI[lang].cart;
  sumCurrency.innerText = UI[lang].sum;

  renderCats(); renderProducts(); renderPopular(); renderNew(); renderGift();
  updateTotal();

  setTimeout(syncStickyHeight, 50);
}

/* header actions */
function openTopMenu(){ closeSearch(); menuBackdrop.classList.add('show'); menuSheet.classList.add('show'); }
function closeTopMenu(){ menuBackdrop.classList.remove('show'); menuSheet.classList.remove('show'); }
function openRoute(){
  const url = "https://yandex.uz/maps/?rtext=~39.684041,66.960593&rtt=auto&z=16.65";
  try{ Telegram.WebApp.openLink(url); }catch(_){ window.open(url,'_blank'); }
}
function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const tel = "tel:+998905050745";
  try{ Telegram.WebApp.openLink(tel); }catch(_){ window.location.href = tel; }
}
function callPhone2(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const tel = "tel:+998955006262";
  try{ Telegram.WebApp.openLink(tel); }catch(_){ window.location.href = tel; }
}

/* legal */
function toggleLegal(){
  const w = document.getElementById('legalWrap');
  w.style.display = (w.style.display==='none' || !w.style.display) ? 'block' : 'none';
}
function openManagerChat(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = `https://t.me/user?id=${ADMIN_ID}`;
  try{ Telegram.WebApp.openLink(url); }catch(_){ window.open(url,'_blank'); }
}

/* reviews */
function toggleReviewWidget(){
  const w = document.getElementById('reviewWidgetWrap');
  w.style.display = (w.style.display==='none' || !w.style.display) ? 'block' : 'none';
}
const YANDEX_REVIEWS_URL="https://yandex.uz/maps/org/239856130727/?ll=66.960593%2C39.684041&mode=search&z=16.65";
function openYandexReviews(e){ try{e.preventDefault();e.stopPropagation();}catch(_){}
  try{Telegram.WebApp.openLink(YANDEX_REVIEWS_URL);}catch(_){window.open(YANDEX_REVIEWS_URL,'_blank');}
}
function openInstagram(e){ try{e.preventDefault();e.stopPropagation();}catch(_){}
  const url="https://www.instagram.com/choko_art_motrid/";
  closeTopMenu();
  try{Telegram.WebApp.openLink(url);}catch(_){window.open(url,'_blank');}
}

/* ‚úÖ —Ñ–æ—Ç–æ-–º–æ–¥–∞–ª–∫–∞ */
function openImage(e, id){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const it = ITEM_INDEX[id];
  const src = it?.img || 'images/logo.png';
  const title = nameOf(id);

  const m = document.getElementById('imgModal');
  const mi = document.getElementById('imgModalImg');
  const mt = document.getElementById('imgModalTitle');

  mt.innerText = title;
  mi.src = src;
  mi.onerror = function(){ this.onerror=null; this.src='images/logo.png'; };

  m.classList.add('show');
}
function closeImgModal(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const m = document.getElementById('imgModal');
  m.classList.remove('show');
  const mi = document.getElementById('imgModalImg');
  mi.src = '';
}

/* search */
function isSearchOpen(){ return searchWrap.classList.contains('show'); }
function toggleSearch(){ isSearchOpen()?closeSearch():openSearch(); }
function openSearch(){
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  searchInput.value='';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  searchInput.value='';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key === 'Enter') closeSearch(); }

function searchProducts(){
  const q = (searchInput.value || '').trim().toLowerCase();
  products.innerHTML='';
  if(!q){ renderProducts(); return; }
  for(let c in MENU){
    MENU[c].forEach(it=>{
      const nm = (it.n && (it.n[lang]||it.n.ru)) ? String(it.n[lang]||it.n.ru).toLowerCase() : '';
      if(nm.includes(q)){
        cart[it.id]=cart[it.id]||0;
        products.innerHTML += cardHTML(it);
      }
    });
  }
}

/* subcats */
function openSubcats(catKey){
  const list = SUBCATS[catKey] || [];
  const title = CATS[lang][catKey] || catKey;

  subTitle.innerText = (lang==='ru') ? `–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${title}`
    : (lang==='uz') ? `Bo‚Äòlimlar: ${title}`
    : `Subcategories: ${title}`;

  subGrid.innerHTML = '';
  subAllWrap.innerHTML = '';

  list.forEach(sc=>{
    const nm = (sc.n && (sc.n[lang] || sc.n.ru)) ? (sc.n[lang] || sc.n.ru) : sc.key;
    subGrid.innerHTML += `
      <div class="sub-tile" onclick="pickSubcat('${catKey}','${sc.key}')">
        <div class="sub-ico">${sc.ico}</div>
        <div class="sub-name">${escapeHtml(nm)}</div>
      </div>
    `;
  });

  const allLabel = (catKey==='cakes')
    ? (lang==='ru' ? '–í—Å–µ —Ç–æ—Ä—Ç—ã' : lang==='uz' ? 'Barcha tortlar' : 'All cakes')
    : (lang==='ru' ? '–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë' : lang==='uz' ? "Hammasi" : 'Show all');

  subAllWrap.innerHTML = `
    <div class="sub-tile" onclick="pickSubcat('${catKey}','')">
      <div class="sub-ico">üì¶</div>
      <div class="sub-name">${escapeHtml(allLabel)}</div>
    </div>
  `;

  subBackdrop.classList.add('show');
  subSheet.classList.add('show');
}
function closeSubcats(){
  subBackdrop.classList.remove('show');
  subSheet.classList.remove('show');
}
function pickSubcat(catKey, subKey){
  category = catKey;
  currentSubcat = subKey || '';
  renderCats();
  renderProducts();
  closeSubcats();
}

/* carousels */
function renderPopular(){
  popularRow.innerHTML='';
  POPULAR.forEach(id=>{
    const it = ITEM_INDEX[id]; if(!it) return;
    cart[id]=cart[id]||0;
    popularRow.innerHTML += popCardHTML(it,'üî•');
  });
}
function renderNew(){
  newRow.innerHTML='';
  NEW_ITEMS.forEach(id=>{
    const it = ITEM_INDEX[id]; if(!it) return;
    cart[id]=cart[id]||0;
    newRow.innerHTML += miniCardHTML(it,'üÜï');
  });
}
function renderGift(){
  giftRow.innerHTML='';
  GIFT_ITEMS.forEach(id=>{
    const it = ITEM_INDEX[id]; if(!it) return;
    cart[id]=cart[id]||0;
    giftRow.innerHTML += miniCardHTML(it,'üéÅ');
  });
}

function popCardHTML(it,badge){
  const id = it.id;
  return `
  <div class="pop-card" onclick="onCardClick(event,'${id}')">
    <div class="pop-badge">${badge}</div>
    <div class="pop-img" onclick="openImage(event,'${id}')"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
    <div class="pop-name">${escapeHtml(nameOf(id))}</div>
    <div class="pop-price">${formatSum(it.p)} <small>${UI[lang].sum}</small></div>
    <div class="pop-counter">
      <button type="button" onclick="chgFrom(event,'${id}',-1)">‚àí</button>
      <span id="pc_${id}">${cart[id]||0}</span>
      <button type="button" onclick="chgFrom(event,'${id}',1)">+</button>
    </div>
  </div>`;
}
function miniCardHTML(it,badge){
  const id = it.id;
  return `
  <div class="mini-card" onclick="onCardClick(event,'${id}')">
    <div class="mini-badge">${badge}</div>
    <div class="mini-img" onclick="openImage(event,'${id}')"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
    <div class="mini-name">${escapeHtml(nameOf(id))}</div>
    <div class="mini-price">${formatSum(it.p)} <small>${UI[lang].sum}</small></div>
    <div class="mini-counter">
      <button type="button" onclick="chgFrom(event,'${id}',-1)">‚àí</button>
      <span id="mc_${id}">${cart[id]||0}</span>
      <button type="button" onclick="chgFrom(event,'${id}',1)">+</button>
    </div>
  </div>`;
}
function onCardClick(e,id){
  if(e && e.target && e.target.closest && e.target.closest('button')) return;
  if(e && e.target && e.target.closest && e.target.closest('.pop-img, .mini-img')) return;
  chg(id,1);
}
function chgFrom(e,id,delta){
  if(e){ e.preventDefault(); e.stopPropagation(); }
  chg(id,delta);
}

function syncCounters(id){
  const a = document.getElementById('pc_'+id);
  if(a) a.innerText = cart[id]||0;
  const b = document.getElementById('mc_'+id);
  if(b) b.innerText = cart[id]||0;
  const c = document.getElementById('c_'+id);
  if(c) c.innerText = cart[id]||0;
}

function calcItemsSum(){
  let s=0;
  for(const id in cart) s += (cart[id]||0) * (ITEM_INDEX[id]?.p||0);
  return s;
}

/* ‚úÖ –¥–æ—Å—Ç–∞–≤–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É */
function calcDeliveryFee(){
  return (type === 'delivery') ? DELIVERY_FEE_SAMARKAND : 0;
}

function updateTotal(){
  const itemsSum = calcItemsSum();
  const dfee = calcDeliveryFee();
  const grand = itemsSum + dfee;

  total.innerText = formatSum(itemsSum);
  grandTotal.innerText = formatSum(grand);
  stickyTotal.innerText = formatSum(grand);
}

/* chg */
function chg(id,delta){
  cart[id]=Math.max(0,(cart[id]||0)+delta);
  syncCounters(id);
  updateTotal();
}

/* categories */
function onCategoryClick(k){
  category = k;
  currentSubcat = '';
  renderCats();

  if(SUBCATS[k] && SUBCATS[k].length){
    openSubcats(k);
  }else{
    renderProducts();
  }
}
function renderCats(){
  cats.innerHTML='';
  for(const k in MENU){
    cats.innerHTML += `<button class="btn cat-btn ${k===category?'active':''}" onclick="onCategoryClick('${k}')">${CATS[lang][k]||k}</button>`;
  }
}
function cardHTML(it){
  const id = it.id;
  const qty = cart[id]||0;
  return `
  <div class="card">
    <div class="img"><img src="${it.img}" onerror="this.src='images/logo.png'" onclick="openImage(event,'${id}')"></div>
    <div class="item-name">${escapeHtml(nameOf(id))}</div>
    <div class="price">${formatSum(it.p)} <small>${UI[lang].sum}</small></div>
    <div class="counter">
      <button onclick="chg('${id}',-1)">‚àí</button>
      <span id="c_${id}">${qty}</span>
      <button onclick="chg('${id}',1)">+</button>
    </div>
  </div>`;
}
function renderProducts(){
  products.innerHTML='';
  const list = (MENU[category]||[]);
  const filtered = currentSubcat ? list.filter(it => (it.sub||'') === currentSubcat) : list;
  (filtered.length ? filtered : list).forEach(it=>{
    cart[it.id]=cart[it.id]||0;
    products.innerHTML += cardHTML(it);
  });
}

/* types / payments */
function setType(t,btn){
  type=t;
  document.querySelectorAll('.types .btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');

  address.style.display = (type==='pickup') ? 'none' : 'block';

  updateTotal();
}

function setPayment(p){
  payment=p;
  payCash.classList.toggle('active', p==='cash');
  payClick.classList.toggle('active', p==='click');
}

/* ‚úÖ openCart */
function openCart(){
  const el = document.getElementById('cartBox');
  if(!el) return;
  syncStickyHeight();
  try{
    el.scrollIntoView({behavior:'smooth', block:'start'});
  }catch(_){
    window.location.hash = '#cartBox';
  }
}

/* order */
function genOrderId(){
  const d=new Date();
  const dd=String(d.getDate()).padStart(2,'0');
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const key=`chokoart_seq_${d.getFullYear()}${mm}${dd}`;
  let n=Number(localStorage.getItem(key)||0)+1;
  localStorage.setItem(key,String(n));
  return `CHK-${dd}${mm}-${String(n).padStart(3,'0')}`;
}
function sendOrder(){
  popup.classList.add('show');

  const items=[];
  for(const id in cart){
    const qty=Number(cart[id]||0);
    if(qty>0){
      const it=ITEM_INDEX[id]||{};
      items.push({id,qty,price:it.p||0,name_ru:it.n?.ru||id,name_lang:nameOf(id)});
    }
  }
  if(items.length===0){
    popup.classList.remove('show');
    alert(lang==='ru'?'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è':lang==='uz'?"Savat bo‚Äòsh":"Cart is empty");
    return;
  }

  const itemsSum = calcItemsSum();
  const dfee = calcDeliveryFee();
  const grand = itemsSum + dfee;

  const payload={
    tg:{id:tg_id,username:tg_username,first_name:tg_first_name},
    items,
    total_items: formatSum(itemsSum),
    delivery_fee: dfee,
    total_with_delivery: formatSum(grand),
    total_num: grand,
    payment,
    type,
    address:(type==='pickup'?'':address.value),
    phone:phone.value,
    comment:comment.value,
    order_id: genOrderId(),
    lang,
    category,
    subcategory: currentSubcat || ''
  };

  setTimeout(()=>{
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  },700);
}

/* theme */
function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('chokoart_theme', theme);
  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (theme === 'dark')
    ? (lang==='ru'?'–¢—ë–º–Ω–∞—è':lang==='uz'?'Qorong‚Äòi':'Dark')
    : (lang==='ru'?'–°–≤–µ—Ç–ª–∞—è':lang==='uz'?'Yorug‚Äò':'Light');
  try{
    Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
    Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  applyTheme(cur==='dark'?'light':'dark');
}
(function initTheme(){
  const saved = localStorage.getItem('chokoart_theme');
  if(saved==='dark'||saved==='light') applyTheme(saved);
  else{
    const tgTheme = Telegram.WebApp.colorScheme || 'light';
    applyTheme(tgTheme==='dark'?'dark':'light');
  }
})();

/* init */
renderPopular(); renderNew(); renderGift();
renderCats(); renderProducts();

address.value = localStorage.getItem('chokoart_address') || '';
phone.value = localStorage.getItem('chokoart_phone') || '+998 90 505 07 45';
address.addEventListener('input',()=>localStorage.setItem('chokoart_address',address.value));
phone.addEventListener('input',()=>localStorage.setItem('chokoart_phone',phone.value));

function setLang(l,btn){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  applyUI();
}

/* default */
applyUI();
setPayment('cash');
btnDelivery.classList.add('active');
btnPickup.classList.remove('active');
type='delivery';
updateTotal();

/* ‚úÖ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî –∏–∑–º–µ—Ä—è–µ–º –≤—ã—Å–æ—Ç—É sticky */
setTimeout(syncStickyHeight, 50);
</script>
</body>
</html>
