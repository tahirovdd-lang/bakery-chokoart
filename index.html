<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Bakery CHOKOART</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#F8F3E9;

  /* ‚úÖ –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
  --pink:#F6B7C7;
  --pink-2:#F2A7BC;
  --pink-deep:#C56C86;

  --accent-red:#8B1E1E;   /* –±–æ—Ä–¥–æ–≤—ã–π (–∫–∞–∫ —Ü–µ–Ω–∞) */
  --stroke: rgba(0,0,0,.08);
  --stroke-strong: rgba(0,0,0,.14);
  --inner: rgba(255,255,255,.70);
  --shadow: rgba(0,0,0,.10);
  --shadow-strong: rgba(0,0,0,.18);

  --r-lg:24px;
  --r-md:22px;
  --r-pill:28px;
}

/* ‚úÖ —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body[data-theme="dark"]{
  --bg:#121212;
  --stroke: rgba(255,255,255,.14);
  --stroke-strong: rgba(255,255,255,.22);
  --inner: rgba(255,255,255,.06);
  --shadow: rgba(0,0,0,.28);
  --shadow-strong: rgba(0,0,0,.45);
  color:#f1f1f1;
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:var(--bg);
  color:#2b2b2b;
  padding-bottom:88px;
}
body[data-theme="dark"]{ color:#f1f1f1; }

/* ‚úÖ‚úÖ‚úÖ –®–ê–ü–ö–ê: –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤–∞—è */
.header{
  padding:16px 12px 26px;
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  color:white;
  box-shadow:0 10px 26px rgba(0,0,0,.18);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  text-align:center;
}

/* ‚úÖ –õ–û–ì–û */
.header img{
  position:absolute;
  left:12px;
  width:126px;
  height:126px;
  object-fit:contain;
  border-radius:20px;
  background:rgba(255,255,255,.10);
  padding:10px;
  border:1px solid rgba(255,255,255,.22);
  box-shadow:0 12px 26px rgba(0,0,0,.14);
}

.brand-wrap{display:flex;flex-direction:column;align-items:center;gap:2px;}
.brand-wrap{ transform: translateX(20px); }

/* Bakery / CHOKOART */
.brand-title{
  font-family:'Lobster',cursive;
  font-size:34px;
  line-height:1;
  letter-spacing:.2px;
}
.brand-title2{
  font-family:'Montserrat',sans-serif;
  font-weight:900;
  font-size:20px;
  letter-spacing:2px;
  line-height:1.1;
}

/* ‚úÖ –ª–æ–∑—É–Ω–≥ ‚Äî —É–º–µ–Ω—å—à–∏–ª–∏ + –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π */
.brand-slogan{
  font-family: 'Montserrat', sans-serif;
  font-size:12px;
  font-weight:800;
  letter-spacing:1.2px;
  opacity:.92;
  margin-top:2px;
  text-transform:uppercase;
}

.brand-phone{position:relative; z-index:50; pointer-events:auto; margin-top:4px;}
.brand-phone a{
  color:white;
  text-decoration:none;
  font-size:14px;
  font-weight:800;
  position:relative;
  z-index:51;
  pointer-events:auto;
  cursor:pointer;
  opacity:.95;
}

/* ‚úÖ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é (–±—É—Ä–≥–µ—Ä) */
.menu-btn{
  position:absolute;
  right:14px;
  top:12px;
  width:42px;
  height:42px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:80;

  background:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.55), 0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.menu-btn:active{transform:scale(.97);}
.burger{width:22px;height:16px;position:relative;}
.burger span{
  position:absolute;left:0;right:0;
  height:3px;border-radius:10px;
  background:#222;opacity:.9;
}
.burger span:nth-child(1){top:0;}
.burger span:nth-child(2){top:6.5px;}
.burger span:nth-child(3){bottom:0;}

/* ‚úÖ –≥–µ–æ-–∫–Ω–æ–ø–∫–∞ */
.geo-btn{
  position:absolute;
  right:18px;
  top:58px;
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:85;

  background:rgba(255,255,255,.18);
  border:1px solid rgba(255,255,255,.24);
  box-shadow:0 10px 22px rgba(0,0,0,.12);
  color:#fff;
  font-size:18px;
  line-height:1;
}
.geo-btn:active{transform:scale(.98);}

/* üîç –ø–æ–∏—Å–∫ */
.search-btn{
  position:absolute;
  right:14px;
  bottom:10px;
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  z-index:60;

  color:#333;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
.search-btn:active{transform:scale(.97);}

.langs,.types,.payments{
  display:flex;
  gap:12px;
  padding:12px;
  justify-content:center;
}

/* ‚úÖ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫ –±–æ—Ä–¥–æ–≤—ã–π –∫–∞–∫ —Ü–µ–Ω–∞ */
.btn{
  padding:12px 20px;
  border-radius:var(--r-pill);
  font-weight:900;
  min-width:120px;
  text-align:center;
  cursor:pointer;
  transition:.15s;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  color: var(--accent-red);
}
body[data-theme="dark"] .btn{
  background:rgba(255,255,255,.06);
  color: var(--accent-red);
}
.btn:active{transform:scale(.98);}

/* ‚úÖ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏: —Ä–æ–∑–æ–≤—ã–µ */
.btn.active{
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:white;
  border:1px solid rgba(255,255,255,.35);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.14), 0 10px 22px rgba(197,108,134,.28);
}

/* inputs */
.input{
  margin:8px auto;
  display:block;
  padding:14px;
  width:85%;
  border-radius:var(--r-md);
  font-size:15px;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  outline:none;
  transition:.15s;
}
body[data-theme="dark"] .input{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.input:focus{
  border-color: var(--stroke-strong);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px var(--shadow-strong);
}

/* categories/products */
.categories{
  display:flex;
  gap:12px;
  padding:14px;
  overflow-x:auto;
  scroll-behavior:smooth;
}
.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
  padding:12px;
}
.card{
  border-radius:var(--r-lg);
  padding:12px;
  text-align:center;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  transition:.15s;
}
body[data-theme="dark"] .card{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.card:active{transform:scale(.99);}

.img{
  height:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:6px;
}
.img img{
  max-width:125px;
  max-height:125px;
  width:auto;
  height:auto;
  object-fit:contain;
  opacity:1;
  transform:scale(1.05);
  transition:.15s;
}
.card:active .img img{transform:scale(1.12);}

.item-name{
  margin-top:2px;
  padding:0 6px;
  font-weight:900;
  line-height:1.15;
  min-height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  word-break:break-word;
}

/* price */
.price{font-weight:900;color:var(--accent-red);margin-top:6px;}
.price small{font-weight:800;opacity:.75;margin-left:4px;}

/* ‚úÖ‚úÖ‚úÖ +/- –ö–ù–û–ü–ö–ò = –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤—ã–µ */
.counter{display:flex;justify-content:center;gap:10px;margin-top:8px;align-items:center;}
.counter button{
  width:32px;
  height:32px;
  border-radius:50%;
  cursor:pointer;

  border:1px solid rgba(255,255,255,.35);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:#fff;
  font-size:18px;
  font-weight:900;
  box-shadow:0 10px 22px rgba(0,0,0,.12);
  transition:.15s;
}
.counter button:active{transform:scale(.96);}

/* cart */
.cart{
  background:#fffdf9;
  margin:12px;
  padding:16px;
  border-radius:var(--r-lg);
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
}
body[data-theme="dark"] .cart{ background:rgba(255,255,255,.06); color:#f1f1f1; }

textarea.input{height:90px;}

.cart-lines{margin-top:8px; font-weight:800; opacity:.9;}
.cart-line{display:flex; justify-content:space-between; gap:10px; padding:4px 0;}
.cart-line small{opacity:.75; font-weight:800;}
.cart-divider{height:1px; background:rgba(0,0,0,.08); margin:8px 0;}
body[data-theme="dark"] .cart-divider{background:rgba(255,255,255,.12);}

/* ‚úÖ‚úÖ‚úÖ –û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó = –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤–∞—è */
.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:var(--r-lg);
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;

  border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.14);
  transition:.15s;
}
.order-btn:active{transform:scale(.99);}

.popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s;}
.popup.show{opacity:1;pointer-events:auto;}
.popup-box{
  background:white;
  padding:26px;
  border-radius:var(--r-lg);
  text-align:center;
  font-weight:800;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
}
body[data-theme="dark"] .popup-box{ background:#1c1c1c; color:#f1f1f1; }

/* search */
.search-wrap{width:85%;margin:8px auto;position:relative;display:none;z-index:70;}
.search-wrap.show{display:block;}
.search-wrap input{width:100%;margin:0;padding-right:44px;}
.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:30px;
  height:30px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
body[data-theme="dark"] .search-clear{background:rgba(255,255,255,.06); color:#f1f1f1;}
.search-clear:active{transform:translateY(-50%) scale(.96);}
.search-title{width:85%;margin:10px auto 0;font-weight:900;opacity:.9;display:none;z-index:70;position:relative;}
.search-title.show{display:block;}
mark{background:rgba(246,183,199,.35);padding:0 .12em;border-radius:6px;}

/* quick filters */
.quick-filters{display:flex;gap:10px;padding:0 12px 10px;overflow-x:auto;}
.qbtn{
  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  border-radius:999px;
  padding:10px 14px;
  font-weight:900;
  cursor:pointer;
  white-space:nowrap;
  transition:.15s;
  color: var(--accent-red);
}
body[data-theme="dark"] .qbtn{background:rgba(255,255,255,.06); color: var(--accent-red);}
.qbtn:active{transform:scale(.98);}

/* popular & carousels */
.popular-wrap{width:100%;padding:4px 12px 6px;}
.popular-title{width:100%;font-weight:900;padding:8px 2px 10px;display:flex;align-items:center;gap:8px;}
.popular-row{display:flex;gap:12px;overflow-x:auto;padding:2px 2px 10px;}
.pop-card{
  min-width:150px;
  border-radius:var(--r-lg);
  padding:10px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  cursor:pointer;
  transition:.15s;
  position:relative;
}
body[data-theme="dark"] .pop-card{background:rgba(255,255,255,.06); color:#f1f1f1;}
.pop-card:active{transform:scale(.99);}
.pop-img{
  height:74px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(197,108,134,.10);
}
.pop-img img{width:100%;height:100%;object-fit:cover;}
.pop-name{font-weight:900;margin-top:8px;}
.pop-price{font-weight:900;color:var(--accent-red);margin-top:4px;}
.pop-badge{position:absolute;left:10px;top:10px;font-size:18px;pointer-events:none;}

.pop-counter{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:8px;}
.pop-counter button{
  width:30px;height:30px;border-radius:50%;cursor:pointer;
  border:1px solid rgba(255,255,255,.35);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:#fff;
  font-size:18px;
  font-weight:900;
  box-shadow:0 10px 22px rgba(0,0,0,.12);
  transition:.15s;
}
.pop-counter button:active{transform:scale(.96);}
.pop-counter span{font-weight:900; min-width:18px; text-align:center;}

/* ‚úÖ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–∫–æ–Ω–∫–∏-–∫–∞—Ä—Ç–æ—á–∫–∏ (–ù–æ–≤–∏–Ω–∫–∏ / –î–ª—è –ø–æ–¥–∞—Ä–∫–∞) */
.mini-row{display:flex;gap:12px;overflow-x:auto;padding:2px 2px 10px;}
.mini-card{
  min-width:132px;
  border-radius:22px;
  padding:10px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  cursor:pointer;
  transition:.15s;
  position:relative;
}
body[data-theme="dark"] .mini-card{background:rgba(255,255,255,.06); color:#f1f1f1;}
.mini-card:active{transform:scale(.99);}
.mini-badge{position:absolute;left:10px;top:10px;font-size:18px;pointer-events:none;}
.mini-img{
  height:70px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(197,108,134,.10);
}
.mini-img img{width:100%;height:100%;object-fit:cover;}
.mini-name{font-weight:900;margin-top:8px; font-size:12px; line-height:1.15; min-height:28px;}
.mini-price{font-weight:900;color:var(--accent-red);margin-top:4px;}
.mini-counter{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:8px;}
.mini-counter button{
  width:28px;height:28px;border-radius:50%;cursor:pointer;
  border:1px solid rgba(255,255,255,.35);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:#fff;
  font-size:18px;
  font-weight:900;
  box-shadow:0 10px 22px rgba(0,0,0,.12);
  transition:.15s;
}
.mini-counter button:active{transform:scale(.96);}
.mini-counter span{font-weight:900; min-width:18px; text-align:center;}

/* sticky checkout */
.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px;
  background:rgba(248,243,233,.88);
  backdrop-filter: blur(10px);
  z-index:999;
  border-top:1px solid rgba(0,0,0,.06);
}
body[data-theme="dark"] .sticky-checkout{
  background:rgba(18,18,18,.88);
  border-top:1px solid rgba(255,255,255,.12);
}
.sticky-inner{
  max-width:520px;
  margin:0 auto;
  border-radius:18px;
  padding:10px 12px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
body[data-theme="dark"] .sticky-inner{background:rgba(255,255,255,.06);}
.sticky-sum{font-weight:900;line-height:1.1;}
.sticky-sum small{display:block;font-weight:800;opacity:.75;margin-top:2px;}

/* ‚úÖ –∫–Ω–æ–ø–∫–∞ "–ö–æ—Ä–∑–∏–Ω–∞" */
.sticky-btn{
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.14);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{transform:scale(.99);}

/* menu sheet */
.menu-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);opacity:0;pointer-events:none;transition:.18s;z-index:1000;}
.menu-backdrop.show{opacity:1;pointer-events:auto;}
.menu-sheet{
  position:fixed;left:0; right:0;bottom:-100%;
  background:#fffdf9;
  border-top-left-radius:22px;border-top-right-radius:22px;
  border:1px solid var(--stroke);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:.22s;z-index:1010;
  padding:10px 12px 14px;
}
body[data-theme="dark"] .menu-sheet{background:#1c1c1c;border-color:rgba(255,255,255,.14);}
.menu-sheet.show{bottom:0;}
.menu-handle{width:44px;height:5px;border-radius:999px;background:rgba(0,0,0,.18);margin:6px auto 10px;}
body[data-theme="dark"] .menu-handle{background:rgba(255,255,255,.18);}
.menu-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.menu-head b{font-size:16px;}
.menu-close{width:38px;height:38px;border:none;border-radius:12px;background:transparent;cursor:pointer;font-size:22px;line-height:1;color:#777;}
body[data-theme="dark"] .menu-close{color:#bbb;}
.menu-list{display:flex;flex-direction:column;gap:8px;}
.menu-item{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:12px 12px;border-radius:16px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  cursor:pointer;text-decoration:none;color:#2b2b2b;
}
body[data-theme="dark"] .menu-item{border-color:rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:#f1f1f1;}
.menu-left{display:flex;align-items:center;gap:10px;min-width:0;}
.menu-ic{width:30px;height:30px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.06);flex:0 0 auto;}
body[data-theme="dark"] .menu-ic{background:rgba(255,255,255,.06);}
.menu-txt{display:flex;flex-direction:column;min-width:0;}
.menu-name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.menu-sub{font-size:12px;opacity:.75;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
.menu-right{opacity:.65;font-weight:900;}

/* ‚úÖ –º–æ–¥–∞–ª–∫–∞ "–û –Ω–∞—Å" */
.about-modal{position:fixed;inset:0;background:rgba(0,0,0,.40);display:none;z-index:1100;padding:18px 14px;}
.about-modal.show{display:block;}
.about-card{
  max-width:680px;
  margin:0 auto;
  background:#fffdf9;
  border:1px solid var(--stroke);
  border-radius:22px;
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  padding:14px 14px 12px;
  max-height: calc(100vh - 40px);
  overflow: hidden;
}
body[data-theme="dark"] .about-card{background:#1c1c1c;border-color:rgba(255,255,255,.14);color:#f1f1f1;}
.about-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px;}
.about-head b{font-size:16px;}
.about-body{
  font-size:14px;
  line-height:1.45;
  max-height: calc(100vh - 140px);
  overflow:auto;
  padding-right:6px;
  -webkit-overflow-scrolling: touch;
}
.about-body .t{white-space:pre-wrap;}

/* ‚úÖ‚úÖ‚úÖ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–Ω–∏–∑—É */
.subcat-btn-wrap{padding:0 12px 8px;}
.subcat-open{
  width:100%;
  border-radius:18px;
  padding:12px 14px;
  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  font-weight:900;
  color:var(--accent-red);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
body[data-theme="dark"] .subcat-open{background:rgba(255,255,255,.06); color:var(--accent-red);}
.subcat-open:active{transform:scale(.99);}
.subcat-open small{opacity:.75; font-weight:900;}

.subcat-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);opacity:0;pointer-events:none;transition:.18s;z-index:1200;}
.subcat-backdrop.show{opacity:1;pointer-events:auto;}
.subcat-sheet{
  position:fixed;left:0;right:0;bottom:-110%;
  background:#fffdf9;
  border-top-left-radius:22px;border-top-right-radius:22px;
  border:1px solid var(--stroke);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:.22s;
  z-index:1210;
  padding:10px 12px 14px;
  max-height: 78vh;
  overflow:hidden;
}
body[data-theme="dark"] .subcat-sheet{background:#1c1c1c;border-color:rgba(255,255,255,.14);color:#f1f1f1;}
.subcat-sheet.show{bottom:0;}
.subcat-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.subcat-head b{font-size:16px;}
.subcat-grid{
  overflow:auto;
  max-height: calc(78vh - 78px);
  padding:2px 2px 10px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  -webkit-overflow-scrolling: touch;
}
.subcat-tile{
  border-radius:18px;
  padding:10px 8px 12px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  cursor:pointer;
  transition:.15s;
  text-align:center;
}
body[data-theme="dark"] .subcat-tile{background:rgba(255,255,255,.06); color:#f1f1f1;}
.subcat-tile:active{transform:scale(.99);}
.subcat-tile.active{
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:#fff;
  border:1px solid rgba(255,255,255,.35);
}
.subcat-ic{height:46px;display:flex;align-items:center;justify-content:center;font-size:34px;line-height:1;margin-bottom:6px;}
.subcat-nm{font-weight:900;font-size:12px;line-height:1.15;min-height:30px;display:flex;align-items:center;justify-content:center;}
.subcat-footer{
  padding-top:10px;
}
.subcat-footer .subcat-open{border-radius:18px;}
/* –≤ –ø–æ–∏—Å–∫–µ —Å–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª–∏/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
body.searching .subcat-btn-wrap,
body.searching .popular-wrap,
body.searching #newWrap,
body.searching #giftWrap,
body.searching .quick-filters{display:none;}
</style>
</head>

<body>

<div class="header">
  <img src="images/logo.png" onerror="this.src='logo.png'" alt="CHOKOART logo">

  <div class="brand-wrap">
    <div class="brand-title">Bakery</div>
    <div class="brand-title2">CHOKOART</div>
    <div class="brand-slogan">BIZ BILAN MAZZALIROQ</div>

    <div class="brand-phone">
      <a href="tel:+998905050745" onclick="callPhone(event)">+998 90 505 07 45</a>
    </div>
  </div>

  <div class="menu-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
    <div class="burger">
      <span></span><span></span><span></span>
    </div>
  </div>

  <div class="geo-btn" onclick="openRoute()" title="–ú–∞—Ä—à—Ä—É—Ç">üìç</div>
  <div class="search-btn" onclick="toggleSearch()">üîç</div>
</div>

<div class="menu-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>

<div class="menu-sheet" id="menuSheet">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b>–ú–µ–Ω—é</b>
    <button class="menu-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">
    <div class="menu-item" onclick="toggleReviewWidget()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚≠ê</div>
        <div class="menu-txt">
          <div class="menu-name">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
          <div class="menu-sub">–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div id="reviewWidgetWrap" style="display:none; padding:6px 4px 10px;">
      <div style="border:1px solid var(--stroke); border-radius:16px; overflow:hidden; background:#fff; padding:10px; display:flex; justify-content:center;">
        <iframe
          src="https://yandex.ru/sprav/widget/rating-badge/11046753996?type=rating"
          width="150"
          height="50"
          frameborder="0"
          style="border:0; display:block;"
        ></iframe>
      </div>
      <div style="text-align:center; font-size:12px; opacity:.75; margin-top:6px;">
        –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –æ—Ç–∑—ã–≤—ã —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.
      </div>
      <div style="display:flex; justify-content:center; margin-top:8px;">
        <button class="btn" style="min-width:auto; padding:10px 14px;" onclick="openYandexReviews(event)">
          –û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã
        </button>
      </div>
    </div>

    <a class="menu-item" href="tel:+998905050745" onclick="closeTopMenu()">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub">+998 90 505 07 45</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <a class="menu-item" href="#" onclick="openInstagram(event)">
      <div class="menu-left">
        <div class="menu-ic" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" style="display:block;">
            <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4.3A5.7 5.7 0 1 1 6.3 14 5.7 5.7 0 0 1 12 8.3zm0 2A3.7 3.7 0 1 0 15.7 14 3.7 3.7 0 0 0 12 10.3zM18 6.7a1 1 0 1 1-1 1 1 1 0 0 1 1-1z"/>
          </svg>
        </div>
        <div class="menu-txt">
          <div class="menu-name">@choko_art_motrid</div>
          <div class="menu-sub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üåì</div>
        <div class="menu-txt">
          <div class="menu-name">–¢–µ–º–∞</div>
          <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
        </div>
      </div>
      <div class="menu-right" id="themeMenuRight">–°–º–µ–Ω–∏—Ç—å</div>
    </div>

    <div class="menu-item" onclick="openAbout()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚ÑπÔ∏è</div>
        <div class="menu-txt">
          <div class="menu-name">–û –Ω–∞—Å</div>
          <div class="menu-sub">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Bakery CHOKOART</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>
  </div>
</div>

<div class="about-modal" id="aboutModal" onclick="aboutBackdropClick(event)">
  <div class="about-card">
    <div class="about-head">
      <b>–û –Ω–∞—Å</b>
      <button class="menu-close" onclick="closeAbout()">√ó</button>
    </div>
    <div class="about-body" id="aboutBody"></div>
  </div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="popular-wrap" id="popularWrap">
  <div class="popular-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
  <div class="popular-row" id="popularRow"></div>
</div>

<!-- ‚úÖ‚úÖ‚úÖ –ù–æ–≤–∏–Ω–∫–∏ (–∫–∞—Ä—É—Å–µ–ª—å –∏–∫–æ–Ω–æ–∫) -->
<div class="popular-wrap" id="newWrap">
  <div class="popular-title" id="newTitle">üÜï –ù–æ–≤–∏–Ω–∫–∏</div>
  <div class="mini-row" id="newRow"></div>
</div>

<!-- ‚úÖ‚úÖ‚úÖ –î–ª—è –ø–æ–¥–∞—Ä–∫–∞ (–∫–∞—Ä—É—Å–µ–ª—å –∏–∫–æ–Ω–æ–∫) -->
<div class="popular-wrap" id="giftWrap">
  <div class="popular-title" id="giftTitle">üéÅ –î–ª—è –ø–æ–¥–∞—Ä–∫–∞</div>
  <div class="mini-row" id="giftRow"></div>
</div>

<div class="quick-filters" id="quickFilters"></div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>

<!-- ‚úÖ –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
<div class="subcat-btn-wrap" id="subcatBtnWrap">
  <button class="subcat-open" onclick="openSubcats()">
    <span id="subcatBtnText">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
    <small id="subcatBtnRight">‚Ä∫</small>
  </button>
</div>

<!-- ‚úÖ –æ–∫–Ω–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å–Ω–∏–∑—É -->
<div class="subcat-backdrop" id="subcatBackdrop" onclick="closeSubcats()"></div>
<div class="subcat-sheet" id="subcatSheet">
  <div class="menu-handle"></div>
  <div class="subcat-head">
    <b id="subcatSheetTitle">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</b>
    <button class="menu-close" onclick="closeSubcats()">√ó</button>
  </div>
  <div class="subcat-grid" id="subcatGrid"></div>

  <!-- ‚úÖ –≤–Ω–∏–∑—É –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π: "–í—Å–µ —Ç–æ—Ä—Ç—ã" (–ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –¢–æ—Ä—Ç–∞—Ö) -->
  <div class="subcat-footer" id="subcatFooter" style="display:none;">
    <button class="subcat-open" onclick="pickAllCakesFromFooter()">
      <span>üéÇ <span id="allCakesText">–í—Å–µ —Ç–æ—Ä—Ç—ã</span></span>
      <small>‚úì</small>
    </button>
  </div>
</div>

<div class="products" id="products"></div>

<div class="cart" id="cartBox">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º

  <!-- ‚úÖ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å—É–º–º—ã + –¥–æ—Å—Ç–∞–≤–∫–∞ -->
  <div class="cart-lines">
    <div class="cart-line"><span id="lineItemsLabel">–¢–æ–≤–∞—Ä—ã</span><span id="itemsTotal">0</span></div>
    <div class="cart-line"><span id="lineDeliveryLabel">–î–æ—Å—Ç–∞–≤–∫–∞ (–°–∞–º–∞—Ä–∫–∞–Ω–¥)</span><span id="deliveryFee">0</span></div>
    <div class="cart-divider"></div>
    <div class="cart-line"><span id="lineGrandLabel">–ò—Ç–æ–≥–æ</span><span id="grandTotal">0</span></div>
  </div>

  <textarea id="comment" class="input"></textarea>
  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>
  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
</div>

<div class="popup" id="popup"><div class="popup-box">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div></div>

<div class="sticky-checkout">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small>—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="openCart()" id="stickyCartBtn">–ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</div>

<script>
Telegram.WebApp.ready();

/* ‚úÖ –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –°–∞–º–∞—Ä–∫–∞–Ω–¥—É */
const DELIVERY_FEE_SAMARKAND = 10000;

/* ‚úÖ –º–∞—Ä—à—Ä—É—Ç */
function openRoute(){
  const url = "https://yandex.uz/maps/?rtext=~39.684041,66.960593&rtt=auto&z=16.65";
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}

function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const tel = "tel:+998905050745";
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(tel);
      return;
    }
  }catch(_){}
  try{ window.location.href = tel; }catch(_){}
}

function openTopMenu(){
  try{ closeSearch(); }catch(_){}
  document.getElementById('menuBackdrop').classList.add('show');
  document.getElementById('menuSheet').classList.add('show');
}
function closeTopMenu(){
  document.getElementById('menuBackdrop').classList.remove('show');
  document.getElementById('menuSheet').classList.remove('show');
}

function toggleReviewWidget(){
  const w = document.getElementById('reviewWidgetWrap');
  w.style.display = (w.style.display === 'none' || !w.style.display) ? 'block' : 'none';
}

/* ‚úÖ –æ—Ç–∑—ã–≤—ã */
const YANDEX_REVIEWS_URL = "https://yandex.uz/maps/org/239856130727/?ll=66.960593%2C39.684041&mode=search&sctx=ZAAAAAgBEAAaKAoSCaetEcE4MVFAEfxVgO82QURAEhIJDJQUWABT1j8RPUfku5S6xD8iBgABAgMEBSgKOABA1LoGSAFiJHNuaXBwZXRfZXhwX25hbWU9ZnVsbG9iamVjdHMvMS54OnJlZmIjc25pcHBldF9leHBfbmFtZT10b3BvYmplY3RzLzEueDpyZWZiHnNuaXBwZXRfZXhwX25hbWU9Z29vZHMvMS54OnJlZmInc25pcHBldF9leHBfbmFtZT1nb29kc19yZWdpc3Rlci8xLng6cmVmYgtmcmVzaG5lc3M9MGIXc291cmNlPWJ1c2luZXNzOmV4cF9yZWZiFXNvdXJjZT1wcmljZXM6ZXhwX3JlZmoCdXqdAc3MzD2gAQCoAQC9AXc%2FZizCAQantajE%2FQaCAg9iYWtlcnkgY2hva29hcnSKAgCSAgCaAgxkZXNrdG9wLW1hcHM%3D&sll=66.960593%2C39.684041&sspn=0.013893%2C0.006530&text=bakery%20chokoart&z=16.65";
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = YANDEX_REVIEWS_URL;
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}

function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = "https://www.instagram.com/choko_art_motrid/";
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}

/* —Ç–µ–º–∞ */
function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('chokoart_theme', theme);

  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (theme === 'dark') ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';

  try{
    if (window.Telegram && Telegram.WebApp){
      Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
      Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
    }
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  const next = (cur === 'dark') ? 'light' : 'dark';
  applyTheme(next);
}

/* –û –Ω–∞—Å */
const ABOUT_TEXT = `üá∑üá∫ –†—É—Å—Å–∫–∏–π

Bakery CHOKOART ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –¥–µ—Å–µ—Ä—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∏—Å–∫—É—Å—Å—Ç–≤–æ–º üç´‚ú®
–ú—ã —Å–æ–∑–¥–∞—ë–º –∞–≤—Ç–æ—Ä—Å–∫–∏–µ —Ç–æ—Ä—Ç—ã, –∏–∑—ã—Å–∫–∞–Ω–Ω—É—é –≤—ã–ø–µ—á–∫—É –∏ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ —à–µ–¥–µ–≤—Ä—ã –∏–∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, —Å –ª—é–±–æ–≤—å—é –∫ –¥–µ—Ç–∞–ª—è–º –∏ –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤ –ø–æ –≤–∫—É—Å—É.

–ö–∞–∂–¥—ã–π –¥–µ—Å–µ—Ä—Ç –≤ CHOKOART ‚Äî —ç—Ç–æ –±–∞–ª–∞–Ω—Å —ç—Å—Ç–µ—Ç–∏–∫–∏, —Å–≤–µ–∂–µ—Å—Ç–∏ –∏ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è. –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –∫–∞–∫ –¥–ª—è –æ—Å–æ–±–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π, —Ç–∞–∫ –∏ –¥–ª—è —Ç–µ—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∫–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –ø–æ—Ä–∞–¥–æ–≤–∞—Ç—å —Å–µ–±—è –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫.

üìç –°–∞–º–∞—Ä–∫–∞–Ω–¥, —É–ª. –ú–æ—Ç—Ä–∏–¥, 103V
üìû +998 90 505 07 45
üìû +998 95 500 62 62

CHOKOART ‚Äî —Å–ª–∞–¥–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –¥–ª—è –≤–∞—Å.

üá∫üáø O‚Äòzbekcha (lotin)

Bakery CHOKOART ‚Äî shirinliklar san‚Äôatga aylanadigan maskan üç´‚ú®
Biz tabiiy ingredientlardan, mayda tafsilotlarga mehr bilan yondashib, ta‚Äômdan hech qanday murosasiz mualliflik tortlar, nafis pishiriqlar va shokolad asarlarini tayyorlaymiz.

CHOKOARTdagi har bir desert ‚Äî bu estetika, yangilik va haqiqiy rohatning mukammal muvozanati. Biz ham muhim tadbirlar, ham o‚Äòzingizni shunchaki xursand qilishni istagan onlar uchun xizmat qilamiz.

üìç Samarqand, Motrid ko‚Äòchasi, 103V
üìû +998 90 505 07 45
üìû +998 95 500 62 62

CHOKOART ‚Äî siz uchun yaratilgan shirin san‚Äôat.

üá¨üáß English

Bakery CHOKOART is a place where desserts become art üç´‚ú®
We create signature cakes, refined pastries, and chocolate masterpieces using natural ingredients, with love for every detail and no compromise on taste.

Every dessert at CHOKOART is a perfect balance of aesthetics, freshness, and true enjoyment. We craft sweets for special occasions as well as for moments when you simply want to treat yourself.

üìç Samarkand, Motrid Street, 103V
üìû +998 90 505 07 45
üìû +998 95 500 62 62

CHOKOART ‚Äî sweet art created for you.`;

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function openAbout(){
  closeTopMenu();
  const el = document.getElementById('aboutBody');
  if(el){
    el.innerHTML = `<div class="t">${escapeHtml(ABOUT_TEXT)}</div>`;
    el.scrollTop = 0;
  }
  document.getElementById('aboutModal').classList.add('show');
}
function closeAbout(){
  document.getElementById('aboutModal').classList.remove('show');
}
function aboutBackdropClick(e){
  if(e.target && e.target.id === 'aboutModal') closeAbout();
}

(function initTheme(){
  const saved = localStorage.getItem('chokoart_theme');
  if(saved === 'dark' || saved === 'light'){
    applyTheme(saved);
  }else{
    const tgTheme = (window.Telegram && Telegram.WebApp && Telegram.WebApp.colorScheme) ? Telegram.WebApp.colorScheme : 'light';
    applyTheme(tgTheme === 'dark' ? 'dark' : 'light');
  }
})();

const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

let lang='ru',category='cheesecakes',type='delivery',payment='cash',cart={};
let subcat = 'all';

const TEXT={
  ru:{
    delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',
    pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',
    address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',
    phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',
    cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',
    order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',
    comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',
    cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',
    click:'üí≥ CLICK',
    results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',
    popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ',
    empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è',
    subcats:'–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
    new:'üÜï –ù–æ–≤–∏–Ω–∫–∏',
    gift:'üéÅ –î–ª—è –ø–æ–¥–∞—Ä–∫–∞',
    items:'–¢–æ–≤–∞—Ä—ã',
    deliveryFee:'–î–æ—Å—Ç–∞–≤–∫–∞ (–°–∞–º–∞—Ä–∫–∞–Ω–¥)',
    total:'–ò—Ç–æ–≥–æ',
    all:'–í—Å–µ',
    allCakes:'–í—Å–µ —Ç–æ—Ä—Ç—ã'
  },
  uz:{
    delivery:'üöö Yetkazish',
    pickup:'üèÉ Olib ketish',
    address:'üìç Manzil',
    phone:'üìû Telefon',
    cart:'üõí Savat',
    order:'Buyurtma berish',
    comment:'‚úçÔ∏è Izoh',
    cash:'üíµ Naqd',
    click:'üí≥ CLICK',
    results:'Qidiruv natijalari',
    popular:'üî• Ommabop',
    empty:"Savat bo‚Äòsh",
    subcats:'Subkategoriyalar',
    new:'üÜï Yangi',
    gift:'üéÅ Sovg‚Äòa uchun',
    items:'Mahsulotlar',
    deliveryFee:'Yetkazish (Samarqand)',
    total:'Jami',
    all:'Barchasi',
    allCakes:'Barcha tortlar'
  },
  en:{
    delivery:'üöö Delivery',
    pickup:'üèÉ Pickup',
    address:'üìç Address',
    phone:'üìû Phone',
    cart:'üõí Cart',
    order:'Place order',
    comment:'‚úçÔ∏è Comment',
    cash:'üíµ Cash',
    click:'üí≥ CLICK',
    results:'Search results',
    popular:'üî• Popular',
    empty:'Cart is empty',
    subcats:'Subcategories',
    new:'üÜï New',
    gift:'üéÅ For gift',
    items:'Items',
    deliveryFee:'Delivery (Samarkand)',
    total:'Total',
    all:'All',
    allCakes:'All cakes'
  }
};

const CATS={
  ru:{cheesecakes:'üç∞ –ß–∏–∑–∫–µ–π–∫–∏',cakes:'üéÇ –¢–æ—Ä—Ç—ã',rolls:'üç• –†—É–ª–µ—Ç—ã',bakery:'ü•ê –í—ã–ø–µ—á–∫–∞',cookies:'üç™ –ü–µ—á–µ–Ω—å–µ',desserts:'üç® –î–µ—Å–µ—Ä—Ç—ã',pies:'ü•ß –ü–∏—Ä–æ–≥–∏'},
  uz:{cheesecakes:'üç∞ Chizkeyklar',cakes:'üéÇ Tortlar',rolls:'üç• Rulolar',bakery:'ü•ê Pishiriqlar',cookies:'üç™ Pechenye',desserts:'üç® Desertlar',pies:'ü•ß Piroglar'},
  en:{cheesecakes:'üç∞ Cheesecakes',cakes:'üéÇ Cakes',rolls:'üç• Rolls',bakery:'ü•ê Pastry',cookies:'üç™ Cookies',desserts:'üç® Desserts',pies:'ü•ß Pies'}
};

/* ‚úÖ –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
const SUBCATS = {
  cakes: [
    {id:'wedding', ic:'üíç', n:{ru:'–°–≤–∞–¥–µ–±–Ω—ã–µ —Ç–æ—Ä—Ç—ã', uz:'To‚Äòy tortlari', en:'Wedding cakes'}},
    {id:'bento', ic:'üç±', n:{ru:'–ë–µ–Ω—Ç–æ —Ç–æ—Ä—Ç—ã', uz:'Bento tortlar', en:'Bento cakes'}},
    {id:'rollcakes', ic:'üç•', n:{ru:'–¢–æ—Ä—Ç—ã —Ä—É–ª–µ—Ç—ã', uz:'Rulet tortlar', en:'Roll cakes'}},
    {id:'events', ic:'üéâ', n:{ru:'–¢–æ—Ä—Ç—ã –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', uz:'Tadbir tortlari', en:'Event cakes'}}
  ],
  bakery: [
    {id:'savory', ic:'ü•®', n:{ru:'–ù–µ—Å–ª–∞–¥–∫–∞—è –≤—ã–ø–µ—á–∫–∞', uz:'Shirin bo‚Äòlmagan pishiriq', en:'Savory pastry'}},
    {id:'sweet', ic:'ü•ê', n:{ru:'–°–¥–æ–±–Ω–∞—è –≤—ã–ø–µ—á–∫–∞', uz:'Sdobali pishiriq', en:'Sweet pastry'}},
    {id:'puff', ic:'ü•Ø', n:{ru:'–°–ª–æ—ë–Ω–∞—è –≤—ã–ø–µ—á–∫–∞', uz:'Qavatli pishiriq', en:'Puff pastry'}}
  ],
  cookies: [
    {id:'shortbread', ic:'üßà', n:{ru:'–ü–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ', uz:'Qumli pechenye', en:'Shortbread'}},
    {id:'filled', ic:'üç´', n:{ru:'–ü–µ—á–µ–Ω—å–µ —Å –Ω–∞—á–∏–Ω–∫–æ–π', uz:'Nachinkali pechenye', en:'Filled cookies'}}
  ],
  desserts: [
    {id:'mousse', ic:'üçÆ', n:{ru:'–ú—É—Å—Å–æ–≤—ã–µ –¥–µ—Å–µ—Ä—Ç—ã', uz:'Musli desertlar', en:'Mousse desserts'}},
    {id:'mini', ic:'üßÅ', n:{ru:'–ú–∏–Ω–∏ –¥–µ—Å–µ—Ä—Ç—ã', uz:'Mini desertlar', en:'Mini desserts'}}
  ],
  pies: [
    {id:'sliced', ic:'üç∞', n:{ru:'–ù–∞—Ä–µ–∑–Ω—ã–µ –ø–∏—Ä–æ–≥–∏', uz:'Bo‚Äòlaklangan piroglar', en:'Sliced pies'}},
    {id:'whole', ic:'ü•ß', n:{ru:'–¶–µ–ª—ã–µ –ø–∏—Ä–æ–≥–∏', uz:'Butun piroglar', en:'Whole pies'}}
  ]
};

/* ‚úÖ –º–µ–Ω—é */
const MENU = {
  cheesecakes:[
    {id:'cheesecake_classic', p:45000, img:'images/cheesecake_classic.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', uz:'Klassik chizkeyk', en:'Classic cheesecake'}},
    {id:'cheesecake_oreo', p:48000, img:'images/cheesecake_oreo.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ Oreo', uz:'Oreo chizkeyk', en:'Oreo cheesecake'}}
  ],
  cakes:[
    {id:'cake_redvelvet', p:52000, img:'images/cake_redvelvet.png', sub:'events', n:{ru:'–¢–æ—Ä—Ç Red Velvet', uz:'Red Velvet tort', en:'Red Velvet cake'}},
    {id:'cake_choco', p:54000, img:'images/cake_choco.png', sub:'bento', n:{ru:'–®–æ–∫–æ–ª–∞–¥–Ω—ã–π —Ç–æ—Ä—Ç', uz:'Shokolad tort', en:'Chocolate cake'}}
  ],
  rolls:[
    {id:'roll_choco', p:35000, img:'images/roll_choco.png', n:{ru:'–†—É–ª–µ—Ç —à–æ–∫–æ–ª–∞–¥–Ω—ã–π', uz:'Shokolad rulet', en:'Chocolate roll'}},
    {id:'roll_berry', p:36000, img:'images/roll_berry.png', n:{ru:'–†—É–ª–µ—Ç —è–≥–æ–¥–Ω—ã–π', uz:'Mevali rulet', en:'Berry roll'}}
  ],
  bakery:[
    {id:'croissant', p:18000, img:'images/croissant.png', sub:'sweet', n:{ru:'–ö—Ä—É–∞—Å—Å–∞–Ω', uz:'Kruassan', en:'Croissant'}},
    {id:'danish', p:20000, img:'images/danish.png', sub:'puff', n:{ru:'–î–∞—Ç—Å–∫–∞—è –≤—ã–ø–µ—á–∫–∞', uz:'Daniya pishirig‚Äòi', en:'Danish pastry'}}
  ],
  cookies:[
    {id:'cookie_choco', p:12000, img:'images/cookie_choco.png', sub:'filled', n:{ru:'–ü–µ—á–µ–Ω—å–µ —à–æ–∫–æ–ª–∞–¥–Ω–æ–µ', uz:'Shokolad pechenye', en:'Chocolate cookie'}},
    {id:'cookie_nuts', p:13000, img:'images/cookie_nuts.png', sub:'shortbread', n:{ru:'–ü–µ—á–µ–Ω—å–µ —Å –æ—Ä–µ—Ö–æ–º', uz:'Yong‚Äòoqli pechenye', en:'Nut cookie'}}
  ],
  desserts:[
    {id:'dessert_tiramisu', p:38000, img:'images/dessert_tiramisu.png', sub:'mousse', n:{ru:'–¢–∏—Ä–∞–º–∏—Å—É', uz:'Tiramisu', en:'Tiramisu'}},
    {id:'dessert_trifle', p:36000, img:'images/dessert_trifle.png', sub:'mini', n:{ru:'–¢—Ä–∞–π—Ñ–ª', uz:'Trifle', en:'Trifle'}}
  ],
  pies:[
    {id:'pie_apple', p:32000, img:'images/pie_apple.png', sub:'whole', n:{ru:'–ü–∏—Ä–æ–≥ —è–±–ª–æ—á–Ω—ã–π', uz:'Olmali pirog', en:'Apple pie'}},
    {id:'pie_cherry', p:34000, img:'images/pie_cherry.png', sub:'sliced', n:{ru:'–ü–∏—Ä–æ–≥ –≤–∏—à–Ω—ë–≤—ã–π', uz:'Gilosli pirog', en:'Cherry pie'}}
  ]
};

const POPULAR = ['cheesecake_classic','cake_choco','dessert_tiramisu','croissant'];

/* ‚úÖ‚úÖ‚úÖ –∫–∞—Ä—É—Å–µ–ª–∏ */
const NEW_ITEMS = ['cheesecake_oreo','roll_berry','danish','dessert_trifle'];
const GIFT_ITEMS = ['cake_redvelvet','cookie_choco','dessert_tiramisu','pie_cherry'];

/* –∏–Ω–¥–µ–∫—Å */
const ITEM_INDEX = {};
for (const c in MENU){ MENU[c].forEach(it => { ITEM_INDEX[it.id] = it; }); }

function nameOf(id){
  const it = ITEM_INDEX[id];
  if(!it) return id;
  return (it.n && (it.n[lang] || it.n.ru)) || id;
}
function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function highlight(name, q){
  const n = escapeHtml(name);
  if(!q) return n;
  const idx = n.toLowerCase().indexOf(q.toLowerCase());
  if(idx === -1) return n;
  const before = n.slice(0, idx);
  const mid = n.slice(idx, idx + q.length);
  const after = n.slice(idx + q.length);
  return `${before}<mark>${mid}</mark>${after}`;
}

function loadSaved(){
  const a = localStorage.getItem('chokoart_address') || '';
  const p = localStorage.getItem('chokoart_phone') || '';
  if(a && !address.value) address.value = a;
  if(p && !phone.value) phone.value = p;
  if(!phone.value) phone.value = "+998 90 505 07 45";
}
function bindSave(){
  address.addEventListener('input', ()=>localStorage.setItem('chokoart_address', address.value));
  phone.addEventListener('input', ()=>localStorage.setItem('chokoart_phone', phone.value));
}

function updateTypeFields(){
  if(type === 'pickup'){
    address.style.display = 'none';
    address.value = '';
  }else{
    address.style.display = 'block';
  }
}

function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}

function applyLang(){
  btnDelivery.innerText=TEXT[lang].delivery;
  btnPickup.innerText=TEXT[lang].pickup;
  address.placeholder=TEXT[lang].address;
  phone.placeholder=TEXT[lang].phone;
  cartTitle.innerText=TEXT[lang].cart;
  orderBtn.innerText=TEXT[lang].order;
  comment.placeholder=TEXT[lang].comment;
  payCash.innerText=TEXT[lang].cash;
  payClick.innerText=TEXT[lang].click;
  searchTitle.innerText = TEXT[lang].results;
  popularTitle.innerText = TEXT[lang].popular;
  stickyCartBtn.innerText = TEXT[lang].cart;

  newTitle.innerText = TEXT[lang].new;
  giftTitle.innerText = TEXT[lang].gift;

  subcatBtnText.innerText = TEXT[lang].subcats;
  subcatSheetTitle.innerText = TEXT[lang].subcats;

  lineItemsLabel.innerText = TEXT[lang].items;
  lineDeliveryLabel.innerText = TEXT[lang].deliveryFee;
  lineGrandLabel.innerText = TEXT[lang].total;

  allCakesText.innerText = TEXT[lang].allCakes;

  renderPopular();
  renderNew();
  renderGift();

  renderQuickFilters();
  renderCats();

  refreshSubcatButton();
  updateSubcatUI();

  renderProducts();
  updateTotal();
  updateTypeFields();
}

function openCart(){
  try{ cartBox.scrollIntoView({behavior:'smooth', block:'start'}); }
  catch(_){ window.location.hash = '#cartBox'; }
}

/* –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ */
function renderPopular(){
  popularRow.innerHTML = '';
  POPULAR.forEach((id)=>{
    const it = ITEM_INDEX[id];
    if(!it) return;
    cart[id]=cart[id]||0;

    popularRow.innerHTML += `
      <div class="pop-card" onclick="onPopularCardClick(event,'${id}')">
        <div class="pop-badge">üî•</div>
        <div class="pop-img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
        <div class="pop-name">${escapeHtml(nameOf(id))}</div>
        <div class="pop-price">${formatSum(it.p)} <small>—Å—É–º</small></div>

        <div class="pop-counter">
          <button type="button" onclick="popChg(event,'${id}',-1)">‚àí</button>
          <span id="pc_${id}">${cart[id]||0}</span>
          <button type="button" onclick="popChg(event,'${id}',1)">+</button>
        </div>
      </div>
    `;
  });
}
function onPopularCardClick(e,id){
  if(e && e.target && (e.target.closest && e.target.closest('button'))) return;
  chg(id, 1);
  const pc = document.getElementById('pc_'+id);
  if(pc) pc.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}
function popChg(e,id,delta){
  if(e){ e.preventDefault(); e.stopPropagation(); }
  chg(id, delta);
  const pc = document.getElementById('pc_'+id);
  if(pc) pc.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}

/* ‚úÖ –º–∏–Ω–∏-–∫–∞—Ä—É—Å–µ–ª–∏ */
function miniCardHTML(id, badge){
  const it = ITEM_INDEX[id];
  if(!it) return '';
  cart[id]=cart[id]||0;
  return `
    <div class="mini-card" onclick="onMiniCardClick(event,'${id}')">
      <div class="mini-badge">${badge}</div>
      <div class="mini-img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
      <div class="mini-name">${escapeHtml(nameOf(id))}</div>
      <div class="mini-price">${formatSum(it.p)} <small>—Å—É–º</small></div>
      <div class="mini-counter">
        <button type="button" onclick="miniChg(event,'${id}',-1)">‚àí</button>
        <span id="mc_${id}">${cart[id]||0}</span>
        <button type="button" onclick="miniChg(event,'${id}',1)">+</button>
      </div>
    </div>
  `;
}
function renderNew(){
  newRow.innerHTML = '';
  NEW_ITEMS.forEach(id => newRow.innerHTML += miniCardHTML(id,'üÜï'));
}
function renderGift(){
  giftRow.innerHTML = '';
  GIFT_ITEMS.forEach(id => giftRow.innerHTML += miniCardHTML(id,'üéÅ'));
}
function onMiniCardClick(e,id){
  if(e && e.target && (e.target.closest && e.target.closest('button'))) return;
  chg(id, 1);
  const el = document.getElementById('mc_'+id);
  if(el) el.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}
function miniChg(e,id,delta){
  if(e){ e.preventDefault(); e.stopPropagation(); }
  chg(id, delta);
  const el = document.getElementById('mc_'+id);
  if(el) el.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}

/* –±—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã */
function renderQuickFilters(){
  const keys = ['cheesecakes','cakes','desserts','bakery'];
  quickFilters.innerHTML = '';
  keys.forEach(k=>{
    if(!MENU[k]) return;
    quickFilters.innerHTML += `<button class="qbtn" onclick="pickCategory('${k}')">${CATS[lang][k]}</button>`;
  });
}
function pickCategory(k){
  if(isSearchOpen()) closeSearch();
  category = k;
  subcat = 'all';
  renderCats();
  refreshSubcatButton();
  updateSubcatUI();
  renderProducts();
}

/* ‚úÖ –∫–Ω–æ–ø–∫–∞/–æ–∫–Ω–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π */
function openSubcats(){
  if(!SUBCATS[category] || !SUBCATS[category].length) return;
  document.getElementById('subcatBackdrop').classList.add('show');
  document.getElementById('subcatSheet').classList.add('show');
  renderSubcatGrid();
}
function closeSubcats(){
  document.getElementById('subcatBackdrop').classList.remove('show');
  document.getElementById('subcatSheet').classList.remove('show');
}
function subcatName(sc){
  return (sc.n && (sc.n[lang] || sc.n.ru)) || '';
}
function renderSubcatGrid(){
  const grid = document.getElementById('subcatGrid');
  grid.innerHTML = '';

  // "–í—Å–µ" –ø–µ—Ä–≤—ã–º
  grid.innerHTML += `
    <div class="subcat-tile ${subcat==='all'?'active':''}" onclick="setSubcat('all')">
      <div class="subcat-ic">‚ú®</div>
      <div class="subcat-nm">${escapeHtml(TEXT[lang].all)}</div>
    </div>
  `;

  const list = SUBCATS[category] || [];
  list.forEach(sc=>{
    grid.innerHTML += `
      <div class="subcat-tile ${subcat===sc.id?'active':''}" onclick="setSubcat('${sc.id}')">
        <div class="subcat-ic">${sc.ic}</div>
        <div class="subcat-nm">${escapeHtml(subcatName(sc))}</div>
      </div>
    `;
  });

  // ‚úÖ –≤–Ω–∏–∑—É "–í—Å–µ —Ç–æ—Ä—Ç—ã" —Ç–æ–ª—å–∫–æ –¥–ª—è –¢–æ—Ä—Ç—ã
  const footer = document.getElementById('subcatFooter');
  footer.style.display = (category === 'cakes') ? 'block' : 'none';
}
function setSubcat(id){
  subcat = id;
  renderProducts();
  refreshSubcatButton();
  renderSubcatGrid();
}
function pickAllCakesFromFooter(){
  subcat = 'all';
  renderProducts();
  refreshSubcatButton();
  closeSubcats();
}
function updateSubcatUI(){
  const btnWrap = document.getElementById('subcatBtnWrap');
  if(SUBCATS[category] && SUBCATS[category].length){
    btnWrap.style.display = '';
  }else{
    btnWrap.style.display = 'none';
    subcat = 'all';
  }
}
function refreshSubcatButton(){
  const right = document.getElementById('subcatBtnRight');
  if(!right) return;

  if(subcat === 'all'){
    right.innerText = (category === 'cakes') ? TEXT[lang].allCakes : TEXT[lang].all;
    return;
  }
  const list = SUBCATS[category] || [];
  const sc = list.find(x => x.id === subcat);
  right.innerText = sc ? subcatName(sc) : '‚Ä∫';
}

function renderCats(){
  cats.innerHTML='';
  for(let k in MENU){
    cats.innerHTML+=`<button class="btn ${k===category?'active':''}" onclick="category='${k}';subcat='all';renderCats();refreshSubcatButton();updateSubcatUI();renderProducts()">${CATS[lang][k] || k}</button>`;
  }
  setTimeout(()=>{
    const active = cats.querySelector('.btn.active');
    if(active && active.scrollIntoView){
      active.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
    }
  }, 50);
}

function cardHTML(it, q=''){
  const id = it.id;
  const displayName = nameOf(id);
  const nameHtml = highlight(displayName, q);
  const qty = cart[id] || 0;

  return `<div class="card">
    <div class="img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
    <div class="item-name">${nameHtml}</div>
    <div class="price">${formatSum(it.p)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button onclick="chg('${id}',-1)">‚àí</button>
      <span id="c_${id}">${qty}</span>
      <button onclick="chg('${id}',1)">+</button>
    </div>
  </div>`;
}

function renderProducts(){
  products.innerHTML='';
  const list = (MENU[category] || []).filter(it=>{
    if(subcat === 'all') return true;
    return String(it.sub || '') === String(subcat);
  });

  list.forEach((it)=>{
    cart[it.id]=cart[it.id]||0;
    products.innerHTML+=cardHTML(it,'');
  });
}

function syncPopularCounters(){
  POPULAR.forEach((id)=>{
    const el = document.getElementById('pc_'+id);
    if(el) el.innerText = cart[id] || 0;
  });
}
function syncMiniCounters(){
  [...NEW_ITEMS, ...GIFT_ITEMS].forEach((id)=>{
    const el = document.getElementById('mc_'+id);
    if(el) el.innerText = cart[id] || 0;
  });
}
function chg(id,v){
  cart[id]=Math.max(0,(cart[id]||0)+v);
  const el = document.getElementById('c_'+id);
  if(el) el.innerText=cart[id];
  updateTotal();
  syncPopularCounters();
  syncMiniCounters();
}
function price(id){
  return (ITEM_INDEX[id] && ITEM_INDEX[id].p) ? ITEM_INDEX[id].p : 0;
}
function calcItemsSum(){
  let s=0;
  for(let id in cart) s += (cart[id]||0) * price(id);
  return s;
}
function calcDeliveryFee(){
  // –¥–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω delivery
  if(type !== 'delivery') return 0;
  return DELIVERY_FEE_SAMARKAND;
}
function updateTotal(){
  const itemsSum = calcItemsSum();
  const deliveryFee = calcDeliveryFee();
  const grand = itemsSum + deliveryFee;

  // –æ—Å—Ç–∞–≤–∏–ª–∏ —Å—Ç–∞—Ä—ã–π total –∫–∞–∫ "–∏—Ç–æ–≥–æ"
  total.innerText = formatSum(grand);
  stickyTotal.innerText = formatSum(grand);

  itemsTotal.innerText = formatSum(itemsSum);
  deliveryFeeEl = document.getElementById('deliveryFee');
  deliveryFeeEl.innerText = formatSum(deliveryFee);
  grandTotal.innerText = formatSum(grand);
}

function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  updateTypeFields();
  updateTotal(); // ‚úÖ –æ–±–Ω–æ–≤–ª—è–µ–º —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π
}
function setPayment(p){
  payment=p;
  payCash.classList.toggle('active',p==='cash');
  payClick.classList.toggle('active',p==='click');
}

function isSearchOpen(){ return searchWrap.classList.contains('show'); }
function toggleSearch(){ if(isSearchOpen()) closeSearch(); else openSearch(); }
function openSearch(){
  document.body.classList.add('searching');
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  cats.style.display = 'none';
  quickFilters.style.display = 'none';
  popularWrap.style.display = 'none';
  searchInput.value = '';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  document.body.classList.remove('searching');
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  cats.style.display = '';
  quickFilters.style.display = '';
  popularWrap.style.display = '';
  searchInput.value = '';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key === 'Enter') closeSearch(); }

function searchProducts(){
  const q = (searchInput.value || '').trim().toLowerCase();
  products.innerHTML='';
  if(!q){
    renderProducts();
    return;
  }
  for(let c in MENU){
    MENU[c].forEach((it)=>{
      const nmRu = (it.n && it.n.ru) ? String(it.n.ru).toLowerCase() : '';
      const nmUz = (it.n && it.n.uz) ? String(it.n.uz).toLowerCase() : '';
      const nmEn = (it.n && it.n.en) ? String(it.n.en).toLowerCase() : '';
      const nmCur = (it.n && it.n[lang]) ? String(it.n[lang]).toLowerCase() : '';
      if(nmCur.includes(q) || nmRu.includes(q) || nmUz.includes(q) || nmEn.includes(q)){
        cart[it.id]=cart[it.id]||0;
        products.innerHTML += cardHTML(it, q);
      }
    });
  }
}
document.addEventListener('click', (e)=>{
  if(!isSearchOpen()) return;
  const t = e.target;
  const insideSearch = searchWrap.contains(t) || searchTitle.contains(t);
  const onBtn = t.closest && t.closest('.search-btn');
  if(!insideSearch && !onBtn) closeSearch();
}, true);

function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `chokoart_seq_${d.getFullYear()}${mm}${dd}`;
  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));
  const num = String(n).padStart(3,'0');
  return `CHK-${dd}${mm}-${num}`;
}

function sendOrder(){
  popup.classList.add('show');

  const items = [];
  for (const id in cart) {
    const qty = Number(cart[id] || 0);
    if (qty > 0) {
      const it = ITEM_INDEX[id] || {};
      items.push({
        id,
        qty,
        price: it.p || 0,
        name_ru: (it.n && it.n.ru) ? it.n.ru : id,
        name_lang: nameOf(id)
      });
    }
  }

  if (items.length === 0) {
    popup.classList.remove('show');
    alert(TEXT[lang].empty);
    return;
  }

  const items_sum = calcItemsSum();
  const delivery_fee = calcDeliveryFee();
  const grand_total_num = items_sum + delivery_fee;

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    items,
    items_sum,
    delivery_fee,
    total_num: grand_total_num,
    total: formatSum(grand_total_num),
    payment,
    type,
    address: (type==='pickup' ? '' : address.value),
    phone: phone.value,
    comment: comment.value,
    order_id: genOrderId(),
    lang,
    category,
    subcat
  };

  setTimeout(()=>{
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  }, 700);
}

/* init */
loadSaved();
bindSave();
applyLang();
</script>
</body>
</html>
