<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Bakery CHOKOART</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Lobster&family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#F8F3E9;

  /* ‚úÖ –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤–∞—è —Ç–µ–º–∞ */
  --pink:#F6B7C8;
  --pink-2:#F2A9BE;
  --pink-deep:#E98AA6;

  /* ‚úÖ –∫—Ä–∞—Å–Ω–æ-–±–æ—Ä–¥–æ–≤—ã–π –∫–∞–∫ —Ü–µ–Ω–∞ */
  --price-red:#8B1E1E;

  --stroke: rgba(0,0,0,.08);
  --stroke-strong: rgba(0,0,0,.14);
  --inner: rgba(255,255,255,.72);
  --shadow: rgba(0,0,0,.10);
  --shadow-strong: rgba(0,0,0,.18);

  --r-lg:24px;
  --r-md:22px;
  --r-pill:28px;
}

/* ‚úÖ —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body[data-theme="dark"]{
  --bg:#121212;
  --stroke: rgba(255,255,255,.14);
  --stroke-strong: rgba(255,255,255,.22);
  --inner: rgba(255,255,255,.06);
  --shadow: rgba(0,0,0,.28);
  --shadow-strong: rgba(0,0,0,.45);
  color:#f1f1f1;
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  background:var(--bg);
  color:#2b2b2b;
  padding-bottom:88px;
}
body[data-theme="dark"]{ color:#f1f1f1; }

/* ‚úÖ‚úÖ‚úÖ –®–ê–ü–ö–ê: –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤–∞—è */
.header{
  padding:16px 12px 26px;
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  color:#fff;
  box-shadow:0 10px 26px rgba(0,0,0,.14);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  text-align:center;
}

/* ‚úÖ –õ–û–ì–û (—É–≤–µ–ª–∏—á–∏—Ç—å –≤ 1.5 —Ä–∞–∑–∞) */
.header img{
  position:absolute;
  left:12px;
  width:126px;
  height:126px;
  object-fit:contain;
  border-radius:22px;
  background:rgba(255,255,255,.10);
  padding:10px;
  border:1px solid rgba(255,255,255,.22);
  box-shadow:0 12px 26px rgba(0,0,0,.12);
}

/* ‚úÖ‚úÖ‚úÖ –°–î–í–ò–ì –¢–ï–ö–°–¢–ê –í –®–ê–ü–ö–ï –í–ü–†–ê–í–û (–ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 4 –±—É–∫–≤—ã) */
.brand-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:2px;
  transform: translateX(18px); /* ‚Üê —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç —Å–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ */
}

/* Bakery / CHOKOART */
.brand-title{
  font-family:'Lobster',cursive;
  font-size:34px;
  line-height:1;
  letter-spacing:.2px;
}
.brand-title2{
  font-family:'Montserrat',sans-serif;
  font-weight:900;
  font-size:20px;
  letter-spacing:2px;
  line-height:1.1;
}

/* –ª–æ–∑—É–Ω–≥ Lobster */
.brand-slogan{
  font-family:'Lobster',cursive;
  font-size:18px;
  opacity:.95;
  margin-top:2px;
}

.brand-phone{position:relative; z-index:50; pointer-events:auto; margin-top:4px;}
.brand-phone a{
  color:#fff;
  text-decoration:none;
  font-size:14px;
  font-weight:800;
  position:relative;
  z-index:51;
  pointer-events:auto;
  cursor:pointer;
  opacity:.95;
}

/* ‚úÖ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é (–±—É—Ä–≥–µ—Ä) */
.menu-btn{
  position:absolute;
  right:14px;
  top:12px;
  width:42px;
  height:42px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:80;

  background:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.55);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.55), 0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.menu-btn:active{transform:scale(.97);}
.burger{width:22px;height:16px;position:relative;}
.burger span{
  position:absolute;left:0;right:0;
  height:3px;border-radius:10px;
  background:#222;opacity:.9;
}
.burger span:nth-child(1){top:0;}
.burger span:nth-child(2){top:6.5px;}
.burger span:nth-child(3){bottom:0;}

/* üîç –ø–æ–∏—Å–∫ */
.search-btn{
  position:absolute;
  right:14px;
  bottom:10px;
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  z-index:60;

  color:#333;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
.search-btn:active{transform:scale(.97);}

.langs,.types,.payments{
  display:flex;
  gap:12px;
  padding:12px;
  justify-content:center;
}

/* ‚úÖ‚úÖ‚úÖ –ö–ù–û–ü–ö–ò: —Ç–µ–∫—Å—Ç –±–æ—Ä–¥–æ–≤—ã–π */
.btn{
  padding:12px 20px;
  border-radius:var(--r-pill);
  font-weight:800;
  min-width:120px;
  text-align:center;
  cursor:pointer;
  transition:.15s;

  border:1px solid var(--stroke);
  background:#fffdf9;
  color:var(--price-red);
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
}
body[data-theme="dark"] .btn{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.btn:active{transform:scale(.98);}
.btn.active{
  background:linear-gradient(135deg,var(--pink-deep),var(--pink-2));
  color:#fff;
  border:1px solid rgba(255,255,255,.42);
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.16), 0 10px 22px rgba(0,0,0,.16);
}

/* inputs */
.input{
  margin:8px auto;
  display:block;
  padding:14px;
  width:85%;
  border-radius:var(--r-md);
  font-size:15px;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  outline:none;
  transition:.15s;
}
body[data-theme="dark"] .input{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.input:focus{
  border-color: var(--stroke-strong);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px var(--shadow-strong);
}

/* categories/products */
.categories{
  display:flex;
  gap:12px;
  padding:14px;
  overflow-x:auto;
  scroll-behavior:smooth;
}

.products{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
  padding:12px;
}

.card{
  border-radius:var(--r-lg);
  padding:12px;
  text-align:center;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  transition:.15s;
}
body[data-theme="dark"] .card{
  background:rgba(255,255,255,.06);
  color:#f1f1f1;
}
.card:active{transform:scale(.99);}

.img{
  height:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:6px;
}
.img img{
  max-width:125px;
  max-height:125px;
  width:auto;
  height:auto;
  object-fit:contain;
  opacity:1;
  transform:scale(1.05);
  transition:.15s;
}
.card:active .img img{transform:scale(1.12);}

.item-name{
  margin-top:2px;
  padding:0 6px;
  font-weight:900;
  line-height:1.15;
  min-height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  word-break:break-word;
}

/* price */
.price{font-weight:900;color:var(--price-red);margin-top:6px;}
.price small{font-weight:800;opacity:.75;margin-left:4px;}

/* ‚úÖ‚úÖ‚úÖ +/- –ö–ù–û–ü–ö–ò = –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤—ã–µ */
.counter{display:flex;justify-content:center;gap:10px;margin-top:8px;align-items:center;}
.counter button{
  width:32px;
  height:32px;
  border-radius:50%;
  cursor:pointer;

  border:1px solid rgba(0,0,0,.10);
  background:linear-gradient(135deg,var(--pink-2),var(--pink));
  color:#2b2b2b;
  font-size:18px;
  font-weight:900;
  box-shadow:0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.counter button:active{transform:scale(.96);}

/* cart */
.cart{
  background:#fffdf9;
  margin:12px;
  padding:16px;
  border-radius:var(--r-lg);
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
}
body[data-theme="dark"] .cart{ background:rgba(255,255,255,.06); color:#f1f1f1; }

textarea.input{height:90px;}

/* ‚úÖ‚úÖ‚úÖ –û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó = –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤—ã–π */
.order-btn{
  width:100%;
  padding:18px;
  margin-top:14px;
  border-radius:var(--r-lg);
  cursor:pointer;
  color:white;
  font-size:17px;
  font-weight:900;

  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.12);
  transition:.15s;
}
.order-btn:active{transform:scale(.99);}

.popup{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.3s;}
.popup.show{opacity:1;pointer-events:auto;}
.popup-box{
  background:white;
  padding:26px;
  border-radius:var(--r-lg);
  text-align:center;
  font-weight:800;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
}
body[data-theme="dark"] .popup-box{ background:#1c1c1c; color:#f1f1f1; }

/* search */
.search-wrap{width:85%;margin:8px auto;position:relative;display:none;z-index:70;}
.search-wrap.show{display:block;}
.search-wrap input{width:100%;margin:0;padding-right:44px;}
.search-clear{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:30px;
  height:30px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;

  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  transition:.15s;
}
body[data-theme="dark"] .search-clear{background:rgba(255,255,255,.06); color:#f1f1f1;}
.search-clear:active{transform:translateY(-50%) scale(.96);}
.search-title{width:85%;margin:10px auto 0;font-weight:900;opacity:.9;display:none;z-index:70;position:relative;}
.search-title.show{display:block;}
mark{background:rgba(246,183,200,.45);padding:0 .12em;border-radius:6px;}

/* quick filters */
.quick-filters{display:flex;gap:10px;padding:0 12px 10px;overflow-x:auto;}
.qbtn{
  border:1px solid var(--stroke);
  background:#fffdf9;
  box-shadow: inset 0 0 0 2px var(--inner), 0 6px 14px var(--shadow);
  border-radius:999px;
  padding:10px 14px;
  font-weight:900;
  cursor:pointer;
  white-space:nowrap;
  transition:.15s;
  color:var(--price-red);
}
body[data-theme="dark"] .qbtn{background:rgba(255,255,255,.06); color:#f1f1f1;}
.qbtn:active{transform:scale(.98);}

/* popular */
.popular-wrap{width:100%;padding:4px 12px 6px;}
.popular-title{width:100%;font-weight:900;padding:8px 2px 10px;display:flex;align-items:center;gap:8px;}
.popular-row{display:flex;gap:12px;overflow-x:auto;padding:2px 2px 10px;}
.pop-card{
  min-width:150px;
  border-radius:var(--r-lg);
  padding:10px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 8px 18px rgba(0,0,0,.08);
  cursor:pointer;
  transition:.15s;
  position:relative;
}
body[data-theme="dark"] .pop-card{background:rgba(255,255,255,.06); color:#f1f1f1;}
.pop-card:active{transform:scale(.99);}
.pop-img{
  height:74px;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(246,183,200,.25);
}
.pop-img img{width:100%;height:100%;object-fit:cover;}
.pop-name{font-weight:900;margin-top:8px;}
.pop-price{font-weight:900;color:var(--price-red);margin-top:4px;}
.pop-badge{position:absolute;left:10px;top:10px;font-size:18px;pointer-events:none;}

/* ‚úÖ +/- –≤ –ø–æ–ø—É–ª—è—Ä–Ω–æ–º —Ç–æ–∂–µ –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤—ã–µ */
.pop-counter{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:8px;}
.pop-counter button{
  width:30px;height:30px;border-radius:50%;cursor:pointer;
  border:1px solid rgba(0,0,0,.10);
  background:linear-gradient(135deg,var(--pink-2),var(--pink));
  color:#2b2b2b;
  font-size:18px;
  font-weight:900;
  box-shadow:0 8px 18px rgba(0,0,0,.10);
  transition:.15s;
}
.pop-counter button:active{transform:scale(.96);}
.pop-counter span{font-weight:900; min-width:18px; text-align:center;}

.sticky-checkout{
  position:fixed;
  left:0; right:0; bottom:0;
  padding:10px 12px;
  background:rgba(248,243,233,.88);
  backdrop-filter: blur(10px);
  z-index:999;
  border-top:1px solid rgba(0,0,0,.06);
}
body[data-theme="dark"] .sticky-checkout{
  background:rgba(18,18,18,.88);
  border-top:1px solid rgba(255,255,255,.12);
}
.sticky-inner{
  max-width:520px;
  margin:0 auto;
  border-radius:18px;
  padding:10px 12px;
  background:#fffdf9;
  border:1px solid var(--stroke);
  box-shadow: inset 0 0 0 2px var(--inner), 0 10px 22px rgba(0,0,0,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
body[data-theme="dark"] .sticky-inner{background:rgba(255,255,255,.06);}
.sticky-sum{font-weight:900;line-height:1.1;}
.sticky-sum small{display:block;font-weight:800;opacity:.75;margin-top:2px;}

/* ‚úÖ‚úÖ‚úÖ –ö–ù–û–ü–ö–ê "–ö–æ—Ä–∑–∏–Ω–∞" = –ø–∞—Å—Ç–µ–ª—å–Ω–æ-—Ä–æ–∑–æ–≤–∞—è */
.sticky-btn{
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(135deg,var(--pink-deep),var(--pink));
  color:#fff;
  font-weight:900;
  cursor:pointer;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.10), 0 12px 26px rgba(0,0,0,.12);
  transition:.15s;
  white-space:nowrap;
}
.sticky-btn:active{transform:scale(.99);}

/* menu sheet / about */
.menu-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);opacity:0;pointer-events:none;transition:.18s;z-index:1000;}
.menu-backdrop.show{opacity:1;pointer-events:auto;}
.menu-sheet{
  position:fixed;left:0; right:0;bottom:-100%;
  background:#fffdf9;
  border-top-left-radius:22px;border-top-right-radius:22px;
  border:1px solid var(--stroke);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
  transition:.22s;z-index:1010;
  padding:10px 12px 14px;
}
body[data-theme="dark"] .menu-sheet{background:#1c1c1c;border-color:rgba(255,255,255,.14);}
.menu-sheet.show{bottom:0;}
.menu-handle{width:44px;height:5px;border-radius:999px;background:rgba(0,0,0,.18);margin:6px auto 10px;}
body[data-theme="dark"] .menu-handle{background:rgba(255,255,255,.18);}
.menu-head{display:flex;align-items:center;justify-content:space-between;padding:2px 4px 10px;}
.menu-head b{font-size:16px;color:var(--price-red);}
.menu-close{width:38px;height:38px;border:none;border-radius:12px;background:transparent;cursor:pointer;font-size:22px;line-height:1;color:#777;}
body[data-theme="dark"] .menu-close{color:#bbb;}
.menu-list{display:flex;flex-direction:column;gap:8px;}
.menu-item{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:12px 12px;border-radius:16px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.03);
  cursor:pointer;text-decoration:none;color:#2b2b2b;
}
body[data-theme="dark"] .menu-item{border-color:rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:#f1f1f1;}
.menu-left{display:flex;align-items:center;gap:10px;min-width:0;}
.menu-ic{width:30px;height:30px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.06);flex:0 0 auto;}
body[data-theme="dark"] .menu-ic{background:rgba(255,255,255,.06);}
.menu-txt{display:flex;flex-direction:column;min-width:0;}
.menu-name{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.menu-sub{font-size:12px;opacity:.75;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
.menu-right{opacity:.65;font-weight:900;}

.about-modal{position:fixed;inset:0;background:rgba(0,0,0,.40);display:none;z-index:1100;padding:18px 14px;}
.about-modal.show{display:block;}
.about-card{max-width:680px;margin:0 auto;background:#fffdf9;border:1px solid var(--stroke);border-radius:22px;box-shadow:0 18px 40px rgba(0,0,0,.18);padding:14px 14px 12px;}
body[data-theme="dark"] .about-card{background:#1c1c1c;border-color:rgba(255,255,255,.14);color:#f1f1f1;}
.about-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px;}
.about-head b{font-size:16px;color:var(--price-red);}
.about-body{font-size:14px;line-height:1.45;white-space:pre-wrap;}
.about-muted{opacity:.75;}
</style>
</head>

<body>

<div class="header">
  <img src="images/logo.png" onerror="this.src='logo.png'" alt="CHOKOART logo">

  <div class="brand-wrap">
    <div class="brand-title">Bakery</div>
    <div class="brand-title2">CHOKOART</div>
    <div class="brand-slogan">BIZ BILAN MAZZALIROQ</div>

    <div class="brand-phone">
      <a href="tel:+998905050745" onclick="callPhone(event)">+998 90 505 07 45</a>
    </div>
  </div>

  <div class="menu-btn" onclick="openTopMenu()" title="–ú–µ–Ω—é">
    <div class="burger"><span></span><span></span><span></span></div>
  </div>

  <div class="search-btn" onclick="toggleSearch()">üîç</div>
</div>

<div class="menu-backdrop" id="menuBackdrop" onclick="closeTopMenu()"></div>

<div class="menu-sheet" id="menuSheet">
  <div class="menu-handle"></div>
  <div class="menu-head">
    <b>–ú–µ–Ω—é</b>
    <button class="menu-close" onclick="closeTopMenu()">√ó</button>
  </div>

  <div class="menu-list">
    <div class="menu-item" onclick="toggleReviewWidget()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚≠ê</div>
        <div class="menu-txt">
          <div class="menu-name">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</div>
          <div class="menu-sub">–Ø–Ω–¥–µ–∫—Å —Ä–µ–π—Ç–∏–Ω–≥ / –æ—Ç–∑—ã–≤—ã</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>

    <div id="reviewWidgetWrap" style="display:none; padding:6px 4px 10px;">
      <div style="border:1px solid var(--stroke); border-radius:16px; overflow:hidden; background:#fff; padding:10px; display:flex; justify-content:center;">
        <iframe
          src="https://yandex.ru/sprav/widget/rating-badge/11046753996?type=rating"
          width="150"
          height="50"
          frameborder="0"
          style="border:0; display:block;"
        ></iframe>
      </div>
      <div style="text-align:center; font-size:12px; opacity:.75; margin-top:6px;">
        –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è –≤ Telegram ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –æ—Ç–∑—ã–≤—ã —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.
      </div>
      <div style="display:flex; justify-content:center; margin-top:8px;">
        <button class="btn" style="min-width:auto; padding:10px 14px;" onclick="openYandexReviews(event)">
          –û—Ç–∫—Ä—ã—Ç—å –æ—Ç–∑—ã–≤—ã
        </button>
      </div>
    </div>

    <a class="menu-item" href="tel:+998905050745" onclick="closeTopMenu()">
      <div class="menu-left">
        <div class="menu-ic">üìû</div>
        <div class="menu-txt">
          <div class="menu-name">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
          <div class="menu-sub">+998 90 505 07 45</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <a class="menu-item" href="#" onclick="openInstagram(event)">
      <div class="menu-left">
        <div class="menu-ic" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" style="display:block;">
            <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4.3A5.7 5.7 0 1 1 6.3 14 5.7 5.7 0 0 1 12 8.3zm0 2A3.7 3.7 0 1 0 15.7 14 3.7 3.7 0 0 0 12 10.3zM18 6.7a1 1 0 1 1-1 1 1 1 0 0 1 1-1z"/>
          </svg>
        </div>
        <div class="menu-txt">
          <div class="menu-name">@choko_art_motrid</div>
          <div class="menu-sub">–û—Ç–∫—Ä—ã—Ç—å Instagram</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </a>

    <div class="menu-item" onclick="toggleThemeFromMenu()" role="button">
      <div class="menu-left">
        <div class="menu-ic">üåì</div>
        <div class="menu-txt">
          <div class="menu-name">–¢–µ–º–∞</div>
          <div class="menu-sub" id="themeMenuSub">–°–≤–µ—Ç–ª–∞—è</div>
        </div>
      </div>
      <div class="menu-right" id="themeMenuRight">–°–º–µ–Ω–∏—Ç—å</div>
    </div>

    <div class="menu-item" onclick="openAbout()" role="button">
      <div class="menu-left">
        <div class="menu-ic">‚ÑπÔ∏è</div>
        <div class="menu-txt">
          <div class="menu-name">–û –Ω–∞—Å</div>
          <div class="menu-sub">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Bakery CHOKOART</div>
        </div>
      </div>
      <div class="menu-right">‚Ä∫</div>
    </div>
  </div>
</div>

<div class="about-modal" id="aboutModal" onclick="aboutBackdropClick(event)">
  <div class="about-card">
    <div class="about-head">
      <b>–û –Ω–∞—Å</b>
      <button class="menu-close" onclick="closeAbout()">√ó</button>
    </div>
    <div class="about-body" id="aboutBody"></div>
  </div>
</div>

<div class="search-title" id="searchTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</div>
<div class="search-wrap" id="searchWrap">
  <input id="searchInput" class="input" placeholder="–ü–æ–∏—Å–∫..." oninput="searchProducts()" onkeydown="onSearchKey(event)">
  <div class="search-clear" onclick="clearSearch()" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</div>
</div>

<div class="langs">
  <button class="btn active" onclick="setLang('ru',this)">RU</button>
  <button class="btn" onclick="setLang('uz',this)">UZ</button>
  <button class="btn" onclick="setLang('en',this)">EN</button>
</div>

<div class="popular-wrap" id="popularWrap">
  <div class="popular-title" id="popularTitle">üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</div>
  <div class="popular-row" id="popularRow"></div>
</div>

<div class="quick-filters" id="quickFilters"></div>

<div class="types">
  <button class="btn active" id="btnDelivery" onclick="setType('delivery',this)"></button>
  <button class="btn" id="btnPickup" onclick="setType('pickup',this)"></button>
</div>

<input id="address" class="input">
<input id="phone" class="input">

<div class="categories" id="cats"></div>
<div class="products" id="products"></div>

<div class="cart" id="cartBox">
  <b id="cartTitle"></b>: <span id="total">0</span> —Å—É–º
  <textarea id="comment" class="input"></textarea>
  <div class="payments">
    <button class="btn active" id="payCash" onclick="setPayment('cash')"></button>
    <button class="btn" id="payClick" onclick="setPayment('click')"></button>
  </div>
  <button class="order-btn" id="orderBtn" onclick="sendOrder()"></button>
</div>

<div class="popup" id="popup"><div class="popup-box">‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div></div>

<div class="sticky-checkout">
  <div class="sticky-inner">
    <div class="sticky-sum">
      <span id="stickyTotal">0</span> <small>—Å—É–º</small>
    </div>
    <button class="sticky-btn" onclick="openCart()" id="stickyCartBtn">–ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</div>

<script>
Telegram.WebApp.ready();

/* ======= –¢–ï–ö–°–¢ "–û –ù–ê–°" ======= */
const ABOUT_TEXT = `üá∑üá∫ –†—É—Å—Å–∫–∏–π

Bakery CHOKOART ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –¥–µ—Å–µ—Ä—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∏—Å–∫—É—Å—Å—Ç–≤–æ–º üç´‚ú®
–ú—ã —Å–æ–∑–¥–∞—ë–º –∞–≤—Ç–æ—Ä—Å–∫–∏–µ —Ç–æ—Ä—Ç—ã, –∏–∑—ã—Å–∫–∞–Ω–Ω—É—é –≤—ã–ø–µ—á–∫—É –∏ —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ —à–µ–¥–µ–≤—Ä—ã –∏–∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, —Å –ª—é–±–æ–≤—å—é –∫ –¥–µ—Ç–∞–ª—è–º –∏ –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤ –ø–æ –≤–∫—É—Å—É.

–ö–∞–∂–¥—ã–π –¥–µ—Å–µ—Ä—Ç –≤ CHOKOART ‚Äî —ç—Ç–æ –±–∞–ª–∞–Ω—Å —ç—Å—Ç–µ—Ç–∏–∫–∏, —Å–≤–µ–∂–µ—Å—Ç–∏ –∏ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è. –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –∫–∞–∫ –¥–ª—è –æ—Å–æ–±–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π, —Ç–∞–∫ –∏ –¥–ª—è —Ç–µ—Ö –º–æ–º–µ–Ω—Ç–æ–≤, –∫–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –ø–æ—Ä–∞–¥–æ–≤–∞—Ç—å —Å–µ–±—è –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫.

üìç –°–∞–º–∞—Ä–∫–∞–Ω–¥, —É–ª. –ú–æ—Ç—Ä–∏–¥, 103V
üìû +998 90 505 07 45
üìû +998 95 500 62 62

CHOKOART ‚Äî —Å–ª–∞–¥–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –¥–ª—è –≤–∞—Å.

üá∫üáø O‚Äòzbekcha (lotin)

Bakery CHOKOART ‚Äî shirinliklar san‚Äôatga aylanadigan maskan üç´‚ú®
Biz tabiiy ingredientlardan, mayda tafsilotlarga mehr bilan yondashib, ta‚Äômdan hech qanday murosasiz mualliflik tortlar, nafis pishiriqlar va shokolad asarlarini tayyorlaymiz.

CHOKOARTdagi har bir desert ‚Äî bu estetika, yangilik va haqiqiy rohatning mukammal muvozanati. Biz ham muhim tadbirlar, ham o‚Äòzingizni shunchaki xursand qilishni istagan onlar uchun xizmat qilamiz.

üìç Samarqand, Motrid ko‚Äòchasi, 103V
üìû +998 90 505 07 45
üìû +998 95 500 62 62

CHOKOART ‚Äî siz uchun yaratilgan shirin san‚Äôat.

üá¨üáß English

Bakery CHOKOART is a place where desserts become art üç´‚ú®
We create signature cakes, refined pastries, and chocolate masterpieces using natural ingredients, with love for every detail and no compromise on taste.

Every dessert at CHOKOART is a perfect balance of aesthetics, freshness, and true enjoyment. We craft sweets for special occasions as well as for moments when you simply want to treat yourself.

üìç Samarkand, Motrid Street, 103V
üìû +998 90 505 07 45
üìû +998 95 500 62 62

CHOKOART ‚Äî sweet art created for you.`;

/* ======= –®–ê–ü–ö–ê: –∑–≤–æ–Ω–æ–∫ ======= */
function callPhone(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const tel = "tel:+998905050745";
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(tel);
      return;
    }
  }catch(_){}
  try{ window.location.href = tel; }catch(_){}
}

/* ======= –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é ======= */
function openTopMenu(){
  try{ closeSearch(); }catch(_){}
  document.getElementById('menuBackdrop').classList.add('show');
  document.getElementById('menuSheet').classList.add('show');
}
function closeTopMenu(){
  document.getElementById('menuBackdrop').classList.remove('show');
  document.getElementById('menuSheet').classList.remove('show');
}

function toggleReviewWidget(){
  const w = document.getElementById('reviewWidgetWrap');
  w.style.display = (w.style.display === 'none' || !w.style.display) ? 'block' : 'none';
}

/* ‚úÖ‚úÖ‚úÖ –ù–û–í–ê–Ø –°–°–´–õ–ö–ê –ù–ê –û–¢–ó–´–í–´ */
function openYandexReviews(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = "https://yandex.uz/maps/org/239856130727/?ll=66.960593%2C39.684041&mode=search&sctx=ZAAAAAgBEAAaKAoSCaetEcE4MVFAEfxVgO82QURAEhIJDJQUWABT1j8RPUfku5S6xD8iBgABAgMEBSgKOABA1LoGSAFiJHNuaXBwZXRfZXhwX25hbWU9ZnVsbG9iamVjdHMvMS54OnJlZmIjc25pcHBldF9leHBfbmFtZT10b3BvYmplY3RzLzEueDpyZWZiHnNuaXBwZXRfZXhwX25hbWU9Z29vZHMvMS54OnJlZmInc25pcHBldF9leHBfbmFtZT1nb29kc19yZWdpc3Rlci8xLng6cmVmYgtmcmVzaG5lc3M9MGIXc291cmNlPWJ1c2luZXNzOmV4cF9yZWZiFXNvdXJjZT1wcmljZXM6ZXhwX3JlZmoCdXqdAc3MzD2gAQCoAQC9AXc%2FZizCAQantajE%2FQaCAg9iYWtlcnkgY2hva29hcnSKAgCSAgCaAgxkZXNrdG9wLW1hcHM%3D&sll=66.960593%2C39.684041&sspn=0.013893%2C0.006530&text=bakery%20chokoart&z=16.65";
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}

function openInstagram(e){
  try{ e.preventDefault(); e.stopPropagation(); }catch(_){}
  const url = "https://www.instagram.com/choko_art_motrid/";
  closeTopMenu();
  try{
    if (window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.openLink === "function"){
      Telegram.WebApp.openLink(url);
      return;
    }
  }catch(_){}
  window.open(url, "_blank");
}

/* ======= –¢–µ–º–∞ ======= */
function applyTheme(theme){
  document.body.setAttribute('data-theme', theme);
  localStorage.setItem('chokoart_theme', theme);

  const sub = document.getElementById('themeMenuSub');
  if(sub) sub.innerText = (theme === 'dark') ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';

  try{
    if (window.Telegram && Telegram.WebApp){
      Telegram.WebApp.setHeaderColor?.(theme === 'dark' ? '#121212' : '#F6B7C8');
      Telegram.WebApp.setBackgroundColor?.(theme === 'dark' ? '#121212' : '#F8F3E9');
    }
  }catch(_){}
}
function toggleThemeFromMenu(){
  const cur = document.body.getAttribute('data-theme') || 'light';
  const next = (cur === 'dark') ? 'light' : 'dark';
  applyTheme(next);
}

function openAbout(){
  closeTopMenu();
  const ab = document.getElementById('aboutBody');
  if(ab) ab.textContent = ABOUT_TEXT;
  document.getElementById('aboutModal').classList.add('show');
}
function closeAbout(){
  document.getElementById('aboutModal').classList.remove('show');
}
function aboutBackdropClick(e){
  if(e.target && e.target.id === 'aboutModal') closeAbout();
}

(function initTheme(){
  const saved = localStorage.getItem('chokoart_theme');
  if(saved === 'dark' || saved === 'light'){
    applyTheme(saved);
  }else{
    const tgTheme = (window.Telegram && Telegram.WebApp && Telegram.WebApp.colorScheme) ? Telegram.WebApp.colorScheme : 'light';
    applyTheme(tgTheme === 'dark' ? 'dark' : 'light');
  }
})();

/* ======= Telegram user ======= */
const tgUser = Telegram.WebApp.initDataUnsafe?.user || {};
const tg_username = tgUser.username || "";
const tg_first_name = tgUser.first_name || "";
const tg_id = tgUser.id || "";

/* ======= State ======= */
let lang='ru',category='cheesecakes',type='delivery',payment='cash',cart={};

const TEXT={
  ru:{delivery:'üöö –î–æ—Å—Ç–∞–≤–∫–∞',pickup:'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑',address:'üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏',phone:'üìû –¢–µ–ª–µ—Ñ–æ–Ω',cart:'üõí –ö–æ—Ä–∑–∏–Ω–∞',order:'–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑',comment:'‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É',cash:'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',click:'üí≥ CLICK',results:'–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',popular:'üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ–µ',empty:'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è'},
  uz:{delivery:'üöö Yetkazish',pickup:'üèÉ Olib ketish',address:'üìç Manzil',phone:'üìû Telefon',cart:'üõí Savat',order:'Buyurtma berish',comment:'‚úçÔ∏è Izoh',cash:'üíµ Naqd',click:'üí≥ CLICK',results:'Qidiruv natijalari',popular:'üî• Ommabop',empty:"Savat bo‚Äòsh"},
  en:{delivery:'üöö Delivery',pickup:'üèÉ Pickup',address:'üìç Address',phone:'üìû Phone',cart:'üõí Cart',order:'Place order',comment:'‚úçÔ∏è Comment',cash:'üíµ Cash',click:'üí≥ CLICK',results:'Search results',popular:'üî• Popular',empty:'Cart is empty'}
};

const CATS={
  ru:{
    cheesecakes:'üç∞ –ß–∏–∑–∫–µ–π–∫–∏',
    cakes:'üéÇ –¢–æ—Ä—Ç—ã',
    rolls:'üç• –†—É–ª–µ—Ç—ã',
    bakery:'ü•ê –í—ã–ø–µ—á–∫–∞',
    cookies:'üç™ –ü–µ—á–µ–Ω—å–µ',
    desserts:'üßÅ –î–µ—Å–µ—Ä—Ç—ã',
    pies:'ü•ß –ü–∏—Ä–æ–≥–∏'
  },
  uz:{
    cheesecakes:'üç∞ Chizkeyklar',
    cakes:'üéÇ Tortlar',
    rolls:'üç• Ruletlar',
    bakery:'ü•ê Pishiriqlar',
    cookies:'üç™ Pechenye',
    desserts:'üßÅ Desertlar',
    pies:'ü•ß Piroglar'
  },
  en:{
    cheesecakes:'üç∞ Cheesecakes',
    cakes:'üéÇ Cakes',
    rolls:'üç• Rolls',
    bakery:'ü•ê Bakery',
    cookies:'üç™ Cookies',
    desserts:'üßÅ Desserts',
    pies:'ü•ß Pies'
  }
};

const MENU = {
  cheesecakes:[
    {id:'cheese_ny', p:45000, img:'images/cheesecake_ny.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –ù—å—é-–ô–æ—Ä–∫', uz:'Nyu-York chizkeyk', en:'New York cheesecake'}},
    {id:'cheese_berry', p:48000, img:'images/cheesecake_berry.png', n:{ru:'–ß–∏–∑–∫–µ–π–∫ –Ø–≥–æ–¥–Ω—ã–π', uz:'Mevali chizkeyk', en:'Berry cheesecake'}}
  ],
  cakes:[
    {id:'cake_choco', p:52000, img:'images/cake_choco.png', n:{ru:'–¢–æ—Ä—Ç –®–æ–∫–æ–ª–∞–¥–Ω—ã–π', uz:'Shokoladli tort', en:'Chocolate cake'}},
    {id:'cake_redvel', p:55000, img:'images/cake_redvelvet.png', n:{ru:'–¢–æ—Ä—Ç Red Velvet', uz:'Red Velvet tort', en:'Red Velvet cake'}}
  ],
  rolls:[
    {id:'roll_choco', p:38000, img:'images/roll_choco.png', n:{ru:'–†—É–ª–µ—Ç —à–æ–∫–æ–ª–∞–¥–Ω—ã–π', uz:'Shokoladli rulet', en:'Chocolate roll'}},
    {id:'roll_cream', p:39000, img:'images/roll_cream.png', n:{ru:'–†—É–ª–µ—Ç —Å–ª–∏–≤–æ—á–Ω—ã–π', uz:'Qaymoqli rulet', en:'Cream roll'}}
  ],
  bakery:[
    {id:'croissant', p:18000, img:'images/croissant.png', n:{ru:'–ö—Ä—É–∞—Å—Å–∞–Ω', uz:'Kruassan', en:'Croissant'}},
    {id:'danish', p:20000, img:'images/danish.png', n:{ru:'–î–∞–Ω–∏—à —Å —è–≥–æ–¥–∞–º–∏', uz:'Mevali danish', en:'Berry danish'}}
  ],
  cookies:[
    {id:'cookie_choco', p:12000, img:'images/cookie_choco.png', n:{ru:'–ü–µ—á–µ–Ω—å–µ —à–æ–∫–æ–ª–∞–¥–Ω–æ–µ', uz:'Shokoladli pechenye', en:'Chocolate cookies'}},
    {id:'cookie_nut', p:13000, img:'images/cookie_nut.png', n:{ru:'–ü–µ—á–µ–Ω—å–µ –æ—Ä–µ—Ö–æ–≤–æ–µ', uz:"Yong'oqli pechenye", en:'Nut cookies'}}
  ],
  desserts:[
    {id:'dessert_tiramisu', p:42000, img:'images/tiramisu.png', n:{ru:'–¢–∏—Ä–∞–º–∏—Å—É', uz:'Tiramisu', en:'Tiramisu'}},
    {id:'dessert_macaron', p:30000, img:'images/macaron.png', n:{ru:'–ú–∞–∫–∞—Ä–æ–Ω—Å (–Ω–∞–±–æ—Ä)', uz:'Makaron (to‚Äòplam)', en:'Macarons (set)'}}
  ],
  pies:[
    {id:'pie_apple', p:35000, img:'images/pie_apple.png', n:{ru:'–ü–∏—Ä–æ–≥ —è–±–ª–æ—á–Ω—ã–π', uz:'Olmali pirog', en:'Apple pie'}},
    {id:'pie_cherry', p:36000, img:'images/pie_cherry.png', n:{ru:'–ü–∏—Ä–æ–≥ –≤–∏—à–Ω–µ–≤—ã–π', uz:'Gilosli pirog', en:'Cherry pie'}}
  ]
};

/* –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ */
const POPULAR = ['cheese_ny','cake_redvel','dessert_tiramisu','croissant'];

const ITEM_INDEX = {};
for (const c in MENU){ MENU[c].forEach(it => { ITEM_INDEX[it.id] = it; }); }

function nameOf(id){
  const it = ITEM_INDEX[id];
  if(!it) return id;
  return (it.n && (it.n[lang] || it.n.ru)) || id;
}
function formatSum(x){
  const n = Number(x) || 0;
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ');
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function highlight(name, q){
  const n = escapeHtml(name);
  if(!q) return n;
  const idx = n.toLowerCase().indexOf(q.toLowerCase());
  if(idx === -1) return n;
  const before = n.slice(0, idx);
  const mid = n.slice(idx, idx + q.length);
  const after = n.slice(idx + q.length);
  return `${before}<mark>${mid}</mark>${after}`;
}

function loadSaved(){
  const a = localStorage.getItem('chokoart_address') || '';
  const p = localStorage.getItem('chokoart_phone') || '';
  if(a && !address.value) address.value = a;
  if(p && !phone.value) phone.value = p;
}
function bindSave(){
  address.addEventListener('input', ()=>localStorage.setItem('chokoart_address', address.value));
  phone.addEventListener('input', ()=>localStorage.setItem('chokoart_phone', phone.value));
}

function updateTypeFields(){
  if(type === 'pickup'){
    address.style.display = 'none';
    address.value = '';
  }else{
    address.style.display = 'block';
  }
}

function setLang(l,b){
  lang=l;
  document.querySelectorAll('.langs .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  applyLang();
}

function applyLang(){
  btnDelivery.innerText=TEXT[lang].delivery;
  btnPickup.innerText=TEXT[lang].pickup;
  address.placeholder=TEXT[lang].address;
  phone.placeholder=TEXT[lang].phone;
  cartTitle.innerText=TEXT[lang].cart;
  orderBtn.innerText=TEXT[lang].order;
  comment.placeholder=TEXT[lang].comment;
  payCash.innerText=TEXT[lang].cash;
  payClick.innerText=TEXT[lang].click;
  searchTitle.innerText = TEXT[lang].results;
  popularTitle.innerText = TEXT[lang].popular;
  stickyCartBtn.innerText = TEXT[lang].cart;

  renderPopular();
  renderQuickFilters();
  renderCats();
  renderProducts();
  updateTotal();
  updateTypeFields();
}

function openCart(){
  try{ cartBox.scrollIntoView({behavior:'smooth', block:'start'}); }
  catch(_){ window.location.hash = '#cartBox'; }
}

/* popular */
function renderPopular(){
  popularRow.innerHTML = '';
  POPULAR.forEach((id)=>{
    const it = ITEM_INDEX[id];
    if(!it) return;
    cart[id]=cart[id]||0;

    popularRow.innerHTML += `
      <div class="pop-card" onclick="onPopularCardClick(event,'${id}')">
        <div class="pop-badge">üî•</div>
        <div class="pop-img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
        <div class="pop-name">${escapeHtml(nameOf(id))}</div>
        <div class="pop-price">${formatSum(it.p)} <small>—Å—É–º</small></div>

        <div class="pop-counter">
          <button type="button" onclick="popChg(event,'${id}',-1)">‚àí</button>
          <span id="pc_${id}">${cart[id]||0}</span>
          <button type="button" onclick="popChg(event,'${id}',1)">+</button>
        </div>
      </div>
    `;
  });
}
function onPopularCardClick(e,id){
  if(e && e.target && (e.target.closest && e.target.closest('button'))) return;
  chg(id, 1);
  const pc = document.getElementById('pc_'+id);
  if(pc) pc.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}
function popChg(e,id,delta){
  if(e){ e.preventDefault(); e.stopPropagation(); }
  chg(id, delta);
  const pc = document.getElementById('pc_'+id);
  if(pc) pc.innerText = cart[id] || 0;
  if(isSearchOpen()) closeSearch();
}

function renderQuickFilters(){
  const keys = ['cheesecakes','cakes','desserts','bakery'];
  quickFilters.innerHTML = '';
  keys.forEach(k=>{
    if(!MENU[k]) return;
    quickFilters.innerHTML += `<button class="qbtn" onclick="pickCategory('${k}')">${CATS[lang][k]}</button>`;
  });
}
function pickCategory(k){
  if(isSearchOpen()) closeSearch();
  category = k;
  renderCats();
  renderProducts();
}

function renderCats(){
  cats.innerHTML='';
  for(let k in MENU){
    cats.innerHTML+=`<button class="btn ${k===category?'active':''}" onclick="category='${k}';renderCats();renderProducts()">${CATS[lang][k] || k}</button>`;
  }
  setTimeout(()=>{
    const active = cats.querySelector('.btn.active');
    if(active && active.scrollIntoView){
      active.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
    }
  }, 50);
}

function cardHTML(it, q=''){
  const id = it.id;
  const displayName = nameOf(id);
  const nameHtml = highlight(displayName, q);
  const qty = cart[id] || 0;

  return `<div class="card">
    <div class="img"><img src="${it.img}" onerror="this.src='images/logo.png'"></div>
    <div class="item-name">${nameHtml}</div>
    <div class="price">${formatSum(it.p)} <small>—Å—É–º</small></div>
    <div class="counter">
      <button type="button" onclick="chg('${id}',-1)">‚àí</button>
      <span id="c_${id}">${qty}</span>
      <button type="button" onclick="chg('${id}',1)">+</button>
    </div>
  </div>`;
}

function renderProducts(){
  products.innerHTML='';
  (MENU[category] || []).forEach((it)=>{
    cart[it.id]=cart[it.id]||0;
    products.innerHTML+=cardHTML(it,'');
  });
}

function syncPopularCounters(){
  POPULAR.forEach((id)=>{
    const el = document.getElementById('pc_'+id);
    if(el) el.innerText = cart[id] || 0;
  });
}
function chg(id,v){
  cart[id]=Math.max(0,(cart[id]||0)+v);
  const el = document.getElementById('c_'+id);
  if(el) el.innerText=cart[id];
  updateTotal();
  syncPopularCounters();
}
function price(id){
  return (ITEM_INDEX[id] && ITEM_INDEX[id].p) ? ITEM_INDEX[id].p : 0;
}
function updateTotal(){
  let s=0;
  for(let id in cart) s += (cart[id]||0) * price(id);
  total.innerText = formatSum(s);
  stickyTotal.innerText = formatSum(s);
}

function setType(t,b){
  if(isSearchOpen()) closeSearch();
  type=t;
  document.querySelectorAll('.types .btn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  updateTypeFields();
}
function setPayment(p){
  payment=p;
  payCash.classList.toggle('active',p==='cash');
  payClick.classList.toggle('active',p==='click');
}

/* search */
function isSearchOpen(){ return searchWrap.classList.contains('show'); }
function toggleSearch(){ if(isSearchOpen()) closeSearch(); else openSearch(); }
function openSearch(){
  searchWrap.classList.add('show');
  searchTitle.classList.add('show');
  cats.style.display = 'none';
  quickFilters.style.display = 'none';
  popularWrap.style.display = 'none';
  searchInput.value = '';
  searchInput.focus();
  searchProducts();
}
function closeSearch(){
  searchWrap.classList.remove('show');
  searchTitle.classList.remove('show');
  cats.style.display = '';
  quickFilters.style.display = '';
  popularWrap.style.display = '';
  searchInput.value = '';
  renderProducts();
}
function clearSearch(){ closeSearch(); }
function onSearchKey(e){ if(e.key === 'Enter') closeSearch(); }

function searchProducts(){
  const q = (searchInput.value || '').trim().toLowerCase();
  products.innerHTML='';

  if(!q){
    (MENU[category] || []).forEach((it)=>{
      cart[it.id]=cart[it.id]||0;
      products.innerHTML += cardHTML(it,'');
    });
    return;
  }
  for(let c in MENU){
    MENU[c].forEach((it)=>{
      const nmRu = (it.n && it.n.ru) ? String(it.n.ru).toLowerCase() : '';
      const nmUz = (it.n && it.n.uz) ? String(it.n.uz).toLowerCase() : '';
      const nmEn = (it.n && it.n.en) ? String(it.n.en).toLowerCase() : '';
      const nmCur = (it.n && it.n[lang]) ? String(it.n[lang]).toLowerCase() : '';
      if(nmCur.includes(q) || nmRu.includes(q) || nmUz.includes(q) || nmEn.includes(q)){
        cart[it.id]=cart[it.id]||0;
        products.innerHTML += cardHTML(it, q);
      }
    });
  }
}
document.addEventListener('click', (e)=>{
  if(!isSearchOpen()) return;
  const t = e.target;
  const insideSearch = searchWrap.contains(t) || searchTitle.contains(t);
  const onBtn = t.closest && t.closest('.search-btn');
  if(!insideSearch && !onBtn) closeSearch();
}, true);

/* order helpers */
function genOrderId(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const key = `chokoart_seq_${d.getFullYear()}${mm}${dd}`;
  let n = Number(localStorage.getItem(key) || 0) + 1;
  localStorage.setItem(key, String(n));
  const num = String(n).padStart(3,'0');
  return `CHK-${dd}${mm}-${num}`;
}
function calcTotalNum(){
  let s = 0;
  for (const id in cart) s += (Number(cart[id] || 0) * price(id));
  return s;
}

function sendOrder(){
  popup.classList.add('show');

  const items = [];
  for (const id in cart) {
    const qty = Number(cart[id] || 0);
    if (qty > 0) {
      const it = ITEM_INDEX[id] || {};
      items.push({
        id,
        qty,
        price: it.p || 0,
        name_ru: (it.n && it.n.ru) ? it.n.ru : id,
        name_lang: nameOf(id)
      });
    }
  }

  if (items.length === 0) {
    popup.classList.remove('show');
    alert(TEXT[lang].empty);
    return;
  }

  const payload = {
    tg: { id: tg_id, username: tg_username, first_name: tg_first_name },
    items,
    total: total.innerText,
    total_num: calcTotalNum(),
    payment,
    type,
    address: (type==='pickup' ? '' : address.value),
    phone: phone.value,
    comment: comment.value,
    order_id: genOrderId(),
    lang
  };

  setTimeout(()=>{
    Telegram.WebApp.sendData(JSON.stringify(payload));
    Telegram.WebApp.close();
  }, 700);
}

/* init */
function ensurePhonePrefill(){
  if(!phone.value) phone.value = "+998 90 505 07 45";
}
function loadSaved(){
  const a = localStorage.getItem('chokoart_address') || '';
  const p = localStorage.getItem('chokoart_phone') || '';
  if(a && !address.value) address.value = a;
  if(p && !phone.value) phone.value = p;
}
function bindSave(){
  address.addEventListener('input', ()=>localStorage.setItem('chokoart_address', address.value));
  phone.addEventListener('input', ()=>localStorage.setItem('chokoart_phone', phone.value));
}

loadSaved();
bindSave();
ensurePhonePrefill();
applyLang();
</script>
</body>
</html>
